# Экран авторизации через OAuth (OAuthWebVC)

## Описание и назначение экрана

Экран предназначен для авторизации пользователя в приложении Мегаптека через сторонние сервисы (Сбер ID, VK ID, Apple ID и др.) с помощью web-view. Он обеспечивает ввод номера телефона, переход к OAuth-авторизации, отображение web-страниц сторонних сервисов, а также обработку редиректов и возврат результата авторизации в приложение.

## Общая иерархия экрана

Экран реализован на основе класса `OAuthWebVC` (наследуется от `AViewController`). Основной контент размещается внутри компонента `WKWebView`, который занимает всю доступную область экрана. Верхняя панель и панель навигации не отображаются. Дополнительные элементы (ворнинги, алерты) отображаются внутри web-view или через системные всплывающие окна.

---

## 1. Верхняя панель

### 1.1. Назначение и элементы

- **Кнопка "Назад"/"Закрыть"** (`UIBarButtonItem`)
  - Назначение: возвращает пользователя на предыдущий экран или закрывает модальное окно.
  - Логика отображения: отображается автоматически, если экран открыт через навигационный контроллер или модально, но визуально панель навигации не отображается.
  - Взаимодействие: при нажатии закрывает текущий экран (`closeScreen()`).

- **Заголовок экрана**
  - Не отображается.

---

## 2. Основная область (основной контент)

Вся основная область экрана занимает компонент `WKWebView` (`webView`), который отображает web-страницы сторонних сервисов авторизации.

### 2.1. Секции и их элементы

#### Секция: WebView (WKWebView)

- **Назначение**: отображение web-страниц для ввода данных и прохождения авторизации через сторонние сервисы (Сбер ID, VK ID, Apple ID и др.).
- **Вложенные элементы** (динамически подгружаются с web-страниц):
  - Поля ввода (номер телефона, e-mail)
  - Кнопки "Продолжить", "Войти через приложение", "Создать аккаунт" и др.
  - Переключатели, чекбоксы, ссылки (например, согласие на рекламу, условия оферты)
  - Ворнинги и уведомления (например, "установите сертификаты Минцифры")
  - Логотипы сервисов (A ID, Сбер ID, VK ID, Apple ID)
  - Кнопки социальных сетей (VK, Одноклассники, Mail.ru)
- **Особенности отображения**:
  - Содержимое webView полностью зависит от загружаемой страницы (`OAuthData.linkUrl`).
  - Элементы могут меняться в зависимости от выбранного способа авторизации.
  - Некоторые элементы (например, ворнинги или чекбоксы) появляются только в определённых состояниях.
  - При фокусировании на поле ввода появляется клавиатура для ввода текста.
- **Взаимодействие пользователя**:
  - Ввод данных, нажатие на кнопки, переход по ссылкам.
  - После успешной авторизации происходит редирект на один из адресов из `OAuthData.redirectUrls`, что обрабатывается делегатом и закрывает экран с возвратом результата.
  - Если пользователь выбирает альтернативный способ входа (например, через приложение), webView загружает соответствующую страницу.
  - При фокусе на поле ввода появляется клавиатура для ввода текста.

---

## 3. Всплывающие и дополнительные элементы

- **Ворнинги и уведомления** (HTML-элементы внутри webView)
  - Например: "Чтобы входить по Сбер ID без препятствий, установите сертификаты Минцифры".
  - Логика отображения: появляются только при определённых условиях, задаются сервером.
  - Взаимодействие: могут содержать ссылки для перехода на инструкции или загрузку сертификатов.

- **Системные алерты** (например, при попытке открыть внешнее приложение)
  - Логика отображения: если webView пытается открыть ссылку с нестандартной схемой (например, vk://), вызывается системное окно для перехода во внешнее приложение.
  - Взаимодействие: пользователь может подтвердить или отменить переход.

---

## 4. Нижняя навигационная панель

- На экране отсутствует собственная нижняя навигационная панель.
- Может появляться только системная панель управления клавиатурой при фокусе на поле ввода.

---

## 5. Открываемые экраны при взаимодействии с элементами

### Интерактивные элементы и открываемые экраны

- **Кнопка "Назад"/"Закрыть"** (UIBarButtonItem)
  - Открывает: предыдущий экран или закрывает модальное окно (кодовое имя зависит от контекста вызова).

- **Кнопки и ссылки внутри webView**
  - Открывают: внешние приложения (например, VK, Сбер ID), новые web-страницы, либо возвращают результат авторизации в приложение (через делегат `OAuthWebDelegate`).

- **Переход по ссылкам с нестандартной схемой**
  - Открывает: соответствующее приложение (например, VK, Сбер ID) через системный обработчик ссылок.

---

## 6. Схематичное дерево иерархии экрана

```
Экран авторизации через OAuth (OAuthWebVC)
├── Верхняя панель (AViewController)
│   ├── Кнопка "Назад"/"Закрыть" (UIBarButtonItem)
│   └── (Заголовок не отображается)
├── Основная область
│   └── WebView (WKWebView)
│       ├── HTML-элементы web-страниц:
│       │   ├── Поля ввода (UITextField/HTML input)
│       │   ├── Кнопки (UIButton/HTML button)
│       │   ├── Чекбоксы, ссылки, логотипы
│       │   ├── Ворнинги, уведомления
│       │   └── Кнопки соцсетей, альтернативные способы входа
├── Всплывающие элементы
│   ├── Ворнинги внутри webView (HTML)
│   └── Системные алерты (например, открытие внешних приложений)
└── Системная панель управления клавиатурой (при фокусе на поле ввода)
```

---

## [Нужно дополнить]

- Вся разметка и логика отображения элементов внутри webView полностью зависит от загружаемой web-страницы, поэтому точный состав и иерархия вложенных элементов могут отличаться в зависимости от состояния и выбранного способа авторизации.

--- 