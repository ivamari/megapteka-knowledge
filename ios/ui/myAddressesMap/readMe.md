# Экран добавления/редактирования адреса на карте (MyAddressesMapVC)

## Описание и назначение экрана

Экран предназначен для добавления или редактирования пользовательского адреса с помощью поиска по адресу и выбора точки на карте. Пользователь может ввести название адреса (например, "Дом", "Мама дом"), указать адрес вручную или выбрать точку на карте, а также воспользоваться подсказками. Экран обеспечивает валидацию данных, отображает ошибки и позволяет сохранить или изменить адрес.

## Общая иерархия экрана

Экран состоит из двух основных областей:
- Верхняя область с картой и плавающей кнопкой-пином для выбора точки.
- Нижний лист (bottom sheet), который содержит поля для ввода, подсказки, сообщения и кнопку сохранения.

---

## 1. Верхняя панель

### 1.1. Назначение и элементы

- **Навигационная панель (UINavigationBar)**
  - Заголовок: динамически меняется ("Добавить адрес", "Дом", "Мама дом" и т.д.)
  - Кнопка "Назад" (по умолчанию, слева)
  - Кнопка "Удалить" (иконка корзины, появляется при редактировании существующего адреса)
- **Нет нижней навигационной панели**

---

## 2. Основная область (основной контент)

### 2.1. Карта (MyAddressesMapBgView)
- **Карта (BaseMapAdapter, добавляется в MyAddressesMapBgView)**
  - Отображает карту с возможностью перемещения и масштабирования.
  - В центре карты — плавающий пин (AddAddressPinView), который анимируется при перемещении карты.
- **Плавающая панель управления (ViewPassthroughHit)**
  - Кнопка компаса (HighlightedView + UIImageView) — сбросить направление карты.
  - Кнопка "Мое местоположение" (UIButton) — перейти к текущей геолокации пользователя.
  - Кнопка "+" (UIButton) — увеличить масштаб карты.
  - Кнопка "–" (UIButton) — уменьшить масштаб карты.
  - Все кнопки расположены вертикально справа от карты.

---

## 3. Нижний лист (MyAddressesEditSheetVC → MyAddressesEditSheetBgView → MyAddressesEditSheetView)

### 3.1. Верхний индикатор (UIView)
- Визуальный элемент для drag & drop (горизонтальная полоска сверху листа).

### 3.2. Основной контент (MyAddressesEditSheetView)
- **Прокручиваемая область (UIScrollView)**
  - **Секция "Название"**
    - Лейбл "Название" (ViLabel)
    - Текстовое поле для ввода названия (TextField)
      - Иконка карандаша (справа, появляется если поле активно)
      - Кнопка очистки (крестик, появляется при вводе)
      - Валидация: поле обязательно для заполнения, подсвечивается при ошибке.
    - Разделитель (UIView)
  - **Секция "Адрес"**
    - Лейбл "Адрес" (ViLabel)
    - Текстовое поле для ввода адреса (TextField)
      - Кнопка "Карта" (ExtendedHitButton, иконка/текст, справа) — открывает карту для выбора точки.
      - Кнопка очистки (крестик, появляется при вводе)
      - Валидация: поле обязательно для заполнения, подсвечивается при ошибке.
    - Разделитель (UIView)
  - **Список подсказок адреса (UIStackView, stackViewAddresses)**
    - Динамически появляется под полем "Адрес" при вводе текста.
    - Каждый элемент — MyAddressesEditSheetSuggestionView:
      - Контейнер (HighlightedView)
      - Лейбл с адресом (ViLabel)
      - Лейбл с расстоянием (ViLabel), если есть (например, "1.2 км")
      - Разделитель (UIView)
    - При нажатии на подсказку — адрес и координаты подставляются в поля, лист схлопывается.
  - **Кнопка "Сохранить адрес"/"Сохранить изменения" (PrimaryButton)**
    - Текст зависит от режима (добавление/редактирование).
    - Активна только если оба поля заполнены и валидны.
    - При нажатии — сохраняет адрес, закрывает экран.
    - В режиме ввода адреса скрывается, появляется только при валидных данных.
  - **Сообщение/алерт (UILabel, viewAlert)**
    - Динамически появляется под кнопкой, если есть ошибки или требуется подсказка.
    - Текст зависит от состояния:
      - "Начните вводить адрес, например, «Пушкина, 14» или укажите точку на карте"
      - "Выберите адрес из предложенных вариантов"
      - "Адрес не найден" и др.
    - Цвет текста — красный для ошибок, основной для подсказок.
- **Особенности отображения**
  - Нижний лист может быть в трех состояниях: скрыт, схлопнут, развернут.
  - При фокусе на поле "Адрес" лист разворачивается, появляется список подсказок.
  - При выборе адреса или потере фокуса — лист схлопывается, подсказки скрываются.
  - При ошибках (например, не заполнено поле) — появляется сообщение и кнопка "Сохранить" неактивна.

---

## 4. Всплывающие и дополнительные элементы

- **Алерты (AlertModel)**
  - Показываются при ошибках (например, не удалось определить адрес, не заполнено поле).
  - Содержат заголовок, текст и кнопки действий (например, "Повторить", "Отмена").
  - Вызов: через displayAlert, displayErrorAlert, displayDeletionAlert.

---

## 5. Открываемые экраны при взаимодействии с элементами

- **Кнопка "Карта"** (ExtendedHitButton в поле "Адрес")
  - Открывает: текущий экран с развернутой картой (MyAddressesMapVC)
- **Кнопка "Сохранить адрес"/"Сохранить изменения"** (PrimaryButton)
  - Сохраняет адрес, закрывает экран (MyAddressesMapVC)
- **Кнопка "Удалить"** (навигационная панель)
  - Показывает алерт подтверждения удаления, после подтверждения — удаляет адрес и закрывает экран.
- **Подсказка адреса** (MyAddressesEditSheetSuggestionView)
  - Подставляет выбранный адрес и координаты, схлопывает лист.

---

## 6. Схематичное дерево иерархии экрана

```
Экран "Добавление/Редактирование адреса"
├── Навигационная панель (UINavigationBar)
│   ├── Заголовок (динамический)
│   ├── Кнопка "Назад"
│   └── Кнопка "Удалить" (только для редактирования)
├── Основная область (MyAddressesMapBgView)
│   ├── Карта (BaseMapAdapter)
│   ├── Плавающий пин (AddAddressPinView)
│   └── Панель управления (ViewPassthroughHit)
│       ├── Кнопка компаса (HighlightedView)
│       ├── Кнопка "Мое местоположение" (UIButton)
│       ├── Кнопка "+" (UIButton)
│       └── Кнопка "–" (UIButton)
├── Нижний лист (MyAddressesEditSheetBgView)
│   ├── Верхний индикатор (UIView)
│   └── Основной контент (MyAddressesEditSheetView)
│       ├── Прокручиваемая область (UIScrollView)
│       │   ├── Секция "Название"
│       │   │   ├── Лейбл (ViLabel)
│       │   │   ├── Текстовое поле (TextField)
│       │   │   └── Разделитель (UIView)
│       │   ├── Секция "Адрес"
│       │   │   ├── Лейбл (ViLabel)
│       │   │   ├── Текстовое поле (TextField)
│       │   │   ├── Кнопка "Карта" (ExtendedHitButton)
│       │   │   └── Разделитель (UIView)
│       │   ├── Список подсказок (UIStackView)
│       │   │   └── Подсказка (MyAddressesEditSheetSuggestionView)
│       │   │       ├── Контейнер (HighlightedView)
│       │   │       ├── Лейбл адреса (ViLabel)
│       │   │       └── Лейбл расстояния (ViLabel)
│       │   ├── Кнопка "Сохранить адрес"/"Сохранить изменения" (PrimaryButton)
│       │   └── Сообщение/алерт (UILabel)
```

---

## [Нужно дополнить]

- Не хватает информации о точных названиях иконок, цветов и шрифтов (используются кастомные стили, но их параметры не раскрыты).
- Не описаны все возможные состояния ошибок и алертов (тексты берутся из TextProvider).
- Не раскрыта логика появления/скрытия некоторых элементов (например, когда именно появляется кнопка "Карта" или как работает анимация пина).
- Не описаны все возможные сценарии взаимодействия с картой (например, что происходит при тапе по карте вне пина). 
