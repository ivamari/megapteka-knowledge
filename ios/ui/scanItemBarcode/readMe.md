# Экран поиска по штрих-коду (ScanItemBarcodeVC)

## Описание и назначение экрана
Экран предназначен для поиска товара по штрих-коду с помощью камеры или загрузки изображения. Пользователь может навести камеру на штрих-код, чтобы узнать стоимость товара, либо загрузить изображение для распознавания кода. Экран также отображает результат поиска, ошибки и позволяет повторить сканирование или добавить найденный товар в корзину. Поддерживаются форматы кодов: EAN-13, EAN-8, DataMatrix.

## Общая иерархия экрана
Экран реализован на основе UIViewController (`ScanItemBarcodeVC`) с использованием кастомных UIView и XIB-файлов. Основные области: верхняя панель (заголовок), основная область (камера, кнопка загрузки, оверлеи), нижняя карточка состояния/результата (`ScanCardView`), всплывающие элементы (алерты, ошибки).

---

## 1. Верхняя панель
### 1.1. Назначение и элементы
- **Заголовок** (navigationItem.title, задаётся через `TextProvider.Item.ScanBarcode.title`)
  - Назначение: отображает название экрана "Поиск по штрих-коду".
  - Взаимодействие: отсутствует.
- **Кнопка закрытия** (стрелочка-назад в навигационном баре)
  - Назначение: позволяет закрыть экран и вернуться на предыдущий экран.
  - Взаимодействие: реализована стандартным элементом UINavigationBar.

---

## 2. Основная область
### 2.1. Структура
- **Контейнер камеры** (`CameraCaptureView`)
  - Назначение: отображает поток с камеры для сканирования штрих-кода.
  - Взаимодействие: пользователь наводит камеру на код.
  - Особенности: поддерживаются форматы кодов EAN-13, EAN-8, DataMatrix.
- **Оверлей затемнения** (`viewBlur`, UIView)
  - Назначение: затемняет область камеры, используется для фокуса.
  - Особенности: по центру добавляется иконка фокуса (`scanFocusIco`).
- **Всплывающий слой/оверлей** (`viewSplash`, UIView)
  - Назначение: используется для затемнения и блокировки взаимодействия при определённых состояниях (например, при успешном сканировании).
  - Взаимодействие: тап по оверлею сбрасывает сканирование.
- **Кнопка "Загрузить изображение"** (`buttonUploadImage`, UIButton)
  - Назначение: позволяет выбрать изображение из галереи для распознавания штрих-кода.
  - Взаимодействие: открывает image picker.
  - Особенности: отображается только на iOS 11+.

---

## 3. Нижняя карточка состояния/результата (`ScanCardView`)
### 3.1. Структура и состояния
Карточка реализована как отдельный UIView (`ScanCardView`) и может находиться в одном из трёх состояний:
- **Состояние "prompt" (ожидание сканирования)**
  - **Иконка штрих-кода** (`imageViewIcon`)
  - **Текстовая подсказка** (`labelTitle`): "Наведите камеру на штрих-код товара, чтобы узнать его стоимость"
- **Состояние "loader" (поиск товара)**
  - **Индикатор загрузки** (`loadIndicator`)
- **Состояние "item" (товар найден)**
  - **Карточка товара** (`ItemView`)
    - **Название товара** (`labelName`)
    - **Производитель** (`labelManufacturer`)
    - **Изображение товара** (`imageViewImg`)
    - **Цена** (`labelPrice`)
    - **Количество аптек** (`labelStoresQuantity`)
    - **Кнопка "В корзину"** (`viewBuyButton`)
    - **Кнопка "В избранное"** (`buttonAddToFav`)
    - **Индикатор наличия** (`viewAvailabilityIndex`)
    - **Стикеры** (`collectionViewStickers`)
    - **Блок "Персональный заказ"** (`viewPersonalOrderedContainer`)
    - **Блок предупреждений** (`stackViewWarnings`)
    - **Блок подсказки по избранному** (`viewFavPromptContainer`)
  - **Кнопка "Повторить сканирование"** (`buttonRepeatScan`)
    - Взаимодействие: сбрасывает состояние и возвращает к сканированию.

---

## 4. Всплывающие и дополнительные элементы
- **Алерт запроса доступа к камере**
  - Назначение: появляется при первом запуске или при отсутствии разрешения на камеру.
  - Взаимодействие: кнопки "Запретить" и "Разрешить".
- **Алерт ошибки**
  - Назначение: появляется, если товар не найден или возникла ошибка.
  - Взаимодействие: кнопка "ОК" закрывает алерт и возвращает к сканированию.
- **Алерт системных ошибок**
  - Назначение: отображает текст ошибки, например, при отсутствии соединения.
  - Взаимодействие: после закрытия возвращает к сканированию.

---

## 5. Нижняя навигационная панель
- На экране отсутствует отдельная нижняя навигационная панель. Нижняя часть занята карточкой состояния/результата.

---

## 6. Схематичное дерево иерархии экрана
```
Экран поиска по штрих-коду (ScanItemBarcodeVC)
├── Верхняя панель (navigationItem)
│   ├── Заголовок: "Поиск по штрих-коду"
│   └── Кнопка закрытия (стрелочка-назад)
├── Основная область (viewContainer)
│   ├── Камера (CameraCaptureView)
│   ├── Оверлей затемнения (viewBlur)
│   │   └── Иконка фокуса (UIImageView, scanFocusIco)
│   ├── Всплывающий слой (viewSplash)
│   └── Кнопка "Загрузить изображение" (buttonUploadImage)
├── Нижняя карточка состояния/результата (ScanCardView)
│   ├── Состояние "prompt"
│   │   ├── Иконка штрих-кода (imageViewIcon)
│   │   └── Текстовая подсказка (labelTitle)
│   ├── Состояние "loader"
│   │   └── Индикатор загрузки (loadIndicator)
│   ├── Состояние "item"
│   │   ├── Карточка товара (ItemView)
│   │   │   ├── Название товара (labelName)
│   │   │   ├── Производитель (labelManufacturer)
│   │   │   ├── Изображение товара (imageViewImg)
│   │   │   ├── Цена (labelPrice)
│   │   │   ├── Количество аптек (labelStoresQuantity)
│   │   │   ├── Кнопка "В корзину" (viewBuyButton)
│   │   │   ├── Кнопка "В избранное" (buttonAddToFav)
│   │   │   ├── Индикатор наличия (viewAvailabilityIndex)
│   │   │   ├── Стикеры (collectionViewStickers)
│   │   │   ├── Блок "Персональный заказ" (viewPersonalOrderedContainer)
│   │   │   ├── Блок предупреждений (stackViewWarnings)
│   │   │   └── Блок подсказки по избранному (viewFavPromptContainer)
│   │   └── Кнопка "Повторить сканирование" (buttonRepeatScan)
├── Всплывающие элементы
│   ├── Алерт запроса доступа к камере
│   ├── Алерт ошибки (товар не найден)
│   └── Алерт системных ошибок
└── [Нижняя навигационная панель отсутствует]
```

---

## [Нужно дополнить]
- Не все тексты и иконки видны в XIB, часть задаётся через локализацию и TextProvider.
- Не все состояния алертов и их внешний вид можно описать без дополнительных макетов/кода.
- Не описаны возможные анимации и переходы между экранами (например, переход к деталям товара). 