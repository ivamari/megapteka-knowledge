# Краткая сводка по заказу (OrderBriefVC)

## Описание и назначение экрана
Экран предназначен для отображения краткой сводки по заказу пользователя: список товаров с подробной информацией, предупреждения о возможных несовместимостях препаратов, а также возможность распечатать или поделиться сводкой. Экран используется в сценарии просмотра информации о заказе после его оформления или в истории заказов.

## Общая иерархия экрана
Экран реализован на базе UIViewController (`OrderBriefVC`) с использованием UITableView для отображения основного контента в виде секций. Разметка построена через XIB-файл, нижняя часть экрана содержит фиксированную кнопку.

---

## 1. Верхняя панель (Navigation Bar)
### 1.1. Назначение и элементы
- **Заголовок**: "Краткая сводка по заказу" (устанавливается через `navigationItem.title`)
- **Кнопка "Поделиться"**: появляется справа, если заказ доступен для экспорта (логика отображения управляется через `displayShareBarButton`). При нажатии открывается системное меню шаринга (метод `openShare`).
- **Кнопка "Назад"**: стандартная системная кнопка навигации.

---

## 2. Основная область (основной контент)
Основная область реализована через `UITableView` (`tableView`), размещённую в вертикальном `UIStackView`.

### 2.1. Секции и их элементы

#### Секция 1: Список товаров заказа
- **Тип секции**: `.items` (OrderBriefVC.Section.items)
- **Ячейка**: `OrderBriefItemView` (XIB: `OrderBriefItemView.xib`)
- **Содержимое ячейки**:
  - Изображение товара (`ItemImageView`)
  - Название товара (`ExtendedHitLabel` — labelName)
  - Производитель (`ExtendedHitLabel` — labelManufacturer)
  - Краткое описание/инструкция (`UITextView` — textViewBrief)
  - Разделитель (`UIView` — viewSeparatorBottom)
- **Особенности**:
  - Если описание отсутствует, поле скрывается.
  - Для последней ячейки разделитель скрывается.
  - Ячейки не интерактивны (нет переходов).

#### Секция 2: Предупреждения о заказе
- **Тип секции**: `.warnings` (OrderBriefVC.Section.warnings)
- **Ячейка**: `WarningInCellView` (использует внутри `WarningView`)
- **Содержимое предупреждения (`WarningView`)**:
  - Текст предупреждения (`DescriptionTextView` — поддерживает html, ссылки, выделение)
  - Кнопка действия (`UIButton` — buttonAction), появляется если в предупреждении есть действие (например, "Узнать подробнее")
  - Кнопка закрытия (`ExtendedHitButton` — buttonClose), появляется если предупреждение можно закрыть
- **Особенности**:
  - Цвет и фон блока зависят от типа предупреждения (style.bgColor)
  - Ссылки в тексте могут открывать внешние URL или показывать подробности (Alert)
  - Кнопка действия может открывать ссылку или выполнять другое действие (см. actionHandler)
  - Предупреждения отображаются только если они есть в заказе

---

## 3. Всплывающие и дополнительные элементы
- **Alert**: Модальное окно с подробной информацией, вызывается при нажатии на "Узнать подробнее" в предупреждении (метод `showAlert`).
- **Индикатор загрузки**: Показывается поверх экрана при загрузке данных или скачивании файла для печати (`LoadIndicatorService`).

---

## 4. Нижняя навигационная панель
- **Фиксированная кнопка**: `UIButton` (`buttonPrint`)
  - Название: "Распечатать"
  - Всегда видна внизу экрана
  - При нажатии инициирует скачивание и открытие файла для печати (метод `onTapPrintBtn` → `interactor?.onTapPrintBtn()`)

- **Системная нижняя панель навигации**: отображается стандартно (TabBarController), содержит кнопки "Главный", "Каталог", "Корзина", "Избранное", "Меню".

---

## 5. Открываемые экраны при взаимодействии с элементами
- **Кнопка "Поделиться" (Navigation Bar)**
  - Открывает: системное меню шаринга (iOS share sheet)
- **Кнопка "Распечатать"**
  - Открывает: системное меню печати/экспорта PDF (через системный share sheet)
- **Ссылки в предупреждениях**
  - Открывают: внешний браузер или Alert (в зависимости от типа ссылки)
- **Кнопка "Узнать подробнее" в предупреждении**
  - Открывает: Alert с подробной информацией
- **Кнопка закрытия предупреждения**
  - Скрывает предупреждение (если предусмотрено)

---

## 6. Схематичное дерево иерархии экрана
```
OrderBriefVC (UIViewController)
├── Верхняя панель (Navigation Bar)
│   ├── Заголовок (navigationItem.title)
│   ├── Кнопка "Поделиться" (UIBarButtonItem)
│   └── Кнопка "Назад" (UIBarButtonItem)
├── Основная область (UIStackView)
│   └── UITableView (tableView)
│       ├── Секция: Товары заказа (OrderBriefItemView)
│       │   ├── Изображение товара (ItemImageView)
│       │   ├── Название (ExtendedHitLabel)
│       │   ├── Производитель (ExtendedHitLabel)
│       │   ├── Краткое описание (UITextView)
│       │   └── Разделитель (UIView)
│       └── Секция: Предупреждения (WarningInCellView)
│           └── WarningView
│               ├── Текст (DescriptionTextView)
│               ├── Кнопка действия (UIButton)
│               └── Кнопка закрытия (ExtendedHitButton)
├── Всплывающие элементы
│   └── Alert (UIAlertController)
├── Индикатор загрузки (LoadIndicatorService)
└── Нижняя панель
    ├── Кнопка "Распечатать" (UIButton)
    └── Системная панель навигации (TabBar)
```

---

## [Нужно дополнить]
- Не хватает информации о точной структуре и внешнем виде предупреждений (WarningView), если используются кастомные стили или дополнительные элементы.
- Не все состояния предупреждений (например, с кнопкой закрытия) можно гарантировать по коду — требуется уточнение по дизайну.
- Не описаны возможные ошибки при печати/шаринге — требуется уточнение сценариев обработки ошибок.
- Не описаны возможные дополнительные состояния (например, пустой заказ, ошибки загрузки).

--- 