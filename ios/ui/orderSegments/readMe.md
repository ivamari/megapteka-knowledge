# Экран "Мои заказы" (`OrderSegmentsVC`)

## Описание и назначение экрана

Экран предназначен для просмотра истории и статусов заказов пользователя, а также для просмотра купленных товаров. Пользователь может переключаться между вкладками "Заказы" и "Товары", фильтровать заказы по годам, просматривать детали заказа, удалять заказы, видеть предупреждения и подсказки, а также переходить к каталогу для новых покупок.

## Общая иерархия экрана

Экран реализован на базе UIViewController (`OrderSegmentsVC`). Содержит верхнюю панель с заголовком и сегментированным контролом, основную область с динамически подгружаемым контентом (вкладки "Заказы" — `OrdersVC`, "Товары" — `OrderItemsVC`). Внутри вкладок используются UITableView и UICollectionView для отображения списков, секций и фильтров.

---

## 1. Верхняя панель

### 1.1. Назначение и элементы

- **Заголовок экрана** (`navigationItem.title`)
  - Название: "Мои заказы"
  - Отображается всегда.
- **Сегментированный контрол** (`OrdersSegmentedControl`)
  - Варианты: "Заказы", "Товары"
  - Позволяет переключаться между двумя основными вкладками.
  - При смене вкладки меняется содержимое основной области.

---

## 2. Основная область (основной контент)

Основная область динамически меняется в зависимости от выбранной вкладки.

### 2.1. Вкладка "Заказы" (`OrdersVC`)

#### Секции и их элементы (в порядке отображения):

- **Фильтр по годам** (`OrdersListFiltersView`)
  - Горизонтальный список годов (2024, 2023, 2022, 2021 и т.д.).
  - Позволяет фильтровать заказы по году.
  - Реализован через UICollectionView.
  - При выборе года обновляется список заказов.
  - Может быть скрыт, если нет заказов или пользователь не авторизован.

- **Вкладки "Заказы/Товары"** (`OrdersSegmentedControl`)
  - Переключает между списком заказов и списком купленных товаров.
  - Реализован через кастомный UIView.

- **Секция "Активные заказы"** (`UITableView`, секция `OrdersListSection.active`)
  - Заголовок: "Активные"
  - **Первая ячейка:**
    - Карточка с мини-картой и кнопкой "Показать заказы на карте"
    - При нажатии открывается экран с картой заказов (`OrdersMapVC`)
    - Эта карточка всегда отображается первой в списке активных заказов, если есть хотя бы один активный заказ
  - **Далее:**
    - Список карточек активных заказов, каждая из которых содержит:
      - Номер заказа
      - Дата
      - Статус (цветная метка и текст, например, "Готов к выдаче", "В обработке")
      - Адрес аптеки
      - Сумма заказа
      - Количество товаров
      - Карусель изображений товаров
      - Кнопка перехода к деталям заказа (стрелка)
      - Кнопка "Удалить" (отображается при свайпе или нажатии на иконку)
    - При нажатии на карточку — переход к деталям заказа (`OrderDetailVC`).
    - При свайпе по заказу — появляется кнопка "Удалить" с подтверждением.

- **Секция "Завершённые заказы"** (`UITableView`, секция `OrdersListSection.over`)
  - Заголовок: "Завершённые"
  - Список завершённых заказов (например, "Выдан", "Отменен").
  - Структура карточки аналогична активным заказам.
  - При нажатии на карточку — переход к деталям заказа (`OrderDetailVC`).
  - При свайпе по заказу — появляется кнопка "Удалить" с подтверждением.

- **Секция предупреждений** (`WarningsTCM`)
  - Отображается, если есть предупреждения (например, о неавторизованности).
  - Содержит текст и кнопку для перехода к авторизации или другим действиям.
  - Может быть скрыта.

- **Секция подсказок/промптов** (`FlexiblePromptView`)
  - Отображается, если есть подсказки (например, "Не потеряйте все ваши данные").
  - Содержит текст, кнопку действия (например, "Войти", "Перейти в каталог").
  - Может быть скрыта.

- **Пустое состояние**
  - Если нет заказов, отображается иллюстрация и текст "У вас пока нет заказов" или "У вас пока нет выкупленных товаров".
  - Кнопка "Войти" или "Перейти в каталог" (в зависимости от состояния).

#### Особенности отображения:
- Некоторые секции (фильтры, предупреждения, подсказки) отображаются только при определённых условиях.
- Список заказов разделён на активные и завершённые.
- Для неавторизованных пользователей отображается предупреждение и ограниченный функционал.

#### Взаимодействие пользователя:
- Скроллинг по списку заказов.
- Свайп по заказу для удаления.
- Нажатие на заказ — переход к деталям.
- Нажатие на фильтр года — фильтрация списка.
- Нажатие на кнопку "Показать заказы на карте" — открытие карты.
- Нажатие на подсказки/ворнинги — переход к авторизации или каталогу.

---

### 2.2. Вкладка "Товары" (`OrderItemsVC`)

- **Таблица купленных товаров** (`UITableView`)
  - Список всех купленных товаров за выбранный год.
  - Каждая ячейка содержит:
    - Название товара
    - Количество
    - Цена за единицу и общая цена
    - Производитель
    - Изображение товара
  - При нажатии на товар — переход к деталям товара (`ItemDetailVC`).
  - Если товаров нет — отображается пустое состояние с иллюстрацией и текстом.

- **Поисковая строка** (`SearchBarService`)
  - Отображается только на вкладке "Товары".
  - Позволяет искать товары по названию.
  - При вводе текста фильтрует список товаров.

- **Пустое состояние**
  - Если нет купленных товаров — отображается иллюстрация и текст "У вас пока нет выкупленных товаров".
  - Кнопка "Перейти в каталог".

#### Особенности отображения:
- Поисковая строка появляется только на вкладке "Товары".
- Список товаров фильтруется по году и поисковому запросу.

#### Взаимодействие пользователя:
- Скроллинг по списку товаров.
- Поиск по названию.
- Нажатие на товар — переход к деталям.
- Нажатие на кнопку "Перейти в каталог" — переход в каталог.

---

## 3. Всплывающие и дополнительные элементы

- **Алерт подтверждения удаления заказа**
  - Появляется при попытке удалить заказ.
  - Содержит текст "Вы уверены, что хотите удалить заказ?" и кнопки "Да"/"Нет".
  - После подтверждения заказ удаляется из списка.

- **Ворнинги и подсказки**
  - Могут появляться поверх основного контента.
  - Содержат текст и кнопки для действий (например, авторизация, переход в каталог).

---

## 4. Нижняя навигационная панель

- **TabBar (UITabBarController)**
  - Кнопки: Главный, Каталог, Корзина, Избранное, Меню.
  - Позволяет переходить между основными разделами приложения.
  - Отображается всегда.

---

## 5. Открываемые экраны при взаимодействии с элементами

- **Карточка заказа** — открывает детали заказа (`OrderDetailVC`)
- **Кнопка "Показать заказы на карте"** — открывает карту заказов (`OrdersMapVC`)
- **Кнопка "Удалить"** — вызывает алерт подтверждения
- **Кнопка "Войти"** — открывает экран авторизации (`AuthLoginVC`)
- **Кнопка "Перейти в каталог"** — открывает каталог (`CatalogueVC`)
- **Карточка товара** — открывает детали товара (`ItemDetailVC`)

---

## 6. Схематичное дерево иерархии экрана

```
Экран "Мои заказы" (OrderSegmentsVC)
├── Верхняя панель (UINavigationBar)
│   ├── Заголовок "Мои заказы"
│   └── Сегментированный контрол "Заказы/Товары" (OrdersSegmentedControl)
├── Основная область (UIView)
│   ├── [Вкладка "Заказы" (OrdersVC)]
│   │   ├── Фильтр по годам (OrdersListFiltersView)
│   │   ├── Секция предупреждений (WarningsTCM) [условно]
│   │   ├── Секция подсказок/промптов (FlexiblePromptView) [условно]
│   │   ├── Секция "Активные заказы" (UITableView, OrdersListSection.active)
│   │   │   ├── Первая ячейка: Карточка с мини-картой и кнопкой "Показать заказы на карте"
│   │   │   └── Далее: Карточки заказов (OrderCell)
│   │   ├── Секция "Завершённые заказы" (UITableView, OrdersListSection.over)
│   │   │   └── Карточки заказов (OrderCell)
│   │   └── Пустое состояние (UIView) [условно]
│   └── [Вкладка "Товары" (OrderItemsVC)]
│       ├── Поисковая строка (SearchBarService)
│       ├── Таблица купленных товаров (UITableView)
│       │   └── Ячейки товаров (OrderItemCell)
│       └── Пустое состояние (UIView) [условно]
├── Всплывающие элементы
│   ├── Алерт подтверждения удаления заказа (UIAlertController)
│   └── Ворнинги/подсказки (FlexiblePromptView, WarningsTCM)
└── Нижняя навигационная панель (UITabBar)
    ├── Главный
    ├── Каталог
    ├── Корзина
    ├── Избранное
    └── Меню
```

---

## [Нужно дополнить]

- Не хватает информации о точных названиях и структуре ячеек заказов и товаров (OrderCell, OrderItemCell) — требуется изучить соответствующие классы.
- Не все состояния ворнингов и подсказок видны на скриншотах — требуется уточнение по бизнес-логике.
- Не все возможные фильтры и их поведение описаны — требуется изучить OrdersListFiltersInfo.
- Для некоторых переходов (например, детали товара) не определён точный класс экрана — требуется уточнение.

--- 