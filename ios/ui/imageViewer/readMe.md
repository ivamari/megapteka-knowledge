# Экран просмотра изображений (ImageViewer)

## Описание и назначение экрана
Экран предназначен для просмотра изображений товара в увеличенном виде с возможностью пролистывания между несколькими изображениями, просмотра миниатюр, а также закрытия экрана. Пользователь может рассмотреть детали упаковки, переключаться между фотографиями, видеть подпись "Фото от производителя" (если изображение предоставлено производителем) и закрывать просмотр.

## Общая иерархия экрана
Экран реализован на базе `UIPageViewController` (ImageCarouselViewController), поверх которого размещены дополнительные элементы управления (кнопка закрытия, подпись, коллекция миниатюр). Основная область — это карусель изображений с возможностью пролистывания свайпом. В нижней части экрана отображается горизонтальная коллекция миниатюр (UICollectionView), которая реализует кастомный page control с индикацией текущего выбранного изображения. Верхняя панель содержит кнопку закрытия и, при необходимости, подпись "Фото от производителя".

---

## 1. Верхняя панель
### 1.1. Назначение и элементы
- **Кнопка закрытия (ExtendedHitButton)**
  - Назначение: закрывает экран просмотра изображений.
  - Взаимодействие: нажатие закрывает модальное окно (`dismiss`).
  - Особенности: иконка крестика, увеличенная зона нажатия, тень, размещена справа вверху с отступом от safeArea.
- **Подпись "Фото от производителя" (UILabel/UIView)**
  - Назначение: информирует пользователя, что изображение предоставлено производителем и может содержать рекламный характер.
  - Взаимодействие: неинтерактивный элемент.
  - Особенности: размещена по центру экрана под статус-баром, стилизована с иконкой камеры и скруглённым фоном.
  - Логика отображения: появляется только у тех изображений, для которых флаг "фото от производителя" приходит через API метод.

---

## 2. Основная область (основной контент)
- **Карусель изображений (UIPageViewController, ImageCarouselViewController)**
  - Назначение: отображает выбранное изображение на весь экран, позволяет листать изображения свайпом влево/вправо.
  - Вложенные элементы:
    - **Контроллер изображения (ImageViewerController)**
      - **Изображение (UIImageView)**
        - Назначение: отображает текущее изображение.
        - Взаимодействие: поддерживает жесты зумирования (пинч, дабл-тап), свайп вниз для закрытия, панорамирование.
        - Особенности: изображение центрируется, поддерживает увеличение/уменьшение, двойной тап увеличивает/уменьшает масштаб, свайп вниз сдвигает изображение и уменьшает прозрачность фона, при достаточном смещении — закрывает экран.
      - **ScrollView (UIScrollView)**
        - Назначение: обеспечивает поддержку масштабирования и прокрутки изображения.
        - Особенности: отключена автоматическая корректировка inset, скрыты индикаторы прокрутки.

---

## 2.1. Секции и их элементы
- **Секция: Основное изображение**
  - Содержит: UIImageView внутри UIScrollView.
  - Взаимодействие: свайп, зум, двойной тап, свайп вниз для закрытия.
- **Секция: Миниатюры изображений (UICollectionView, collectionViewPreview)**
  - Назначение: реализует кастомный page control — отображает миниатюры всех доступных изображений в горизонтальном списке и индицирует текущее выбранное изображение.
  - Вложенные элементы:
    - **Ячейка миниатюры (ImageViewerPreview)**
      - Содержит: UIImageView с миниатюрой.
      - Особенности: скруглённые углы, белый фон, при выборе — цветная рамка, выбранная миниатюра выделена.
  - Взаимодействие: нажатие на миниатюру переключает основное изображение на выбранное, происходит анимация и смена текущей страницы.
  - Особенности: коллекция фиксированной высоты, занимает всю ширину экрана, появляется в нижней части экрана над безопасной зоной.

---

## 3. Всплывающие и дополнительные элементы
- **Отсутствуют** — на экране нет дополнительных всплывающих окон, алертов или ворнингов.

---

## 4. Нижняя навигационная панель
- **Отсутствует** — на экране не реализована нижняя навигационная панель, элементы управления размещены поверх основного контента.

---

## 5. Открываемые экраны при взаимодействии с элементами
- **Кнопка закрытия (ExtendedHitButton)**
  - Открывает: Закрывает текущий экран (dismiss текущего модального окна ImageCarouselViewController).
- **Миниатюра изображения (ImageViewerPreview)**
  - Открывает: Переключает основное изображение в текущем экране (ImageViewerController).
- **Свайп вниз по изображению**
  - Открывает: Закрывает текущий экран (dismiss текущего модального окна ImageCarouselViewController).
- **Двойной тап по изображению**
  - Открывает: Увеличивает/уменьшает масштаб изображения (zoom in/out внутри ImageViewerController).
- **Пинч по изображению**
  - Открывает: Уменьшает масштаб изображения (zoom out внутри ImageViewerController).

---

## 6. Схематичное дерево иерархии экрана
```
Экран просмотра изображений (ImageCarouselViewController)
├── Верхняя панель
│   ├── Кнопка закрытия (ExtendedHitButton)
│   └── Подпись "Фото от производителя" (UILabel/UIView) [отображается только если флаг приходит через API]
├── Основная область
│   └── Карусель изображений (UIPageViewController)
│       └── Контроллер изображения (ImageViewerController)
│           └── ScrollView (UIScrollView)
│               └── Изображение (UIImageView)
├── Кастомный page control — коллекция миниатюр (UICollectionView)
│   └── Ячейка миниатюры (ImageViewerPreview)
│       └── Миниатюра (UIImageView)
```