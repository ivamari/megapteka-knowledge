# Сообщить об ошибке (ItemErrorFeedbackVC)

## Описание и назначение экрана

Экран предназначен для отправки пользователем обратной связи о найденной ошибке в карточке товара. Пользователь может выбрать тип ошибки (например, ошибка в тексте или неправильная картинка), добавить комментарий и прикрепить фотографию, подтверждающую ошибку. Экран реализован как модальное окно (sheet), вызываемое из карточки товара.

## Общая иерархия экрана

Экран построен на базе `UIViewController` (`ItemErrorFeedbackVC`) с использованием вертикального `UIStackView` для основной разметки. Внутри основной области размещены: заголовок, кнопка закрытия, скроллируемая область с выбором типа ошибки, полем для комментария, блоком для добавления/просмотра фото и кнопкой отправки.

---

## 1. Верхняя панель

### 1.1. Назначение и элементы

- **Заголовок** (`UILabel`, outlet: `labelTitle`)
  - Отображает текст "Сообщить об ошибке".
  - Центрирован по горизонтали.
  - Стиль: жирный, крупный шрифт.
- **Кнопка закрытия** (`ExtendedHitButton`, outlet: `buttonClose`)
  - Иконка "крестик" в правом верхнем углу.
  - Расширенная зона нажатия.
  - При нажатии закрывает экран (dismiss).

---

## 2. Основная область (основной контент)

Вся основная область размещена внутри `UIScrollView` для поддержки прокрутки на малых экранах.

### 2.1. Секции и их элементы

#### 2.1.1. Выбор типа ошибки (`UIStackView`, outlet: `stackViewTypes`)

- Каждый тип ошибки представлен отдельным элементом (`ItemErrorFeedbackTypeView`):
  - **Контейнер** (`HighlightedView`, outlet: `viewContainer`)
    - Реализует визуальный эффект выделения при нажатии.
    - Обрабатывает нажатие для выбора/снятия выбора.
  - **Текст типа ошибки** (`UILabel`, outlet: `labelText`)
    - Отображает название типа ошибки (например, "Ошибка в тексте", "Неправильная картинка").
  - **Иконка выбора** (`UIImageView`, outlet: `imageViewChecked`)
    - Галочка, отображается только если тип выбран.
  - **Разделитель** (`UIView`, outlet: `viewSeparator`)
    - Горизонтальная линия между элементами.
- Возможные типы ошибок (формируются из модели):
  - "Ошибка в тексте"
  - "Неправильная картинка"
- Пользователь может выбрать один или оба типа ошибки.
- При нажатии на элемент — меняется состояние выбора (галочка появляется/исчезает).

#### 2.1.2. Поле для комментария (`ViTextView`, outlet: `textViewComment`)

- Многострочное текстовое поле с плейсхолдером "Комментарий (при желании)".
- Поддерживает ввод и редактирование текста.
- Плейсхолдер скрывается при вводе.
- Автоматически увеличивает высоту при вводе большого объема текста.
- При фокусе появляется клавиатура, реализована поддержка скрытия клавиатуры по тапу вне поля.

#### 2.1.3. Блок добавления/просмотра фото (`PhotoAttachmentView`, outlet: `viewPhotoAttach`)

- **Состояние 1: Фото не выбрано**
  - **Контейнер с пунктирной рамкой** (`DashedBorderView`, outlet: `viewAddContainer`)
    - В центре — иконка "+" (`UIImageView`, outlet: `imageViewAdd`) и подпись "Добавить фото" (`UILabel`, outlet: `labelAdd`).
    - Вся область кликабельна (`HighlightedView`, outlet: `viewAddTappable`).
    - При нажатии открывается выбор фото (камера или галерея).
- **Состояние 2: Фото выбрано**
  - **Контейнер с фото** (`UIView`, outlet: `viewPhotoContainer`)
    - **Изображение** (`UIImageView`, outlet: `imageViewPhoto`)
      - Отображает выбранное или сделанное фото.
      - Масштабируется по размеру контейнера, скругленные углы.
    - **Кнопка удаления** (`UIButton`, outlet: `buttonRemove`)
      - Иконка "крестик" в правом верхнем углу фото.
      - При нажатии удаляет фото и возвращает блок в состояние "добавить фото".
- Только одно фото может быть прикреплено одновременно.

---

## 3. Всплывающие и дополнительные элементы

- **Модальное окно/Sheet**
  - Экран реализован как модальное окно, появляющееся поверх основного контента.
  - Размер окна динамически подстраивается под контент.
- **Алерты**
  - При ошибке отправки или отсутствии обязательных данных может появляться системный алерт с сообщением об ошибке.
- **Индикатор загрузки**
  - При отправке формы отображается индикатор загрузки.

---

## 4. Нижняя навигационная панель

- На экране отсутствует нижняя навигационная панель.

---

## 5. Схематичное дерево иерархии экрана

```
Экран "Сообщить об ошибке" (ItemErrorFeedbackVC)
├── Верхняя панель
│   ├── Заголовок (UILabel, labelTitle)
│   └── Кнопка закрытия (ExtendedHitButton, buttonClose)
├── Основная область (UIScrollView, scrollView)
│   └── Вертикальный стек (UIStackView)
│       ├── Секция выбора типа ошибки (UIStackView, stackViewTypes)
│       │   ├── Элемент типа ошибки (ItemErrorFeedbackTypeView)
│       │   │   ├── Контейнер (HighlightedView, viewContainer)
│       │   │   ├── Текст типа (UILabel, labelText)
│       │   │   ├── Галочка (UIImageView, imageViewChecked)
│       │   │   └── Разделитель (UIView, viewSeparator)
│       ├── Поле комментария (ViTextView, textViewComment)
│       ├── Блок фото (PhotoAttachmentView, viewPhotoAttach)
│       │   ├── [Состояние 1] Добавить фото:
│       │   │   ├── Контейнер с пунктиром (DashedBorderView, viewAddContainer)
│       │   │   ├── Кликабельная область (HighlightedView, viewAddTappable)
│       │   │   ├── Иконка "+" (UIImageView, imageViewAdd)
│       │   │   └── Подпись (UILabel, labelAdd)
│       │   └── [Состояние 2] Фото выбрано:
│       │       ├── Контейнер с фото (UIView, viewPhotoContainer)
│       │       ├── Изображение (UIImageView, imageViewPhoto)
│       │       └── Кнопка удаления (UIButton, buttonRemove)
│       └── Кнопка отправки (UIButton, buttonSend)
└── [Всплывающие элементы]
    ├── Модальное окно (sheet)
    ├── Алерты ошибок
    └── Индикатор загрузки
```

---

## [Нужно дополнить]

- Точные тексты для типов ошибок, плейсхолдера и кнопки отправки берутся из `TextProvider.Item.ErrorFeedback`, их значения не определены в коде (требуется уточнение у разработчика или в ресурсах).
- Не описаны стили (цвета, шрифты) для всех элементов, если они кастомные и не стандартные.
- Не описан механизм обработки ошибок при отправке (какие именно ошибки могут быть и как отображаются).
- Не описан механизм ограничения на размер/тип фото (если есть).
- Не описан механизм работы с клавиатурой на iPad (если отличается).
- Не описан механизм доступности (VoiceOver и др.). 