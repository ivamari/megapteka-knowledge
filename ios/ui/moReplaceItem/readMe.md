# Экран замены товара в заказе (MOReplaceItemVC)

## Описание и назначение экрана
Экран предназначен для выбора замены товара в заказе пользователя. Пользователь может выбрать аналогичный товар по различным критериям (ATX-классификация, действующее вещество, эффект от применения, похожие товары) и заменить им исходный товар в заказе. Экран используется в сценарии оформления или редактирования заказа, когда требуется подобрать замену недоступному или изменённому товару.

## Общая иерархия экрана
Экран реализован на базе UIViewController (`MOReplaceItemVC`) и содержит основную область с таблицей (`UITableView`), в которой отображаются секции с вариантами замены. Каждая строка (ячейка) реализована через кастомное представление (`MOReplaceItemView`). Разметка построена с помощью XIB-файлов.

---

## 1. Верхняя панель
### 1.1. Назначение и элементы
- **Отсутствует стандартная верхняя панель навигации** (скрыта через `hiddenNavBar: true`).
- Визуально в верхней части экрана отображается заголовок "Замена товара в заказе" (секция заголовка таблицы).
- **Элемент:**
  - Заголовок (SectionNameHeaderView) — отображает название экрана.

---

## 2. Основная область (основной контент)
Основная область реализована через `UITableView` (tableView), в которой отображаются секции:

### 2.1. Секции и их элементы

- **Секция: Заголовок**
  - Назначение: отображение заголовка экрана.
  - Элемент: заголовок (SectionNameHeaderView).
  - Особенности: всегда отображается первой.

- **Секция: Лоадер**
  - Назначение: отображение индикатора загрузки, пока не получены данные о товарах-заменах.
  - Элемент: LoaderView (LoaderModel).
  - Особенности: отображается только при отсутствии данных (items == nil).

- **Секция: Список товаров-замен**
  - Назначение: отображение списка возможных замен для выбранного товара.
  - Элементы: каждая строка — это карточка товара-замены (`MOReplaceItemView`).
  - Особенности: количество строк соответствует количеству найденных аналогов.

#### Элементы карточки товара-замены (`MOReplaceItemView`):
- **Блок типа замены**
  - Назначение: отображение критерия, по которому найден аналог (например, "По ATX классификации", "По действующему веществу", "По эффекту от применения", "Похожие товары").
  - Элемент: контейнер с цветным фоном и текстовой меткой (`viewReplacementType`, `labelReplacementType`).
  - Особенности: цвет и текст зависят от типа аналога (`analogueTypeId`). Может быть скрыт, если тип не определён.

- **Название товара** (`labelName`)
  - Назначение: отображение полного названия товара-замены.

- **Изображение товара** (`imageViewImg`)
  - Назначение: отображение фотографии товара.

- **Производитель** (`labelManufacturer`)
  - Назначение: отображение названия производителя.

- **Стикеры** (`collectionViewStickers`)
  - Назначение: отображение стикеров/значков, связанных с товаром (например, "Рецептурный препарат").
  - Особенности: отображается только если есть стикеры.

- **Цена** (`labelPrice`)
  - Назначение: отображение минимальной цены товара.

- **Количество аптек** (`labelStoresQuantity`)
  - Назначение: отображение информации о количестве аптек, где доступен товар.
  - Особенности: скрывается, если информация отсутствует.

- **Кнопка "В избранное"** (`buttonAddToFav`)
  - Назначение: добавление/удаление товара из избранного.
  - Взаимодействие: при нажатии добавляет или убирает товар из списка избранного пользователя.

- **Кнопка "Выбрать"** (`buttonChoose`)
  - Назначение: выбор данного товара в качестве замены.
  - Взаимодействие: при нажатии происходит замена товара в заказе и закрытие экрана.

- **Разделитель** (`viewSeparatorBottom`)
  - Назначение: визуальное разделение карточек товаров.
  - Особенности: скрывается для последней карточки.

---

## 3. Всплывающие и дополнительные элементы
- **Алерты об ошибках**
  - Назначение: отображение ошибок загрузки данных или других проблем.
  - Условия показа: при возникновении ошибки при загрузке аналогов товара.
  - Взаимодействие: стандартное взаимодействие с алертами iOS.

---

## 4. Нижняя навигационная панель
- **Отсутствует**. Нижняя панель навигации не используется на данном экране. В случае отображения в модальном окне, нижняя панель модального окна может быть скрыта.

---

## 5. Открываемые экраны при взаимодействии с элементами

- **Кнопка "Выбрать"** (buttonChoose в MOReplaceItemView)
  - Открывает: не открывает новый экран, а вызывает делегат для замены товара и закрывает текущий экран (MOReplaceItemVC).

- **Кнопка "В избранное"** (buttonAddToFav в MOReplaceItemView)
  - Открывает: не открывает новый экран, изменяет состояние избранного для товара.

- **Ячейка товара** (MOReplaceItemView)
  - Открывает: не открывает новый экран, но может вызывать обработчик выбора.

---

## 6. Схематичное дерево иерархии экрана
```
Экран замены товара (MOReplaceItemVC)
├── Основная область (UIView)
│   └── Вертикальный стек (UIStackView)
│       └── Таблица (UITableView)
│           ├── Секция: Заголовок (SectionNameHeaderView)
│           ├── Секция: Лоадер (LoaderView) [отображается при загрузке]
│           └── Секция: Список товаров-замен
│               └── Ячейка товара-замены (MOReplaceItemView)
│                   ├── Блок типа замены (viewReplacementType, labelReplacementType)
│                   ├── Название товара (labelName)
│                   ├── Изображение товара (imageViewImg)
│                   ├── Производитель (labelManufacturer)
│                   ├── Стикеры (collectionViewStickers)
│                   ├── Цена (labelPrice)
│                   ├── Количество аптек (labelStoresQuantity)
│                   ├── Кнопка "В избранное" (buttonAddToFav)
│                   ├── Кнопка "Выбрать" (buttonChoose)
│                   └── Разделитель (viewSeparatorBottom)
```