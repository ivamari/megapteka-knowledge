# Описание и назначение экрана (OrderDetailVC)

Экран "О заказе" предназначен для отображения полной информации о заказе пользователя: статус, состав, аптека для самовывоза, итоговая сумма, а также для управления заказом (повторить, отменить, сменить аптеку и др.). Экран поддерживает различные состояния заказа (новый, отменён, выдан и др.), отображает предупреждения, позволяет оценить заказ, поделиться им, просмотреть карту и детали аптеки.

---

## Общая иерархия экрана

Экран реализован на основе `UIViewController` (`OrderDetailVC`) с единственным основным элементом — таблицей (`UITableView`). Вся разметка и логика построены на секциях и ячейках таблицы, каждая из которых отвечает за отдельный блок информации или управления.

---

## 1. Верхняя панель

### 1.1. Назначение и элементы

- Заголовок: "О заказе" (`navigationItem.title`)
- Кнопка "Назад" (системная)
- Кнопка "Поделиться" (отображается, если есть ссылка на заказ) вызывает системное меню для отправки ссылки на заказ

---

## 2. Основная область (основной контент)

Основная область реализована через `UITableView` (`tableView`), секции и ячейки которой динамически формируются в зависимости от состояния заказа.

### 2.1. Секции и их элементы

#### 2.1.1. Статус заказа (`OrderDetailStatusView`)
- **Назначение:** Отображение номера заказа, статуса (например, "отменен", "выдан", "ожидает подтверждения"), кнопок "увеличить", "озвучить".
- **Элементы:**
  - Номер заказа (`labelNumber`)
  - Кнопка "увеличить" (`buttonEnlarge`)
  - Кнопка "озвучить" (`buttonPlaySound`)
  - Название статуса (`labelStatusName`)
- **Взаимодействие:** 
  - Тап по номеру — копирует номер заказа и показывает тултип.
  - Кнопка "увеличить" — открывает подробную информацию о заказе (`OrderEnlargedVC`).
  - Кнопка "озвучить" — воспроизводит номер заказа голосом.

#### 2.1.2. Информационный блок (`OrderDetailInfoView`)
- **Назначение:** Краткая информация о заказе (например, дата, способ получения).
- **Элементы:** Текстовое поле (`labelText`).

#### 2.1.3. Блок "Поделиться приложением" (`OrderDetailShareView`)
- **Назначение:** Предложение поделиться приложением и получить выгоду.
- **Элементы:**
  - Заголовок, описание, кнопка "Поделиться".
- **Взаимодействие:** Кнопка вызывает системное меню для отправки ссылки на приложение.

#### 2.1.4. Оценка заказа (`OrderDetailRateView`)
- **Назначение:** Возможность поставить оценку заказу.
- **Элементы:** Заголовок, звёздный рейтинг (`CosmosView`).
- **Взаимодействие:** Выбор оценки отправляет рейтинг.

#### 2.1.5. Дополнительная информация по заказу (`OrderDetailDeliveryView`)
- **Назначение:** Отображение дополнительной информации по статусу заказа (например, причины отмены, превышение сроков).
- **Элементы:** Текстовое поле с выделением важных фрагментов.

#### 2.1.6. Информация об аптеке для самовывоза (`OrderDetailStoreView`)
- **Назначение:** Отображение адреса, бренда, метро, расстояния, расписания, доступности, кнопок "Построить маршрут" и "Как найти вход?".
- **Элементы:**
  - Адрес аптеки (с возможностью нажатия)
  - Метро, бренд, расстояние, расписание, доступность для маломобильных
  - Кнопки "Построить маршрут", "Как найти вход?"
- **Взаимодействие:** 
  - Тап по адресу — открывает экран карты (`StoresMapVC`) с отображением выбранной аптеки на карте.
  - Кнопка "Как найти вход?" — открывает подробности входа.

#### 2.1.7. Предупреждения по аптеке (`WarningsTCM`)
- **Назначение:** Отображение предупреждений, связанных с аптекой (например, временно закрыта).
- **Элементы:** Список предупреждений.

#### 2.1.8. Карта аптеки (`OrderDetailMapView`)
- **Назначение:** Мини-карта с местоположением аптеки.
- **Взаимодействие:** Тап по карте — открывает подробную карту.

#### 2.1.9. Трекер заказа (`OrderDetailTrackListView`)
- **Назначение:** Кнопки для добавления заказа в Apple Wallet, Live Activities и др.
- **Элементы:** Коллекция кнопок, информационный блок с иконкой и текстом, расположенный под кнопками.
- **Взаимодействие:** 
  - Тап по кнопкам — добавляет заказ в соответствующий сервис.
  - Тап по информационному блоку — открывает экран пояснения (`ModalPromptVC`), где объясняется для чего нужно и как работает добавление заказа в Wallet и Live Activities.

#### 2.1.10. Состав заказа (`OrderDetailItemsCM` + `OrderDetailItemView`)
- **Назначение:** Список товаров в заказе.
- **Элементы для каждого товара:**
  - Картинка, название, производитель, количество, цена, доступность, причина скидки, кнопка "Подробнее", описание.
- **Взаимодействие:** 
  - Кнопка "Подробнее" — раскрывает описание товара.
  - Тап по товару — открывает подробную карточку товара.

#### 2.1.11. Предупреждения по заказу (`WarningsTCM`)
- **Назначение:** Общие предупреждения по заказу.
- **Элементы:** Список предупреждений.

#### 2.1.12. Итоговая сумма заказа (`OrderDetailTotalView`)
- **Назначение:** Количество товаров и итоговая сумма.
- **Элементы:** Количество, сумма, разделитель.

#### 2.1.13. Текстовые кнопки (`OrderDetailTextButtonView`)
- **Назначение:** Кнопки "Краткая сводка по заказу", "Я выкупил этот заказ" и др.
- **Взаимодействие:** Тап вызывает соответствующее действие.

#### 2.1.14. Основные кнопки действий (`OrderDetailButtonView`)
- **Назначение:** Кнопки "Повторить заказ", "Сменить аптеку", "Удалить заказ", "Отменить заказ".
- **Взаимодействие:** Тап вызывает соответствующее действие или открывает модальное окно.

---

## 3. Всплывающие и дополнительные элементы

- Алерты и тултипы (например, при копировании номера заказа, подтверждении удаления/отмены заказа).
- Модальные окна для выбора причины отмены, подробностей заказа, маршрута и др.
- Всплывающие предупреждения и информационные сообщения.

---

## 4. Нижняя навигационная панель

- Реализована через стандартный `UITabBarController`.
- Кнопки: Главный, Каталог, Корзина, Избранное, Меню.
- Переход между разделами осуществляется по тапу по иконке.

---

## 5. Открываемые экраны при взаимодействии с элементами

- Кнопка "Назад" — возврат к предыдущему экрану.
- Кнопка "Поделиться" — системное меню share.
- Кнопка "Оценить заказ" — открывает экран оценки заказа (`OrderRateVC`).
- Кнопка "Краткая сводка по заказу" — открывает экран сводки (`OrderBriefVC`).
- Кнопка "Удалить заказ" — подтверждение и удаление заказа.
- Кнопка "Повторить заказ" — добавляет в корзину все доступные товары из заказа.
- Кнопка "Сменить аптеку" — открывает выбор аптеки (`MOChooseStoreVC`).
- Кнопка "Построить маршрут" — открывает алерт с выбором приложения для построения маршрута (Apple Maps, Google Maps, Яндекс Карты, 2ГИС). После выбора происходит переход в выбранное приложение с построением маршрута до аптеки.
- Кнопка "Как найти вход?" — открывает подробности входа (`StoreEntranceVC`).
- Тап по товару — открывает карточку товара (`ItemDetailVC`).
- Кнопки Apple Wallet/Live Activities — добавляют заказ в соответствующий сервис.
- Тап по адресу аптеки — открывает экран карты (`StoresMapVC`) с отображением выбранной аптеки на карте.

---

## 6. Схематичное дерево иерархии экрана

```
Экран "О заказе" (OrderDetailVC)
├── Верхняя панель (UINavigationBar)
│   ├── Кнопка "Назад"
│   ├── Заголовок "О заказе"
│   └── Кнопка "Поделиться" (если доступна)
├── Основная область (UITableView)
│   ├── Секция: Статус заказа (OrderDetailStatusView)
│   ├── Секция: Информация о заказе (OrderDetailInfoView)
│   ├── Секция: Поделиться приложением (OrderDetailShareView)
│   ├── Секция: Оценка заказа (OrderDetailRateView)
│   ├── Секция: Доп. информация по заказу (OrderDetailDeliveryView)
│   ├── Секция: Аптека для самовывоза (OrderDetailStoreView)
│   ├── Секция: Предупреждения по аптеке (WarningsTCM)
│   ├── Секция: Карта аптеки (OrderDetailMapView)
│   ├── Секция: Трекер заказа (OrderDetailTrackListView)
│   ├── Секция: Состав заказа (OrderDetailItemsCM/OrderDetailItemView)
│   ├── Секция: Предупреждения по заказу (WarningsTCM)
│   ├── Секция: Итоговая сумма (OrderDetailTotalView)
│   ├── Секция: Текстовые кнопки (OrderDetailTextButtonView)
│   └── Секция: Основные кнопки действий (OrderDetailButtonView)
├── Всплывающие элементы (UIAlert, Tooltip, ModalPrompt и др.)
└── Нижняя навигационная панель (UITabBarController)
    ├── Главный
    ├── Каталог
    ├── Корзина
    ├── Избранное
    └── Меню
```

---

## [Нужно дополнить]

- Не все состояния заказа и их отображение можно однозначно описать без анализа всех моделей и TextProvider.
- Не все предупреждения и их типы видны без анализа данных.
- Не все модальные окна и алерты можно перечислить без анализа всех сценариев взаимодействия.
- Не все параметры секций (например, условия показа) можно описать без анализа бизнес-логики и моделей данных.