# Экран: История покупок товара (ItemPersonalOrderedVC)

## Описание и назначение экрана
Экран предназначен для отображения истории покупок конкретного товара пользователем. Здесь пользователь может увидеть, сколько раз и когда он покупал этот товар, в каких аптеках, по каким ценам и в каком количестве. Экран позволяет быстро ознакомиться с деталями прошлых заказов, а также перейти к подробной информации о каждом заказе или увеличить карточку заказа.

## Общая иерархия экрана
Экран реализован на основе `UIViewController` (`ItemPersonalOrderedVC`), основной контент представлен в виде таблицы (`UITableView`) с двумя секциями: информация о товаре и список заказов. Для отображения элементов используются кастомные вью-классы и xib-файлы.

---

## 1. Верхняя панель

### 1.1. Назначение и элементы
- **Заголовок** (`UINavigationItem.title`): динамически отображает название экрана, например, "Вы покупали 7 раз".
- **Кнопка "Назад"** (`UIBarButtonItem`): возвращает пользователя на предыдущий экран.

---

## 2. Основная область (основной контент)

Основная область реализована через `UITableView` с двумя секциями:

### 2.1. Секция 1: Информация о товаре (`ItemPersonalOrderedItemView`)
- **Изображение товара** (`ItemImageView`): слева, отображает фото товара.
- **Название товара** (`ExtendedHitLabel`): справа от изображения, крупный шрифт, до двух строк.
- **Производитель** (`ExtendedHitLabel`): под названием, серый текст.
- **Минимальная цена** (`ExtendedHitLabel`): справа от названия, выделена жирным.
- **Особенности**: 
  - Если нет фото, отображается плейсхолдер.
  - Цена и производитель могут быть скрыты, если данных нет.

### 2.2. Секция 2: Список заказов (`ItemPersonalOrderedOrderView` → `BaseOrderView`)
Каждая ячейка — отдельный заказ, структура:

- **Цветной индикатор статуса** (`ViView`): слева, цвет зависит от статуса заказа.
- **Номер заказа** (`ViLabel`): крупный текст, многострочный.
- **Дата создания заказа** (`ViLabel`): под номером заказа.
- **Статус заказа** (`ViLabel` в цветном фоне): например, "выдан".
- **Аптека (бренд)** (`ViLabel`): жирный текст, название аптеки.
- **Адрес аптеки** (`ViLabel`): под брендом, многострочный.
- **Сумма заказа** (`ViLabel`): справа, крупный шрифт.
- **Кнопка количества товаров** (`ExtendedHitButton`): под суммой, отображает количество позиций, при нажатии раскрывает или скрывает список товаров в заказе.
- **Список товаров заказа** (`OrderItemView`): появляется под основной информацией заказа при раскрытии, содержит по одной строке на каждый товар в заказе.
- **Миниатюры товаров** (`MiniaturePhotoItemView`): справа, до 5 иконок товаров из заказа, последняя — иконка "ещё", если товаров больше.
- **Кнопка увеличения заказа** (`HighlightedView` + `UIImageView`): справа, при нажатии открывает экран увеличенного заказа (`OrderEnlargedVC`).
- **Дополнительная информация по статусу** (`UILabel`): отображается, если есть, на цветном фоне под основным блоком заказа.
- **Особенности**:
  - Ячейка кликабельна: при нажатии открывается экран деталей заказа (`OrderDetailVC`).
  - Кнопка увеличения заказа всегда видна, открывает модальное окно.
  - Кнопка количества товаров интерактивна: при нажатии раскрывает или скрывает список товаров заказа.

---

## 3. Всплывающие и дополнительные элементы

- **Индикатор загрузки** (`LoadIndicatorService`): отображается при загрузке данных.
- **Алерты** (`AlertModel`): всплывающие окна для ошибок и уведомлений.
- **Кнопка чата** (`ButtonWithShadow`, добавляется через `ChatButton.addChatButton(vc:)`): плавающая кнопка в правом нижнем углу, открывает чат с провизором (`BaseChatRouter`).

---

## 4. Нижняя навигационная панель

- **TabBar** (`UITabBarController`): стандартная нижняя панель приложения с разделами "Главный", "Каталог", "Корзина", "Избранное", "Меню".
- **Особенности**: всегда видна, обеспечивает переход между основными разделами приложения.

---

## 5. Открываемые экраны при взаимодействии с элементами

### Интерактивные элементы и открываемые экраны

- **Ячейка заказа** (`BaseOrderView`):
  - Открывает: Экран деталей заказа (`OrderDetailVC`)
- **Кнопка увеличения заказа** (`viewEnlarge` в `BaseOrderView`):
  - Открывает: Экран увеличенного заказа (`OrderEnlargedVC`)
- **Кнопка чата** (`ButtonWithShadow`):
  - Открывает: Экран чата с провизором (`BaseChatRouter`)
- **Кнопка количества товаров** (`ExtendedHitButton`):
  - При нажатии раскрывает или скрывает список товаров в заказе (каждый товар — отдельная строка, `OrderItemView`).

---

## 6. Схематичное дерево иерархии экрана

```
Экран истории покупок товара (ItemPersonalOrderedVC)
├── Верхняя панель (UINavigationBar)
│   ├── Кнопка "Назад" (UIBarButtonItem)
│   └── Заголовок (UINavigationItem.title)
├── Основная область (UITableView)
│   ├── Секция 1: Информация о товаре (ItemPersonalOrderedItemView)
│   │   ├── Изображение товара (ItemImageView)
│   │   ├── Название товара (ExtendedHitLabel)
│   │   ├── Производитель (ExtendedHitLabel)
│   │   └── Минимальная цена (ExtendedHitLabel)
│   ├── Секция 2: Список заказов (ItemPersonalOrderedOrderView)
│   │   ├── Индикатор статуса (ViView)
│   │   ├── Номер заказа (ViLabel)
│   │   ├── Дата создания (ViLabel)
│   │   ├── Статус заказа (ViLabel)
│   │   ├── Аптека/бренд (ViLabel)
│   │   ├── Адрес аптеки (ViLabel)
│   │   ├── Сумма заказа (ViLabel)
│   │   ├── Кнопка количества товаров (ExtendedHitButton)
│   │   ├── Список товаров заказа (OrderItemView)
│   │   ├── Миниатюры товаров (MiniaturePhotoItemView)
│   │   ├── Кнопка увеличения заказа (HighlightedView)
│   │   └── Доп. информация по статусу (UILabel)
├── Всплывающие элементы
│   ├── Индикатор загрузки (LoadIndicatorService)
│   └── Алерты (AlertModel)
├── Кнопка чата (ButtonWithShadow)
└── Нижняя навигационная панель (UITabBarController)
    ├── Главный
    ├── Каталог
    ├── Корзина
    ├── Избранное
    └── Меню
```