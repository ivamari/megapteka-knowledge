# Экран выбора города (CityChooserVC)

## Описание и назначение экрана
Экран предназначен для выбора города пользователем. Он позволяет выбрать город из списка регионов и городов, воспользоваться поиском, а также быстро выбрать город из истории ранее выбранных городов. Экран используется для настройки местоположения пользователя, что влияет на дальнейший пользовательский сценарий (например, отображение ассортимента, адресов и т.д.).

## Общая иерархия экрана
Экран состоит из верхней панели с заголовком и поиском, основной области с секциями (история выбора, список регионов и городов), а также дополнительных элементов, которые появляются в зависимости от состояния (например, кнопка очистки истории). Разметка реализована с помощью коллекции (UICollectionView) с секциями и ячейками, каждая из которых отображает определённый тип данных (регион, город, история).

---

## 1. Верхняя панель
### 1.1. Назначение и элементы
- **Заголовок** — отображает название экрана «Выбор города».
- **Кнопка назад** — позволяет закрыть экран выбора города.
- **Кнопка поиска** — активирует строку поиска для фильтрации городов и регионов.
- **Строка поиска** — появляется при активации поиска, позволяет фильтровать города и регионы по введённому тексту. Содержит кнопку очистки текста и кнопку отмены поиска.

**Взаимодействие:**
- Нажатие на кнопку назад — закрывает экран.
- Нажатие на иконку поиска — раскрывает строку поиска.
- Ввод текста — фильтрует список городов и регионов.
- Кнопка очистки — очищает введённый текст.
- Кнопка отмены — закрывает строку поиска и сбрасывает фильтр.

---

## 2. Основная область (основной контент)
Основная область реализована в виде коллекции с секциями.

### 2.1. Секции и их элементы

#### 2.1.1. Секция «История выбора»
- **Назначение:** отображает список последних выбранных городов.
- **Элементы:**
  - Список городов из истории (каждый город — отдельная строка с иконкой истории, названием города и кнопкой удаления из истории).
  - Кнопка удаления города из истории (отображается справа от названия города).
- **Взаимодействие:**
  - Нажатие на город — выбирает город и закрывает экран.
  - Нажатие на кнопку удаления — удаляет город из истории.
- **Особенности:**
  - Секция отображается только если история не пуста и поиск не активен.

#### 2.1.2. Секция «Очистить историю выбора»
- **Назначение:** позволяет очистить всю историю выбранных городов.
- **Элементы:**
  - Кнопка «Очистить историю выбора» (отображается отдельной строкой под списком истории).
- **Взаимодействие:**
  - Нажатие на кнопку — очищает всю историю выбранных городов.
- **Особенности:**
  - Секция отображается только если история не пуста и поиск не активен.

#### 2.1.3. Секция «Список регионов и городов»
- **Назначение:** отображает список всех доступных регионов, каждый из которых можно раскрыть для просмотра городов.
- **Элементы:**
  - Список регионов (каждый регион — отдельная строка с названием и стрелкой раскрытия).
  - Список городов внутри раскрытого региона (каждый город — отдельная строка с названием).
- **Взаимодействие:**
  - Нажатие на регион — раскрывает или сворачивает список городов внутри региона.
  - Нажатие на город — выбирает город и закрывает экран.
- **Особенности:**
  - В режиме поиска автоматически раскрываются только те регионы, в которых есть подходящие города.
  - В обычном режиме регионы можно раскрывать и сворачивать вручную.
  - Если поиск активен, отображаются только те регионы и города, которые соответствуют поисковому запросу.

---

## 3. Всплывающие и дополнительные элементы
- **Алерты и ошибки** — могут появляться поверх основного контента в случае ошибок загрузки данных (например, при проблемах с сетью). Содержат текст ошибки и кнопки для повторного действия или отмены.
- **Индикатор загрузки** — отображается поверх экрана при загрузке списка городов и регионов.

---

## 4. Нижняя навигационная панель
- На экране отсутствует отдельная нижняя навигационная панель. Внизу экрана может отображаться системная панель iOS (home indicator).

---

## 5. Схематичное дерево иерархии экрана
```
Экран выбора города
├── Верхняя панель
│   ├── Кнопка назад
│   ├── Заголовок «Выбор города»
│   ├── Кнопка поиска
│   └── Строка поиска (отображается при активации поиска)
├── Основная область (коллекция)
│   ├── Секция «История выбора» (отображается, если история не пуста и поиск не активен)
│   │   ├── Строка города из истории
│   │   │   ├── Иконка истории
│   │   │   ├── Название города
│   │   │   └── Кнопка удаления города из истории
│   ├── Секция «Очистить историю выбора» (отображается, если история не пуста и поиск не активен)
│   │   └── Кнопка «Очистить историю выбора»
│   ├── Секция «Список регионов и городов»
│   │   ├── Строка региона
│   │   │   ├── Название региона
│   │   │   └── Стрелка раскрытия/сворачивания
│   │   └── (Если регион раскрыт)
│   │       └── Строка города
│   │           └── Название города
├── Всплывающие элементы
│   ├── Алерт ошибки
│   └── Индикатор загрузки
└── Нижняя системная панель (home indicator)
```

---

## [Нужно дополнить]
- Не хватает информации о точном поведении некоторых элементов при ошибках (например, текстах алертов и их кнопках).
- Неясно, как реализовано отображение иконки истории и стрелки раскрытия (используются ли кастомные изображения или системные).
- Не указаны точные размеры и отступы для всех элементов (частично можно взять из xib, но не для всех компонентов).
- Не описаны возможные анимации при раскрытии/сворачивании регионов и появлении/скрытии секций.
- Не хватает информации о возможных дополнительных всплывающих элементах (например, ворнингах или подсказках).
