# Чат с производителями (ManufacturerDialogDetailVC)

## Описание и назначение экрана
Экран предназначен для общения пользователя с представителем производителя лекарственных средств. Основные задачи: просмотр истории сообщений, отправка новых сообщений, получение ответов, просмотр информации о производителе и препарате.

## Общая иерархия экрана
Экран реализован на основе UIViewController (`ManufacturerDialogDetailVC`) с использованием UIStackView и UITableView для отображения истории сообщений, а также кастомных UIView для ввода и отправки сообщений.

---

## 1. Верхняя панель
### 1.1. Назначение и элементы
- **Навигационная панель (UINavigationBar, системная)**
  - Название экрана: "Чат с производителями"
  - Кнопка "Назад" (системная)
  - Название иконки и кнопки не переопределяются в xib, используются стандартные элементы UINavigationController.

---

## 2. Основная область (основной контент)

### 2.1. Блок информации о производителе и препарате
- **Контейнер с фото (UIView, viewPhotoContainer)**
  - Картинка препарата/производителя (`UIImageView`, imageViewPhoto)
  - Название производителя и препарата (`UILabel`, labelTitle)
  - Описание/доп. информация (`UILabel`, labelSubtitle)
  - Особенности: отображается всегда в верхней части экрана, данные подгружаются из модели диалога.

### 2.2. История сообщений
- **Таблица сообщений (`UITableView`, tableView)**
  - Каждая секция — это сообщения за определённую дату (Section: .messages(date))
  - **Footer секции**: дата сообщений (`ChatTitleDateView`)
  - **Ячейки сообщений**:
    - Сообщение пользователя (`ChatMessageOwnView`):
      - Текст сообщения (`DescriptionTextView`)
      - Время отправки (`UILabel`)
      - Выравнивание справа
    - Сообщение собеседника (`ChatMessageOppositeView`):
      - Текст сообщения (`DescriptionTextView`)
      - Время отправки (`UILabel`)
      - Выравнивание слева
  - Особенности:
    - Сообщения группируются по дате.
    - Поддерживается подгрузка предыдущих сообщений при прокрутке вверх.
    - Автоматическое обновление сообщений по таймеру.
    - Отображение индикатора загрузки при подгрузке.

### 2.3. Ввод и отправка сообщения
- **Контейнер для ввода сообщения (`UIView`, viewMessageContainer)**
  - Многострочное поле ввода (`StretchableTextView`, textViewMessageInput)
    - Плейсхолдер: "Введите сообщение..."
    - Автоматическое изменение высоты
  - Кнопка отправки (`ExtendedHitButton`, buttonSendMessage)
    - Иконка отправки ("sendDialogMessage")
    - Доступна только при наличии текста
    - При нажатии отправляет сообщение через интерактор
  - Особенности:
    - Контейнер поднимается над клавиатурой при её появлении
    - При отправке сообщение очищается

---

## 3. Всплывающие и дополнительные элементы
- **Алерты (`AlertModel`)**
  - Используются для отображения ошибок загрузки, отправки сообщений и других проблем.
  - Отображаются поверх основного контента.
  - Варианты: повторить действие, закрыть экран.
- **Индикатор загрузки (`LoadIndicatorService`)**
  - Показывается при загрузке сообщений или отправке сообщения.

---

## 4. Нижняя навигационная панель
- **TabBar (UITabBar, системная)**
  - Содержит стандартные вкладки приложения: Главный, Каталог, Корзина, Избранное, Меню
  - Переход между разделами осуществляется через стандартный UITabBarController

---

## 5. Открываемые экраны при взаимодействии с элементами
- **Кнопка "Назад"**
  - Открывает: предыдущий экран (стандартный popViewController)
- **Кнопка отправки сообщения**
  - Отправляет сообщение, остаётся на текущем экране
- **Алерт с ошибкой**
  - При выборе "Закрыть" — закрывает экран (closeScreen)
  - При выборе "Повторить" — повторяет действие (например, повторная отправка сообщения)

---

## 6. Схематичное дерево иерархии экрана
```
Чат с производителями (ManufacturerDialogDetailVC)
├── Верхняя панель (UINavigationBar)
│   ├── Кнопка "Назад"
│   └── Заголовок "Чат с производителями"
├── Основная область (UIStackView)
│   ├── Блок информации о производителе (UIView, viewPhotoContainer)
│   │   ├── Картинка препарата (UIImageView, imageViewPhoto)
│   │   ├── Название (UILabel, labelTitle)
│   │   └── Описание (UILabel, labelSubtitle)
│   ├── История сообщений (UITableView, tableView)
│   │   ├── Секции по дате (Section: .messages(date))
│   │   │   ├── Footer секции: Дата (ChatTitleDateView)
│   │   │   ├── Ячейка сообщения пользователя (ChatMessageOwnView)
│   │   │   └── Ячейка сообщения собеседника (ChatMessageOppositeView)
│   └── Контейнер ввода сообщения (UIView, viewMessageContainer)
│       ├── Поле ввода (StretchableTextView, textViewMessageInput)
│       └── Кнопка отправки (ExtendedHitButton, buttonSendMessage)
├── Всплывающие элементы
│   ├── Алерт (AlertModel)
│   └── Индикатор загрузки (LoadIndicatorService)
└── Нижняя навигационная панель (UITabBar)
    ├── Главный
    ├── Каталог
    ├── Корзина
    ├── Избранное
    └── Меню
```

---

## [Нужно дополнить]
- Не хватает информации о точных названиях и типах некоторых вспомогательных классов (например, AlertModel, LoadIndicatorService) — требуется уточнение в проекте.
- Не описаны возможные дополнительные состояния (например, пустой чат, ошибки соединения) — требуется уточнение.
- Не описаны возможные действия по долгому нажатию на сообщение или свайпу — требуется уточнение. 