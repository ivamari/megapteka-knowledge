# AdvicesFragment

## 1. Обзор Экрана

Экран "Советы провизора" (AdvicesFragment) предназначен для просмотра списка советов провизора. Он позволяет пользователю переключаться между всеми советами и избранными, а также взаимодействовать с каждым советом (просматривать детали, добавлять в избранное).

**Основные функции:**
*   Отображение списка советов провизора с пагинацией.
*   Переключение между вкладками "Все советы" и "Избранные".
*   Просмотр детальной информации о совете.
*   Добавление/удаление советов из избранного.
*   Обновление списка советов с помощью "потяни-чтобы-обновить" (pull-to-refresh).
*   Обработка состояний загрузки, ошибок и пустого списка.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **SwipeRefreshLayout (swipeRefresh):**
    *   **Назначение/Функция:** Позволяет пользователю обновить список советов, потянув экран вниз.
    *   **Взаимодействие пользователя:** Свайп вниз для обновления данных.
*   **RecyclerView:**
    *   **Назначение/Функция:** Основной контейнер для отображения секций `TabsSection`, `StateSection` и `AdvicesSection`.
    *   **Взаимодействие пользователя:** Вертикальная прокрутка для просмотра содержимого.
*   **TabsSection:**
    *   **Назначение/Функция:** Отображает вкладки для переключения между "Все советы" и "Избранные".
    *   **Взаимодействие пользователя:** Нажатие на вкладку изменяет фильтр отображаемых советов.
*   **StateSection:**
    *   **Назначение/Функция:** Отображает состояния загрузки, ошибки или пустого состо��ния данных для списка советов.
    *   **Возможные состояния:**
        *   `LOADING`: Показывает индикатор прогресса и сообщение "Загрузка советов".
        *   `ERROR`: Показывает сообщение об ошибке и кнопку "Повторить".
        *   `EMPTY`: Показывает сообщение о пустом списке (разное для "Избранных" и "Всех советов").
        *   `HIDDEN`: Скрыт, когда данные успешно загружены и отображаются.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Повторить" (в состоянии ошибки) для повторной попытки загрузки данных.
*   **AdvicesSection:**
    *   **Назначение/Функция:** Отображает сетку индивидуальных советов. Каждый совет, вероятно, включает изображение, заголовок и иконку избранного.
    *   **Взаимодействие пользователя:** Нажатие на совет для перехода к детальному просмотру. Нажатие на иконку избранного для изменения статуса совета.

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр всех советов:**
    1.  Пользователь открывает экран "Советы провизора".
    2.  По умолчанию выбрана вкладка "Все советы".
    3.  Загружаются и отображаются советы с пагинацией.
    4.  Пользователь может прокручивать список для загрузки новых советов.
*   **Просмотр избранных советов:**
    1.  Пользователь нажимает на вкладку "Избранные".
    2.  Загружаются и отображаются только советы, добавленные в избранное.
    3.  Если избранных советов нет, отображается соответствующее сообщение о пустом списке.
*   **Переход к деталям совета:**
    1.  Пользователь нажимает на любой совет в списке.
    2.  Происходит навигация к экрану `AdviceDetailActivity` с передачей ID выбранного совета и информации о том, был ли он из избранных.
*   **Добавление/удаление из избранного:**
    1.  Пользователь нажимает на иконку избранного на карточке совета.
    2.  Статус избранного обновляется, и изменение отражается в списке.
*   **Обновление списка:**
    1.  Пользователь выполняет жест "потяни-чтобы-обновить".
    2.  Список советов перезагружается.

## 4. Навигация

С экрана "Советы провизора" возможны следующие переходы:

*   **`AdviceDetailActivity`:** Для просмотра детальной информации о выбранном совете.

### Deep Links

На этот экран можно попасть по следующим deep links:

*   `{scheme}://{host}/advices`

## 5. Отображаемые Данные

*   **Типы данных:** Основной тип данных, отображаемый на экране, — это `PagingData<Advice>`, где `Advice` представляет собой объект совета провизора, содержащий ID, заголовок, изображение и статус избранного.
*   **Источник данных:**
    *   **API:** `ApiService.getAdvices` (REST метод: `GET advices`) - для получения списка советов.
    *   **Локальное хранилище:** Таблица `AdvicesDao` (для кэширования и управления советами локально, а также для отслеживания просмотренных советов).

## 6. Особые Состояния/Логика

*   **Производительность на слабых устройствах:** Для устройств с низкой производительностью аниматор элементов `RecyclerView` отключается (`viewBinding.recyclerView.itemAnimator = null`).
*   **GridLayoutManager с динамическим spanSize:** `RecyclerView` использует `GridLayoutManager` с `spanSizeLookup`, чтобы `TabsSection` и `StateSection` занимали всю ширину, а `AdvicesSection` отображалась в 3 колонки.
*   **Обработка состояний загрузки Paging:** `handleLoadStates` обрабатывает различные состояния загрузки (начальная загрузка, добавление, ошибка) и отображает соответствующий UI через `StateSection`.
*   **Обновление избранного:** Изменения в статусе избранного совета, сделанные на экране деталей совета (`AdviceDetailActivity`), синхронизируются с этим экраном через `globalViewModel.adviceChanges`.
*   **Аналитика:** Переключение вкладок и другие действия пользователя логируются с помощью `AnUtils.logEvent`.