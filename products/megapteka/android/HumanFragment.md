# HumanFragment

## Обзор Экрана
`HumanFragment` — это интерактивный фрагмент, который позволяет пользователю исследовать категории товаров, связанные с различными частями человеческого тела. Он отображает схематическое изображение человеческого тела в `WebView`, где пользователь может выбирать области, чтобы увидеть связанные с ними теги (предложения товаров или проблем). Фрагмент также предоставляет функциональность выбора пола и управления масштабом изображения.

## Элементы Пользовательского Интерфейса (UI Elements)
*   **WebView (в `webContainer`)**:
    *   **Назначение/Функция**: Отображает интерактивную схему человеческого тела. Пользователь может нажимать ��а различные части тела.
    *   **Возможные состояния**: Загрузка, отображение схемы, взаимодействие с JavaScript-интерфейсом.
    *   **Взаимодействие пользователя**: Нажатие на часть тела для выбора, что приводит к отображению связанных тегов.
*   **Переключатель пола (RadioGroup с `male` и `female` ImageView)**:
    *   **Назначение/Функция**: Позволяет пользователю переключаться между мужской и женской моделями тела.
    *   **Возможные состояния**: Выбрано "Мужчина", выбрано "Женщина".
    *   **Взаимодействие пользователя**: Нажатие на иконку пола для переключения.
*   **Кнопка "Уменьшить масштаб" (ImageView `minus`)**:
    *   **Назначение/Функция**: Позволяет уменьшить масштаб изображения тела, если оно было увеличено.
    *   **Возможные состояния**: Видимая (если масштаб увеличен), скрытая (если масштаб по умолчанию).
    *   **Взаимодействие пользователя**: Нажатие уменьшает масштаб.
*   **Нижний лист (BottomSheetView `bottomSheetView`)**:
    *   **Назначение/Функция**: Выдвигающаяся панель снизу экрана, отображающая название выбранной части тела и список связанных тегов.
    *   **Возможные состояния**: Скрыт, развернут, частично развернут.
    *   **Взаимодействие пользователя**: Прокрутка списка тегов, нажатие на тег.
*   **Название выбранной части тела (TextView `name` в BottomSheet)**:
    *   **Назначение/Функция**: Отображает название части тела, выбранной на схеме.
    *   **Возможные состояния**: Отображает название, пустое состояние.
    *   **Взаимодействие пользователя**: Нет прямого взаимодействия.
*   **Список тегов (RecyclerView в BottomSheet)**:
    *   **Назначение/Функция**: Отображает список тегов (`Suggest.Tag`), связанных с выбранной частью тела.
    *   **Возможные состояния**: Отображение тегов, пустое состояние.
    *   **Взаимодействие пользователя**: Нажатие на тег для перехода к списку товаров.
*   **Кнопка "Закрыть" (ImageView `close` в BottomSheet)**:
    *   **Назначение/Функция**: Закрывает нижний лист и сбрасывает выбор части тела.
    *   **Возможные состояния**: Активная.
    *   **Взаимодействие пользователя**: Нажатие закрывает нижний лист.
*   **Индикатор прогресса (ProgressBar `progress`)**:
    *   **Назначение/Функция**: Визуально информирует о загрузке данных для выбранной части тела.
    *   **Возможные состояния**: Видимый (во время загрузки), скрытый.
    *   **Взаимодействие пользователя**: Нет прямого взаимодействия.

## Пользовательские Сценарии (User Flows)
*   **Выбор пола**: Пользователь вы��ирает мужскую или женскую модель тела для дальнейшего взаимодействия.
*   **Выбор части тела**: Пользователь нажимает на определенную часть тела на интерактивной схеме.
*   **Просмотр и выбор тегов**: После выбора части тела, снизу экрана выдвигается панель с названием части тела и списком связанных тегов. Пользователь может прокручивать список и нажимать на теги.
*   **Переход к товарам по тегу**: Нажатие на тег приводит к переходу на экран со списком товаров, соответствующих этому тегу.
*   **Уменьшение масштаба**: Если изображение тела было увеличено (например, при выборе конкретной области), пользователь может нажать кнопку "Уменьшить масштаб", чтобы вернуться к общему виду.
*   **Закрытие панели тегов**: Пользователь может закрыть нижний лист с тегами, нажав на кнопку "Закрыть" или свайпнув его вниз.

## Навигация
*   **Переход на `HumanFragment`**:
    *   Является частью `CatalogFragment` и отображается внутри него.
*   **Переход с `HumanFragment`**:
    *   На экран `ItemsFragment`: При нажатии на тег осуществляется переход к экрану `ItemsFragment` с передачей кода группы и кода тега (`BottomNavDirections.actionToItems`).

### Deep Links

На этот экран нет прямых deep links.

## Отображаемые Данные
*   **Типы данных**: URL для загрузки схемы тела, информация о выбранной части тела (`BodyPart`), список связанных тегов (`Suggest.Tag`).
*   **Источники данных**: 
    *   **API:**
        *   `ApiService.getBody` (REST метод: `GET /app/v2/body`) - для получения URL схемы тела.
        *   `ApiService.getBodyPart` (REST метод: `GET /app/v1/body/part`) - для получения информации о выбранной части тела и связанных тегах.
    *   **Локальное хранилище:** Нет.

## Особые Состояния/Логика
*   **JavaScript Interface**: Фрагмент использует `JavaScriptInterface` для взаимодействия с JavaScript-кодом внутри `WebView`. Методы `onPointClick`, `onZoomChanged`, `onCloseArea` вызываются из JavaScript при соответствующих действиях пользователя на схеме тела.
*   **Управление BottomSheet**: Состояние нижнего листа (`BottomSheetBehavior`) управляется в зависимости от наличия выбранной части тела и состояния загрузки данных.
*   **Обработка состояний данных**: Фрагмент отслеживает состояние ресурса (`Resource<BodyPart>`) для отображения прогресса, данных или ошибок.
*   **Аналитика**: Отслеживаются события нажатия на теги (`AnEvent.tagClick`).
*   **Оптимизация для слабых устройств**: На устройствах с низкой производительностью отключается анимация `itemAnimator` для `RecyclerView`.
*   **Вложенность**: Фрагмент является вложенным (`isNested = true`) и получает имя экрана от род��тельского фрагмента (`CatalogFragment`).
*   **FlexboxLayoutManager**: Используется для гибкого размещения тегов в `RecyclerView`.