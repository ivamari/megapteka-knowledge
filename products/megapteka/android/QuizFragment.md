# QuizFragment

## 1. Обзор Экрана

Экран "Квиз" (QuizFragment) предназначен для отображения интерактивных квизов (опросов) внутри приложения. Он загружает веб-интерфейс квиза в `WebView`, позволяет пользователю проходить квиз, а также предоставляет функциональность для обмена результатами квиза.

**Основные функции:**
*   Загрузка и отображение веб-интерфейса квиза.
*   Обработка навигации внутри квиза (deep-ссылки).
*   Возможность поделиться результатами квиза.
*   Динамическое обновление заголовка экрана.
*   Обработка ошибок загрузки квиза.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **Toolbar (через MenuProvider):**
    *   **Назначение/Функция:** Отобр��жает заголовок экрана, который динамически обновляется на основе данных квиза. Содержит кнопку "Поделиться" для обмена результатами квиза.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Поделиться" открывает системное диалоговое окно для обмена.
*   **WebView (в `webContainer`):**
    *   **Назначение/Функция:** Основной компонент для отображения веб-интерфейса квиза. Позволяет взаимодействовать с квизом.
    *   **Взаимодействие пользователя:** Взаимодействие с элементами веб-страницы (выбор ответов, нажатие кнопок).

## 3. Пользовательские Сценарии (User Flows)

*   **Запуск и прохождение квиза:**
    1.  Пользователь открывает экран "Квиз", передавая `code` квиза.
    2.  ViewModel запрашивает данные о квизе (`viewModel.quiz`).
    3.  При успешной загрузке, заголовок экрана обновляется, и `WebView` загружает URL квиза (`quizUrl`).
    4.  Пользователь проходит квиз, взаимодействуя с элементами на веб-странице.
*   **Обмен результатами квиза:**
    1.  Внутри `WebView` может быть реализована JavaScript-функция `onShare()`, которая вызывается при нажатии кнопки "Поделиться" в веб-интерфейсе квиза.
    2.  Эта функция передает URL для обмена в нативное приложение.
    3.  Открывается системное диалоговое окно для обмена URL.
    4.  (Альтернативно) Пользователь нажимает на кнопку "Поделиться" в тулбаре.
    5.  Открывается системное диалоговое окно для обмена URL квиза.
*   **Навигация по deep-ссылкам из квиза:**
    1.  Если внутри квиза есть ссылки, которые являются deep-ссылками приложения, `QuizWebViewClient` перехватывает их.
    2.  Происходит навигация внутри приложения по соответству��щей deep-ссылке.
*   **Обработка ошибок:**
    1.  При возникновении ошибки загрузки квиза, отображается диалог с сообщением об ошибке.

## 4. Навигация

С экрана "Квиз" возможны следующие переходы:

*   **Назад к предыдущему экрану:** При нажатии кнопки "Назад" в тулбаре или системной кнопки "Назад".
*   **Системное диалоговое окно "Поделиться":** Открывается для обмена результатами квиза.
*   **Внутренняя навигация по DeepLink:** ��сли ссылки внутри квиза являются deep-ссылками приложения.

### Deep Links

На этот экран можно попасть по следующим deep links:

*   `{scheme}://{host}/quizzes/{code}`

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `Quiz`: Объект, содержащий информацию о квизе (заголовок, URL квиза, URL для обмена).
    *   `Resource<Quiz?>`: Для отслеживания статуса загрузки квиза.
*   **Источник данных:**
    *   **API:** `ApiService.getQuiz` (REST метод: `GET /app/v1/quizzes/detail`) - для получения данн��х о квизе.
    *   **Локальное хранилище:** Нет.

## 6. Особые Состояния/Логика

*   **JavaScriptInterface:** Класс `JavaScriptInterface` предоставляет мост между JavaScript-кодом в `WebView` и нативным Android-кодом, позволяя вызывать нативные функции (например, `onShare()`) из JavaScript.
*   **`WebViewClient`:** `QuizWebViewClient` переопределяет `shouldOverrideUrlLoading` для обработки deep-ссылок, позволяя им открываться внутри приложения, если они соответствуют графу навигации.
*   **Динамический заголовок:** Заголовок тулбара динамически обновляется на основе названия квиза, полученного из ViewModel.
*   **Динамическая видимость кнопки "Поделиться":** Кнопка "Поделиться" в тулбаре становится видимой только после успешной загрузки информации о квизе и наличии `shareUrl`.
*   **Настройка фона WebView:** После загрузки страницы, фон `WebView` устанавливается в цвет фона приложения для бесшовного перехода.