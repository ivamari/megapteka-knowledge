# WhatIfDetailsFragment

## Обзор Экрана
`WhatIfDetailsFragment` — это фрагмент, предназначенный для отображения подробной информации по конкретной теме из раздела "Что делать, если?". Он предоставляет пользователю заголовок темы, текстовые блоки с содержимым и возможность поделиться этой информацией. Фрагмент обрабатывает различные состояния загрузки данных и ошибки.

## Элементы Пользовательского Интерфейса (UI Elements)
*   **RecyclerView**:
    *   **Назначение/Функция**: Основной контейнер для отображения заголовка темы, блоков содержимого и состояния загрузки. Использует `ConcatAdapter` для объединения различных секций.
    *   **Возможные состояния**: Отображение д��нных, состояние загрузки (с индикатором прогресса и сообщением "Загрузка «Что делать, если?»"), состояние ошибки (с сообщением об ошибке и кнопкой "Повторить").
    *   **Взаимодействие пользователя**: Прокрутка содержимого.
*   **Заголовок темы (через `TextHeaderSection`)**:
    *   **Назначение/Функция**: Отображает название текущей темы "Что делать, если?".
    *   **Возможные состояния**: Отображение заголовка.
    *   **Взаимодействие пользователя**: Нет прямого взаимодействия.
*   **Блоки содержимого (через `BlocksSection`)**:
    *   **Назначение/Функция**: Отображает структурированное содержимое темы, которое может состоять из различных текстовых и, возможно, других элементов.
    *   **Возможные состояния**: Отображение блоков содержимого.
    *   **Взаимодействие пользователя**: Прок��утка содержимого.
*   **Индикатор прогресса/Сообщения о состоянии (через `StateSection`)**:
    *   **Назначение/Функция**: Отображает сообщения о состоянии (загрузка, ошибка) и индикатор прогресса.
    *   **Возможные состояния**: Видимый (в зависимости от состояния данных), скрытый.
    *   **Взаимодействие пользователя**: Нажатие на кнопку "Повторить" при ошибке.
*   **Кнопка "Поделиться" (MenuItem `action_share` в Toolbar)**:
    *   **Назначение/Функция**: Позволяет пользователю поделиться текстовым содержимым текущей темы.
    *   **Возможные состояния**: Видимая (если есть текст для шеринга), скрытая.
    *   **Взаимодействие пользователя**: Нажатие открывает системное меню для выбора приложения для шеринга.

## Пользовательские Сценарии (User Flows)
*   **Просмотр деталей темы**: Пользователь вы��ирает тему из списка "Что делать, если?" и переходит на этот экран для ознакомления с подробной информацией.
*   **Повторная загрузка данных**: При возникновении ошибки загрузки данных пользователь может нажать кнопку "Повторить" для повторной попытки.
*   **Поделиться информацией**: Пользователь нажимает на кнопку "Поделиться", чтобы отправить содержимое темы через другие приложения.

## Навигация
*   **Переход на `WhatIfDetailsFragment`**:
    *   Осуществляется с экрана `WhatIfFragment` (список тем "Что делать, если?").
    *   Условия перехода: Передача идентификатора темы (`topicId`) через аргументы навигации (`navArgs`).
*   **Переход с `WhatIfDetailsFragment`**:
    *   На предыдущий экран: Пользователь может вернуться на предыдущий экран с помощью системной кнопки "Назад".
    *   Открытие системного диалога для шеринга.

### Deep Links

На этот экран можно попасть по следующим deep links:

*   `{scheme}://{host}/what-if/{topicId}`


## Отображаемые Данные
*   **Типы данных**: Объект `WhatIfDetails`, содержащий название темы (`name`), список секций содержимого (`sections`) и текст для шеринга (`shareText`).
*   **Источники данных**:
    *   **API:** `ApiService.getWhatIfDetails` (REST метод: `GET /app/v1/what-if/detail`)
    *   **Локальное хранилище:** Нет.

## Особые Состояния/Логика
*   **Управление состоянием UI**: Фрагмент отслеживает состояние ресурса (`Resource<WhatIfDetails>`) из `ViewModel` для отображения индикатора загрузки, содержимого или сообщения об ошибке.
*   **Динамическое отображение кнопки "Поделиться"**: Кнопка "Поделиться" в тулбаре становится видимой только в том случае, если в данных темы присутствует текст для шеринга.
*   **`ConcatAdapter`**: Используется для объединения секций заголовка, блоков содержимого и состояния в один `RecyclerView`.
*   **Обработка ошибок**: При ошибке загрузки данных отображается сообщение об ошибке с возможностью повторной попытки.
*   **Аналитика**: Отслеживается событие шеринга (`AnEvent.shareLink`).
