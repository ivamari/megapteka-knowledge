# AddressesFragment

## 1. Обзор Экрана

Экран "Список адресов" (AddressesFragment) предназначен для управления сохраненными адресами пользователя. Он позволяет просматривать, добавлять и редактировать адреса, включая специальные адреса "Дом" и "Работа".

**Основные функции:**
*   Отображение списка всех сохраненных адресов пользователя.
*   Возможность добавления нового адреса.
*   Редактирование существующих адресов.
*   Обработка состояний загрузки, успеха и ошибки при получении списка адресов.
*   Отображение специальных адресов "Дом" и "Работа", даже если они еще не заполнены.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **RecyclerView:**
    *   **Назначение/Функция:** Основной контейнер для отображения всех секций экрана (состояние, список адресов, пустое состояние).
    *   **Взаимодействие пользователя:** Вертикальная прокрутка для просмотра содержимого.
*   **StateSection:**
    *   **Назначение/Функция:** Отображает состояния загрузки, ошибки или пустого состояния данных для списка адресов.
    *   **Возможные состояния:**
        *   `LOADING`: Показывает индикатор прогресса и сообщение "Загрузка адресов".
        *   `ERROR`: Показывает сообщение об ошибке и кнопку "Повторить".
        *   `HIDDEN`: Скрыт, когда данные успешно загружены и отображаются.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Повторить" (в состоянии ошибки) для повторной попытки загрузки данных.
*   **AddressesSection:**
    *   **Назначение/Функция:** Отображает список индивидуальных адресов. Каждый элемент адреса может быть нажат для редактирования.
    *   **Возможные состояния:** Отображает данные, переданные из ViewModel.
    *   **Взаимодействие пользователя:** Нажатие на элемент адреса инициирует переход к экрану редактирования адреса.
*   **EmptySection:**
    *   **Назначение/Функция:** Отображает сообщение, когда список адресов пуст.
    *   **Возможные состояния:** Видимый, когда список адресов пуст; скрытый в противном случае.
    *   **Взаимодействие пользователя:** Неинтерактивный элемент.
*   **Add Layout (viewBinding.addLayout):**
    *   **Назначение/Функция:** Вероятно, кнопка или область для добавления нового адреса.
    *   **Взаимодействие пользователя:** Нажатие инициирует переход к экрану добавления нового адреса.

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр списка адресов:**
    1.  Пользователь открывает экран "Список адресов".
    2.  Отображается индикатор загрузки (`StateSection`).
    3.  ViewModel запрашивает список адресов.
    4.  При успешной загрузке, индикатор скрывается, и отображается список адресов, включая "Дом" и "Работа" (даже если они не заполнены).
    5.  Если список адресов пуст, отображается `EmptySection`.
*   **Добавление нового адреса:**
    1.  Пользователь нажимает на элемент "Добавить адрес" (или аналогичный).
    2.  Происходит навигация к экрану `AddEditAddressFragment` для добавления нового адреса.
*   **Редактирование существующего адреса:**
    1.  Пользователь нажимает на один из адресов в списке.
    2.  Происходит навигация к экрану `AddEditAddressFragment` с предзаполненными данными выбранного адреса.
*   **Обработка ошибок загрузки:**
    1.  При возникновении ошибки загрузки данных, `StateSection` отображает сообщение об ошибке и кнопку "Повторить".
    2.  Нажатие на кнопку "Повторить" инициирует повторную попытку загрузки данных.

## 4. Навигация

С экрана "Список адресов" возможны следующие переходы:

*   **`AddEditAddressFragment`:** Для добавления нового адреса или редактирования существующего.

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:** Основной тип данных, отображаемый на экране, — это список объектов `Address`. Каждый объект `Address` содержит информацию об адресе, такую как название, широта, долгота, и флаги `isHome`, `isWork`.
*   **Источник данных:**
    *   **API:** `ApiService.getAddresses` (REST метод: `GET clients/addresses`)
    *   **Локальное хранилище:** Таблица `AddressDao` (для кэширования и управления адресами локально).

## 6. Особые Состояния/Логика

*   **Скрытие клавиатуры:** При создании представления экрана клавиатура автоматически скрывается.
*   **Производительность на слабых устройствах:** Для устройств с низкой производительностью аниматор элементов `RecyclerView` отключается (`viewBinding.recyclerView.itemAnimator = null`).
*   **Отображение "Дом" и "Работа":** Даже если у пользователя нет сохраненных адресов "Дом" или "Работа", эти элементы добавляются в список для возможности их заполнения.
*   **Сортировка адресов:** Список адресов сортируется таким образом, что адреса "Дом" и "Работа" отображаются в начале списка.
*   **Обработка ошибок:** Ошибки загрузки данных отображаются через `StateSection`, предоставляя пользователю возможность повторить попытку.