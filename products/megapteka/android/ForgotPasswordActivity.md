# ForgotPasswordActivity

## 1. Обзор Экрана

Экран "Восстановление пароля" (ForgotPasswordActivity) позволяет пользователю инициировать процесс восстановления пароля, отправив запрос на свой адрес электронной почты. После успешной отправки запроса пользователь перенаправляется на экран подтверждения кода.

**Основные функции:**
*   Запрос на восстановление пароля по адресу электронной почты.
*   Валидация введенного email.
*   Обработка состояний загрузки, успеха и ошибки при отправке запроса.
*   Перенаправление на экран подтверждения кода.
*   Интеграция с кнопкой чата поддержки.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **Toolbar (через `IncludeAppBarBinding`):**
    *   **Назначение/Функция:** Отображает загол��вок экрана "Напомнить пароль" и кнопку "Назад" для навигации.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Назад" закрывает экран.
*   **TextInputLayout (emailInput):**
    *   **Назначение/Функция:** Поле для ввода адреса электронной почты, на который будет отправлен код восстановления.
    *   **Взаимодействие пользователя:** Ввод текста. Имеет `InputFilter` для запрета пробелов и `ErrorResetWatcher` для сброса ошибок. Валидируется на корректность формата email. При нажатии "Готово" на клавиатуре инициирует запрос на восстановление.
*   **Button (submit):**
    *   **Назначение/Функция:** Кнопка для отправки запроса на восстановление пароля.
    *   **Возможные состояния:** Активна, если поле email заполнено и валидно; неактивна в противном случае. Отображает индикатор загрузки во время выполнения операции.
    *   **Взаимодействие пользователя:** Нажатие инициирует процесс запроса восстановления.
*   **ProgressBar (progress):**
    *   **Назначение/Функция:** Индикатор загрузки, отображаемый во время отправки запроса на восстановление пароля.
    *   **Возможные состояния:** Видимый во время загрузки, скрытый в других состояниях.
*   **ChatButton (includedChatButton.chatButton):**
    *   **Назначение/Функция:** Кнопка для быстрого доступа к чату поддержки.
    *   **Взаимодействие пользователя:** Нажатие открывает экран чата.

## 3. Пользовательские Сценарии (User Flows)

*   **Запрос на восстановление пароля:**
    1.  Пользователь открывает экран "Восстановление пароля".
    2.  Вводит свой адрес электронной почты в поле `email`.
    3.  Нажимает кнопку "Отправить" или "Готово" на клавиатуре.
    4.  Если email валиден, отправляется запрос на восстановление пароля через `viewModel.requestRecovery()`.
    5.  Отображается индикатор загрузки.
    6.  При успешном получении сессии (`Resource.Status.SUCCESS`), экран закрывается, и пользователь перенаправляется на `ConfirmCodeActivity` с переданным ID сессии.
    7.  При ошибке отображается диалог с сообщением об ошибке.

## 4. Навигация

С экрана "Восстановление пароля" возможны следующие переходы:

*   **`ConfirmCodeActivity`:** После успешной отправки запроса на восстановление пароля.
*   **Назад к предыдущему экрану:** При нажатии кнопки "Назад" в тулбаре.
*   **Диалоговые окна:** Для отображения сообщений об ошибках.
*   **Экран чата:** При нажатии на кнопку чата.

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:**
    *   Строка для email.
    *   `Resource<Session>`: Для отслеж��вания статуса запроса на восстановление пароля, где `Session` содержит ID сессии.
*   **Источник данных:**
    *   **API:** `ApiService.forgot` (REST метод: `PUT auth/forgot`) - для запроса на восстановление пароля.
    *   **Локальное хранилище:** Нет прямого использования локального хранилища для этой операции.

## 6. Особые Состояния/Логика

*   **Обработка Insets:** Экран корректно обрабатывает системные отступы (status bar, navigation bar, IME) для правильного отображения UI.
*   **Валидация полей:** Используются `validateFields` и `validateEmail` для проверки заполненности и корректности email, а также `ErrorResetWatcher` для сброса ошибок.
*   **Фильтр ввода:** `SpaceFilter` предотвращает ввод пробелов в поле email.
*   **Индикатор загрузки:** Видимость индикатора прогресса и кнопки "Отправить" динамически изменяется в зависимости от стат��са операции.
*   **Обработка ошибок:** Ошибки, возвращаемые ViewModel, отображаются в виде диалоговых окон.