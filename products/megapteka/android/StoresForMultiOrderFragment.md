# StoresForMultiOrderFragment

## 1. Обзор Экрана

Экран "Заказ из нескольких аптек" (StoresForMultiOrderFragment) предназначен для выбора набора аптек, из которых будет оформлен мультизаказ (заказ, состоящий из товаров, собираемых из нескольких аптек). Он предоставляет пользователю два режима просмотра: список наборов аптек и карту наборов аптек. Пользователь может просматривать доступные наборы, их состав и переходить к оформлению заказа.

**Основные функции:**
*   Отображение списка наборов аптек, доступных для мультизаказа.
*   Отображение наборов аптек на интерактивной карте.
*   Переключение между режимами списка и карты.
*   Выбор набора аптек для оформления мультизаказа.
*   Обработка разрешений на доступ к местоположению.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **TabLayout (tabs):**
    *   **Назначение/Функция:** Предоставляет две вкладки: "Список" и "Карта", для переключения между различными представлениями наборов аптек.
    *   **Возможные состояния:** Выбрана одна из вкладок.
    *   **Взаимодействие пользователя:** Нажатие на вкладку переключает отображаемый фрагмент (предположительно `StoresForMultiOrderListFragment` или `StoresForMultiOrderMapFragment`).
*   **FrameLayout (consumerContainer):**
    *   **Назначение/Функция:** Контейнер для динамической загрузки фрагментов списка и карты наборов аптек в зависимости от выбранной вкладки.
    *   **Взаимодействие пользователя:** Не имеет прямых интерактивных элементов, служит для отображения контента выбранной вкладки.

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр наборов аптек:**
    1.  Пользователь открывает экран "Заказ из нескольких аптек".
    2.  По умолчанию выбрана одна из вкладок (например, "Список").
    3.  Отображается список наборов аптек или карта наборов аптек.
*   **Переключение между режимами:**
    1.  Пользователь нажимает на вкладку "Список" или "Карта".
    2.  Соответствующий фрагмент (список или карта) отображается в `consumerContainer`.
*   **Выбор набора аптек для заказа:**
    1.  Пользователь выбирает набор аптек из списка или на карте.
    2.  Выбранный набор аптек передается в ViewModel.
    3.  Происходит навигация к экрану подтверждения мультизаказа (`MultiOrderConfirmFragment`).
*   **Обработка разрешений на местоположение:**
    1.  При создании фрагмента запрашивается разрешение `Manifest.permission.ACCESS_FINE_LOCATION`.
    2.  Результат запроса передается в ViewModel.

## 4. Навигация

С экрана "Заказ из нескольких аптек" возможны следующие переходы:

*   **Внутренние переключения фрагментов:** Между списком и картой наборов аптек.
*   **`MultiOrderConfirmFragment`:** Для подтверждения мультизаказа после выбора набора аптек.

### Deep Links

На этот экран можно попасть по следующим deep links:

*   `ma://multi-stores?orderUuid={orderUuid}&prevOrderId={prevOrderId}`

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `List<MultiCheck>`: Список объектов `MultiCheck`, каждый из которых представляет набор аптек, способный выполнить мультизаказ.
*   **Источник данных:**
    *   **API:** `ApiService.checkMultiOrder` (REST метод: `GET /app/v1/orders/multi-stores/check`) - для получения списка наборов аптек для мультизаказа.
    *   **Локальное хранилище:** Таблица `CitiesDao` (для получения текущего города).
    *   **Входящие аргументы (`navArgs`):** UUID заказа (`args.orderUuid`), ID предыдущего заказа (`args.prevOrderId`), источник перехода (`args.source`).

## 6. Особые Состояния/Логика

*   **Сохранение состояния вкладки:** Выбранная вкладка сохраняется при изменении конфигурации (например, поворот экрана) и восстанавливается.
*   **Динамическая загрузка фрагментов:** Фрагменты списка и карты динамически добавляются/скрываются в `consumerContainer`.
*   **Обработка разрешений:** Запрашивается разрешение на доступ к местоположению.
*   **Передача данных для подтверждения заказа:** В `MultiOrderConfirmFragment` передаются выбранный набор аптек, UUID заказа и ID предыдущего заказа.

*Примечание: Данная документация основана на предположении о структуре экрана, аналогичной `StockStoresForOrderFragment`, поскольку файл `StoresForMultiOrderFragment.kt` не был предоставлен напрямую, но его существование подразумевается по наличию `StoresForMultiOrderViewModel` и `StoresForMultiOrderMapFragment`.*