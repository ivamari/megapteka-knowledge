# NotificationsSettingsFragment

## 1. Обзор Экрана

Экран "Уведомления" (NotificationsSettingsFragment) позволяет пользователю управлять настройками уведомлений приложения. Он отображает список категорий уведомлений, которые можно включать или отключать, а также предоставляет возможность перейти в системные настройки уведомлений, если они отключены для приложения в целом.

**Основные функции:**
*   Отображение текущего статуса уведомлений (включены/отключены).
*   Переключение отдельных категорий уведомлений (например, акции, заказы).
*   Переход в системные настройки уведомлений приложения.
*   Обработка изменений настроек уведомлений.
*   Отображе��ие предупреждений или информационных сообщений после обновления настроек.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **RecyclerView:**
    *   **Назначение/Функция:** Основной контейнер для отображения секций `NotificationsSettingsSection` и `TurnedOffSection`.
    *   **Взаимодействие пользователя:** Вертикальная прокрутка для просмотра содержимого.
*   **NotificationsSettingsSection (settingsSection):**
    *   **Назначение/Функция:** Отображает иерархический список категорий уведомлений (например, "Общие", "Заказы") с переключателями для каждой настройки. Также может содержать элементы с deep-ссылками.
    *   **Возможные состояния:** Переключатели могут быть включены/отключены. Разделы могут быть свернуты/развернуты.
    *   **Взаимодействие пользователя:** Переключение тумблеров для изменения н����строек уведомлений. Нажатие на элементы с deep-ссылками инициирует навигацию.
*   **TurnedOffSection:**
    *   **Назначение/Функция:** Отображает сообщение о том, что уведомления отключены на системном уровне, и предлагает перейти в настройки.
    *   **Возможные состояния:** Видима, если уведомления отключены; скрыта в противном случае.
    *   **Взаимодействие пользователя:** Нажатие на элемент инициирует переход в системные настройки уведомлений приложения.
*   **Button (turnOnNotifications):**
    *   **Назначение/Функция:** Кнопка "Включить уведомления".
    *   **Возможные состояния:** Видима, если уведомления отключены на системном уровне.
    *   **Взаимодействие пользователя:** Нажатие открывает системные настройки уведомлений приложения.

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр и изменение настроек уведомлений:**
    1.  Пользователь открывает экран "Уведомления".
    2.  ViewModel загружает текущие настройки уведомлений и статус системных уведомлений.
    3.  Отображается список категорий уведомлений с их текущим состоянием.
    4.  Если системные уведомления отключены, отображается `TurnedOffSection` и кнопка `turnOnNotifications`.
    5.  Пользователь переключает тумблеры для изменения настроек.
    6.  Каждое изменение отправляется в ViewModel для обновления.
*   **Переход в системные настройки уведомлений:**
    1.  Пользователь нажимает на `TurnedOffSection` или кнопку `turnOnNotifications`.
    2.  Открываются системные настройки уведомлений для приложения "Мегаптека".
*   **Навигация по deep-ссылкам:**
    1.  Пользователь нажимает на элемент в `NotificationsSettingsSection`, котор��й имеет deep-ссылку.
    2.  Происходит навигация по указанной deep-ссылке.
*   **Сохранение настроек:**
    1.  Пользователь нажимает кнопку "Сохранить" в тулбаре.
    2.  Экран закрывается, и изменения сохраняются.
*   **Обработка результатов обновления настроек:**
    1.  После отправки изменений настроек, если есть информационное сообщение (`TitleText`), оно отображается в диалоге.

## 4. Навигация

С экрана "Уведомления" возможны следующие переходы:

*   **Назад к предыдущему экрану:** При нажатии кнопки "Сохранить" в тулбаре или системной кнопки "Назад".
*   **Системные настройки уведомлений:** Для управления разрешениями на уведомления на уровне ОС.
*   **Навигация по DeepLink:** Если элемент настроек имеет deep-ссылку.
*   **Диалоговые окна:** Для отображения информационных сообщений после обновления настроек.

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `Boolean`: Статус системных уведомлений (`viewModel.notificationsEnabled`).
    *   `List<NotificationsSettings>`: Список категорий и настроек уведомлений.
    *   `List<NotificationSetting>`: Отдельные настройки уведомлений для обновления.
    *   `Resource<TitleText?>`: Результат обновления настроек, содержащий заголовок и текст для диалога.
*   **Источник данных:**
    *   **API:**
        *   `ApiService.getNotificationsSettings` (REST метод: `GET /app/v1/notifications/settings`) - для получения списка настроек уведомлений.
        *   `ApiService.updateNotificationsSettings` (REST метод: `POST notifications/settings`) - для обновления настроек уведомлений.
    *   **Системные службы:** `NotificationManagerCompat` (для проверки статуса системных уведомлений).

## 6. Особые Состояния/Логика

*   **Динамическая видимость элементов:** Секция `TurnedOffSection` и кнопка `turnOnNotifications` отображаются только если уведомления отключены на системном уровне.
*   **Обработка иерархических настроек:** `NotificationsSettingsSection` способна отображать вложенные настройки уведомлений.
*   **Сохранение изменений:** Изменения настроек отправляются в ViewModel при каждом переключении тумблера.
*   **Диалог после обновления:** После успешного обновления настроек может быть показан информационный диалог с заголовком и текстом.