# OrderedEarlierFragment

## 1. Обзор Экрана

Экран "Вы покупали" (OrderedEarlierFragment) предназначен для отображения истории заказов, связанных с конкретным товаром. Он показывает информацию о товаре и список заказов, в которых этот товар присутствовал. Пользователь может просматривать детали каждого заказа и его местоположение на карте.

**Основные функции:**
*   Отображение информации о товаре, для которого просматривается история заказов.
*   Отображение списка заказов, содержащих данный товар.
*   Переход к детальному просмотру каждого заказа.
*   Просмотр местоположения заказа на карте.
*   Обработка состояний загрузки, ошибок и пустого списка заказов.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **Toolbar:**
    *   **Назначение/Функция:** Отображает заголовок экрана, который динамически формируется на основе количества заказанного товара (например, "Вы покупали N штук").
    *   **Взаимодействие пользователя:** Неинтерактивный элемент, кроме системной кнопки "Назад".
*   **RecyclerView:**
    *   **Назначение/Функция:** Основной контейнер для отображения секций `StateSection`, `ItemSection` и `LimitedOrdersSection`.
    *   **Взаимодействие пользователя:** Вертикальная прокрутка для просмотра содержимого.
*   **StateSection:**
    *   **Назначение/Функция:** Отображает состояния загрузки, ошибки или пустого состояния данных для списка заказов.
    *   **Возможные состояния:**
        *   `LOADING`: Показывает индикатор прогресса и сообщение "Обновление заказов".
        *   `ERROR`: Показывает сообщение об ошиб��е и кнопку "Повторить".
        *   `EMPTY`: Показывает сообщение о пустом списке заказов.
        *   `HIDDEN`: Скрыт, когда данные успешно загружены и отображаются.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Повторить" (в состоянии ошибки) для повторной попытки загрузки данных.
*   **ItemSection:**
    *   **Назначение/Функция:** Отображает краткую информацию о товаре, для которого просматривается история заказов (например, изображение, название).
    *   **Взаимодействие пользователя:** Неинтерактивный элемент.
*   **LimitedOrdersSection (ordersSection):**
    *   **Назначение/Функция:** Отображает список заказов, в которых присутствует данный товар. Каждый элемент заказа, вероятно, включает номер заказа, дату, статус и, возможно, кнопку для просмотра на карте.
    *   **Взаимодействие пользователя:** Нажатие на карточку заказа переводит на экран деталей заказа. Нажатие на кнопку "Лупа" переводит на экран заказа на карте.

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр истории заказов для товара:**
    1.  Пользователь открывает экран "Вы покупали", передавая `itemId` товара.
    2.  Отображается индикатор загрузки (`StateSection`).
    3.  ViewModel запрашивает информацию о товаре и список заказов, содержащих этот товар.
    4.  При успешной загрузке, индикатор скрывается, и отображаются информация о товаре (`ItemSection`) и список заказов (`LimitedOrdersSection`).
    5.  Если список заказов пуст, отображается `StateSection` с сообщением о пустом списке.
*   **Переход к деталям заказа:**
    1.  Пользователь нажимает на любой заказ в списке.
    2.  Происходит навигация к экрану `OrderDetailFragment` с передачей ID выбранного заказа.
*   **Просмотр заказа на карте:**
    1.  Пользователь нажимает на кнопку "Лупа" на карточке заказа.
    2.  Происходит навигация к экрану `OrdersOnMapFragment` с передачей информации о заказе.
*   **Обработка ошибок загрузки:**
    1.  При возникновении ошибки загрузки данных, `StateSection` отображает сообщение об ошибке и кнопку "Повторить".
    2.  Нажатие на кнопку "Повторить" инициирует повторную попытку загрузки данных.

## 4. Навигация

С экрана "Вы покупали" возможны следующие переходы:

*   **`OrderDetailFragment`:** Для просмотра детальной информации о заказе.
*   **`OrdersOnMapFragment`:** Для просмотра заказа на карте.

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `OrdersWithItem`: Объект, содержащий информацию о товаре (`item`) и список заказов (`list`), в которых этот товар присутствует.
    *   `Order`: Объект, представляющий заказ.
*   **Источник данных:**
    *   **API:** `ApiService.getOrdersWithItem` (REST метод: `GET /app/v1/orders/item`) - для получения списка заказов, содержащих данный товар.
    *   **Локальное хранилище:** Нет.

## 6. Особые Состояния/Логика

*   **Динамический заголовок:** Заголовок тулбара динамически обновляется на основе количества заказанного товара.
*   **Декорация элементов:** Используется `SpacesItemDecoration` для добавления отступов между элементами в `RecyclerView`.
*   **Обработка ошибок:** Ошибки загрузки данных отображаются через `StateSection`.