# StockStoresForOrderListFragment

## 1. Обзор Экрана

`StockStoresForOrderListFragment` является частью экрана выбора аптеки для заказа со склада. Он отображает список аптек, в которых доступны товары из корзины, а также предупреждения, связанные с этими аптеками или товарами. Пользователь может выбрать аптеку из списка для оформления заказа.

**Основные функции:**
*   Отображение списка аптек, доступных для заказа со склада.
*   Отображение предупреждений, связанных с аптеками или товарами.
*   Выбор аптеки для оформления заказа.
*   Просмотр информации о доступности аптеки.
*   Обработка состояний загрузки, ошибок и пустого списка аптек.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **RecyclerView:**
    *   **Назначение/Функция:** Основной контейнер для отображения секций `CheckWarningsSection`, `StoresSection` и `StateSection`.
    *   **Взаимодействие пользователя:** Вертикальная прокрутка для просмотра содержимого.
*   **StateSection:**
    *   **Назначение/Функция:** Отображает состояния загрузки, ошибки или пустого состояния данных для списка аптек.
    *   **Возможные состояния:**
        *   `LOADING`: Показывает индикатор прогресса и сообщение "Загрузка аптек".
        *   `ERROR`: Показывает сообщение об ошибке и кнопку "Повторить".
        *   `EMPTY`: Показывает сообщение о пустом списке аптек с кнопкой "Вернуться в корзину".
        *   `HIDDEN`: Скрыт, когда данные успешно загружены и отображаются.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Повторить" (в состоянии ошибки) для повторной попытки загрузки данных. Нажатие на кнопку в пустом состоянии для возврата в корзину.
*   **CheckWarningsSection:**
    *   **Назначение/Функция:** Отображает предупреждения, связанные с проверкой заказа (например, изменения в наличии товаров).
    *   **Взаимодействие пользователя:** Нажатие на кнопку в предупреждении может инициировать действие (например, сброс фильтров или навигацию по deep-ссылке).
*   **StoresSection:**
    *   **Назначение/Функция:** Отображает список аптек. Каждый элемент аптеки, вероятно, включает название, адрес, цену, иконку доступности и другие детали.
    *   **Взаимодействие пользователя:** Нажатие на карточку аптеки фокусирует ее (выбирает) в ViewModel. Нажатие на кнопку "Выбрать" инициирует выбор аптеки для оформления заказа. Нажатие на иконку доступности показывает информацию о доступности.

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр списка аптек:**
    1.  Пользователь открывает `StockStoresForOrderListFragment`.
    2.  Отображается индикатор загрузки (`StateSection`).
    3.  ViewModel запрашивает список аптек для заказа со склада и связанные предупреждения.
    4.  При успешной загрузке, индикатор скрывается, и отображаются список аптек (`StoresSection`) и предупреждения (`CheckWarningsSection`).
    5.  Если список аптек пуст и нет предупреждений, отображается `StateSection` с сообщением о пустом списке.
*   **Выбор аптеки:**
    1.  Пользователь нажимает на кнопку "Выбрать" на карточке аптеки.
    2.  Выбранная аптека передается в ViewModel через `viewModel.chooseStore()`.
    3.  Происходит навигация к экрану подтверждения заказа (`OrderConfirmFragment`).
*   **Просмотр информации о доступности:**
    1.  Поль��ователь нажимает на иконку доступности на карточке аптеки.
    2.  Отображается всплывающее окно с подробной информацией о доступности аптеки для людей с ограниченными возможностями.
*   **Взаимодействие с предупреждениями:**
    1.  Пользователь нажимает на кнопку в предупреждении в `CheckWarningsSection`.
    2.  Если ссылка кнопки "ma://resetfilters", происходит сброс фильтров в ViewModel. В противном случае, происходит навигация по deep-ссылке.
*   **Обработка ошибок загрузки:**
    1.  При возникновении ошибки загрузки данных, `StateSection` отображает сообщение об ошибке и кнопку "Повторить".
    2.  Нажатие на кнопку "Повторить" инициирует повторную попытку загрузки данных.
*   **Возврат в корзину:**
    1.  В пустом состоянии списка аптек пользователь нажимает кнопку "Вернуться в корз��ну".
    2.  Происходит возврат на предыдущий экран (корзину).

## 4. Навигация

С экрана `StockStoresForOrderListFragment` возможны следующие переходы:

*   **`OrderConfirmFragment`:** Для подтверждения заказа после выбора аптеки.
*   **Назад к предыдущему экрану (корзине):** При нажатии кнопки "Вернуться в корзину" в пустом состоянии или системной кнопки "Назад".
*   **Навигация по DeepLink:** Если кнопка в предупреждении имеет deep-ссылку.

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `List<Check>`: Список объектов `Check`, каждый из которых содержит информацию об аптеке (`Store`) и товарах, доступных в ней.
    *   `List<CheckWarning>`: Список предупреждений, связанных с проверкой заказа.
*   **Источник данных:**
    *   **API:** `ApiService.checkStockOrder` (REST метод: `GET /app/v4/stock/orders/check`) - для получения списка аптек и проверки заказа.
    *   **Локальное хранилище:** Таблица `StoresDao` (для сохранения выбранной аптеки).

## 6. Особые Состояния/Логика

*   **Производительность на слабых устройствах:** Для устройств с низкой производительностью аниматор элементов `RecyclerView` отключается (`viewBinding.recyclerView.itemAnimator = null`).
*   **Динамическая видимость секций:** Секции предупреждений и аптек отображаются/скрываются в зависимости от наличия данных.
*   **Обработка ошибок:** Ошибки загрузки данных отображаются через `StateSection`.
*   **Сброс фильтров:** При нажатии на кнопку "Сбросить фильтры" в предупреждении, ViewModel сбрасывает примененные фильтры.
