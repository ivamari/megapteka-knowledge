# WhatIfFragment

## Обзор Экрана
`WhatIfFragment` — это фрагмент, который предоставляет пользователю доступ к разделу "Что делать, если?". Он отображает список тем с вопросами и ответами, позволяет переходить к детальному просмотру каждой темы, а также предоставляет форму для отправки собственного вопроса. Фрагмент обрабатывает различные состояния загрузки данных и ошибки, а также взаимодействие с формой отправки вопроса.

## Элементы Пользовательского Интерфейса (UI Elements)
*   **RecyclerView**:
    *   **Назначение/Функция**: Основной контейнер для отображения заголовка раздела, списка тем и формы отправки вопроса. Использует `ConcatAdapter` для объединения различных секций.
    *   **Возможные состояния**: Отображение данных, состояние загрузки (с индикатором прогресса и сообщением "Загрузка «Что делать, если?»"), состояние ошибки (с сообщением об ошибке и кнопкой "Повторить").
    *   **Взаимодействие пользователя**: Прокрутка содержимого.
*   **Заголовок раздела (через `HeaderSection`)**:
    *   **Назначение/Функция**: Отображает заголовок и, возможно, краткое описание раздела "Что делать, если?".
    *   **Возможные состояния**: Отображение заголовка.
    *   **Взаимодействие пользователя**: Нет прямого взаимодействия.
*   **Список тем (через `TopicsSection`)**:
    *   **Назначение/Функция**: Отображает список доступных тем "Что делать, если?".
    *   **Возможные состояния**: Отображение списка тем.
    *   **Взаимодействие пользователя**: Нажатие на тему для перехода к её деталям.
*   **Форма отправки вопроса (через `SendSection`)**:
    *   **Назначение/Функция**: Предоставляет поля для ввода вопроса и кнопку для его отправки.
    *   **Возможные состояния**: Поля ввода, кнопка "Отправить".
    *   **Взаимодействие пользователя**: Ввод текста, нажатие на кнопку "Отправить".
*   **Индикатор прогресса/Сообщения о состоянии (через `StateSection`)**:
    *   **Назначение/Функция**: Отображает сообщения о состоянии (загрузка, ошибка) и индикатор прогресса.
    *   **Возможные состояния**: Видимый (в зависимости от состояния данных), скрытый.
    *   **Взаимодействие пользователя**: Нажатие на кнопку "Повторить" при ошибке.

## Пользовательские Сценарии (User Flows)
*   **Просмотр тем**: Пользователь открывает раздел "Что делать, если?" и просматривает список доступных тем.
*   **Переход к деталям темы**: Пользователь нажимает на интересующую тему, чтобы просмотреть подробные вопросы и ответы.
*   **Отправка нового вопроса**: Пользователь заполняет форму и отправляет свой вопрос, если не нашел ответа в существующих темах.
*   **Повторная загрузка данных**: При возникновении ошибки загрузки данных пользователь может нажать кнопку "Повторить" для повторной попытки.

## Навигация
*   **Переход на `WhatIfFragment`**:
    *   Осуществляется из главного меню или других разделов приложения.
*   **Переход с `WhatIfFragment`**:
    *   На экран `WhatIfDetailsFragment`: При нажатии на тему (`WhatIfFragmentDirections.actionToWhatIfDetails`) с передачей идентификатора темы (`topicId`).
    *   Отображение диалога подтверждения отправки вопроса.
    *   Отображение диалога ошибки при отправке вопроса.

### Deep Links

На этот экран можно попасть по следующим deep links:

*   `{scheme}://{host}/what-if`

## Отображаемые Данные
*   **Типы данных**: Объект `WhatIf`, содержащий информацию о заголовке раздела и список тем (`sections`).
*   **Источники данных**:
    *   **API:** `ApiService.getWhatIf` (REST метод: `GET /app/v1/what-if`)
    *   **Локальное хранилище:** Нет.

## Особые Состояния/Логика
*   **Управление состоянием UI**: Фрагмент отслеживает состояние ресурсов (`Resource<WhatIf>` и `Resource<Unit>`) из `ViewModel` для отображения индикатора загрузки, содержимого, сообщений об ошибках и диалогов.
*   **Отправка вопроса**: При отправке вопроса происходит валидация введенных данных. В случае успеха отображается диалог подтверждения, а форма очищается. При ошибке отображается диалог с сообщением об ошибке.
*   **Скрытие клавиатуры**: После отправки вопроса клавиатура автоматически скрывается.
*   **`ConcatAdapter`**: Используется для объединения секций заголовка, тем, состояния и формы отправки в один `RecyclerView`.
*   **Обработка ошибок**: При ошибке загрузки данных или отправки вопроса отображается соответствующее сообщение.
