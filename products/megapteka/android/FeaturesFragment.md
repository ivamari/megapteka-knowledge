# FeaturesFragment

## 1. Обзор Экрана

Экран "Фичи" (FeaturesFragment) предназначен для отображения списка ключевых функций или возможностей приложения. Он представляет собой галерею карточек, каждая из которых ведет к детальному описанию соответствующей функции. Экран поддерживает пагинацию и обработку различных состояний загрузки данных.

**Основные функции:**
*   Отображение списка функций приложения в виде сетки.
*   Переход к детальному просмотру выбранной функции.
*   Обработка состояний загрузки, ошибок и пустого списка функций.
*   Сохранение последней просмотренной функции.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **RecyclerView:**
    *   **Назначение/Функция:** Основной контейнер для ��тображения секций `StateSection` и `FeaturesSection`.
    *   **Взаимодействие пользователя:** Вертикальная прокрутка для просмотра содержимого.
*   **StateSection:**
    *   **Назначение/Функция:** Отображает состояния загрузки, ошибки или пустого состояния данных для списка функций.
    *   **Возможные состояния:**
        *   `LOADING`: Показывает индикатор прогресса и сообщение "Загрузка фич".
        *   `ERROR`: Показывает сообщение об ошибке и кнопку "Повторить".
        *   `EMPTY`: Показывает сообщение "Пусто" (если нет функций).
        *   `HIDDEN`: Скрыт, когда данные успешно загружены и отображаются.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Повторить" (в состоянии ошибки) для повторной попытки загрузки данных.
*   **FeaturesSection:**
    *   **Назначение/Функция:** Адаптер для `RecyclerView`, который упра��ляет отображением отдельных карточек функций. Каждая карточка, вероятно, включает изображение и заголовок.
    *   **Взаимодействие пользователя:** Нажатие на карточку функции инициирует переход к экрану детального просмотра функции.

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр списка функций:**
    1.  Пользователь открывает экран "Фичи".
    2.  Отображается индикатор загрузки (`StateSection`).
    3.  ViewModel запрашивает список функций.
    4.  При успешной загрузке, индикатор скрывается, и `FeaturesSection` отображает список функций в виде сетки.
    5.  Если список функций пуст, отображается `StateSection` с сообщением о пустом списке.
*   **Переход к деталям функции:**
    1.  Пользователь нажимает на любую карточку функции в списке.
    2.  Происходит навигация к экрану `FeatureDetailActivity` с передачей ID выбранной функции.
*   **Обработка ошибок загрузки:**
    1.  При возникновении ошибки загрузки данных, `StateSection` отображает сообщение об ошибке и кнопку "Повторить".
    2.  Нажатие на кнопку "Повторить" инициирует повторную попытку загрузки данных.

## 4. Навигация

С экрана "Фичи" возможны следующие переходы:

*   **`FeatureDetailActivity`:** Для просмотра детальной информации о выбранной функции.

### Deep Links

На этот экран можно попасть по следующим deep links:

*   `ma://{host}/features`

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `PagingData<Feature>`: Для отображения списка функций, где `Feature` представляет собой объект функции приложения (например, ID, заголовок, изображение).
*   **Источник данных:**
    *   **API:** `ApiService.getFeatures` (REST метод: `GET /app/v1/features`) - для получения списка функций.
    *   **Локальное хранилище:** Таблица `AppDao` (для кэширования и управления функциями локально, а также для сохранения последней просмотренной функции).

## 6. Особые Состояния/Логика

*   **Производительность на слабых устройствах:** Для устройств с низкой производительностью аниматор элементов `RecyclerView` отключается (`viewBinding.recyclerView.itemAnimator = null`).
*   **GridLayoutManager с динамическим spanSize:** `RecyclerView` использует `GridLayoutManager` с `spanSizeLookup`, чтобы `StateSection` занимала всю ширину, а `FeaturesSection` отображалась в 3 колонки.
*   **Сохранение последней просмотренной функции:** При уничтожении представления экрана (`onDestroyView`), ID первой видимой функции (если список не пуст) сохраняется через `viewModel.setLastViewed()`. Это может использоваться для возобновления просмотра с того же места.
*   **Обработка ошибок Paging:** `handleLoadStates` обрабатывает различные состояния ��агрузки (начальная загрузка, добавление, ошибка) и отображает соответствующий UI через `StateSection`.