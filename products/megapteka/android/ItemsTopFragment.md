# ItemsTopFragment

## 1. Обзор Экрана

Экран "Сегодня в топе" (ItemsTopFragment) предназначен для отображения списка самых популярных товаров. Он позволяет пользователю просматривать эти товары, добавлять их в корзину, управлять избранным и переходить к детальному просмотру каждого товара. Экран поддерживает пагинацию и обработку различных состояний загрузки данных.

**Основные функции:**
*   Отображение списка топовых товаров с пагинацией.
*   Добавление товаров в корзину и изменение их количества.
*   Добавление/удаление товаров из избранного.
*   Переход к детальному просмотру выбранного товара.
*   Обработка состояний загрузки, ошибок и пустого списка товаров.
*   Переход к экрану каталога, если список пуст.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **RecyclerView:**
    *   **Назначение/Функция:** Основной контейнер для отображения секций `ItemsUnlimitedSection` и `StateSection`.
    *   **Взаимодействие пользователя:** Вертикальная прокрутка для просмотра содержимого.
*   **ItemsUnlimitedSection (itemsSection):**
    *   **Назначение/Функция:** Адаптер для `RecyclerView`, который управляет отображением отдельных карточек топовых товаров. Каждый элемент включает изображение, название, цену, кнопки `+`/`-`, иконку избранного и другие элементы взаимодействия.
    *   **Взаимодействие пользователя:** Нажатие на товар для перехода к его деталям. Изменение количества товара в корзине, добавление/удаление из избранного.
*   **StateSection:**
    *   **Назначение/Функция:** Отображает состояния загрузки, ошибки или пустого состояния данных для списка товаров.
    *   **Возможные состояния:**
        *   `LOADING`: Показывает индикатор прогресса и сообщение "Загрузка товаров".
        *   `ERROR`: Показывает сообщение об ошибке и кнопку "Повторить".
        *   `EMPTY`: Показывает сообщение о пустом списке топовых товаров с кнопкой "Перейти в каталог".
        *   `HIDDEN`: Скрыт, когда данные успешно загружены и отображаются.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Повторить" (в состоянии ошибки) для повторной попытки загрузки данных. Нажатие на кнопку в пустом состоянии для перехода к каталогу.

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр топовых товаров:**
    1.  Пользователь открывает экран "Сегодня в топе".
    2.  Отображается индикатор загрузки (`StateSection`).
    3.  ViewModel запрашивает список топовых товаров.
    4.  При успешной загрузке, индикатор скрывается, и `ItemsUnlimitedSection` отображает список товаров.
    5.  Если список товаров пуст, отображается `StateSection` с сообщением о пустом списке и кнопкой "Перейти в каталог".
*   **Переход к деталям товара:**
    1.  Пользователь нажимает на любой товар в списке.
    2.  Происходит навигация к экрану `ItemDetailsFragment` с передачей ID выбранного товара.
*   **Добавление/изменение количества товара в корзине:**
    1.  Пользователь нажимает кнопки `+` или `-` на карточке товара.
    2.  Количество товара в корзине обновляется.
*   **Добавление/удаление из избранного:**
    1.  Пользователь нажимает на иконку избранного на карточке товара.
    2.  Статус избранного обновляется.
*   **Обработка ошибок загрузки:**
    1.  При возникновении ошибки загрузки данных, `StateSection` отображает сообщение об ошибке и кнопку "Повторить".
    2.  Нажатие на кнопку "Повторить" инициирует повторную попытку загрузки данных.
*   **Переход в каталог:**
    1.  В пустом состоянии списка товаров пользователь нажимает кнопку "Перейти в каталог".
    2.  Происходит навигация к экрану `CatalogFragment`.

## 4. Навигация

С экрана "Сегодня в топе" возможны следующие переходы:

*   **`ItemDetailsFragment`:** Для просмотра детальной информации о товаре.
*   **`CatalogFragment`:** Для перехода в каталог товаров.

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `PagingData<Item>`: Для отображения списка топовых товаров, где `Item` представляет собой объект товара (например, ID, название, изображение, цена, статус избранного).
*   **Источни�� данных:**
    *   **API:** `ApiService.getTopItems` (REST метод: `GET /app/v2/items/top`) - для получения списка топовых товаров.
    *   **Локальное хранилище:** Таблица `ItemsDao` (для кэширования товаров).

## 6. Особые Состояния/Логика

*   **Производительность на слабых устройствах:** Для устройств с низкой производительностью аниматор элементов `RecyclerView` отключается (`viewBinding.recyclerView.itemAnimator = null`).
*   **Декорация элементов:** Используется `DividerSectionItemDecoration` для добавления разделителей между элементами в `RecyclerView`.
*   **Обработка ошибок Paging:** `handleLoadStates` обрабатывает различные состояния загрузки (начальная загрузка, добавление, ошибка) и отображает соответствующий UI через `StateSection`.
*   **Синхронизация корзины и избранного:** Методы `quantitiesChanged` и `favsChanged` позволяют обновлять UI списка товаров при изменении количества в корзине или статуса избранного из других частей приложения.