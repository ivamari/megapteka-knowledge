# OrdersFragment

## 1. Обзор Экрана

Экран "Список заказов" (OrdersFragment) является центральным узлом для управления заказами пользователя. Он разделен на две вкладки: "Заказы" (OrdersListFragment) и "Товары" (OrderedItemsFragment), позволяя просматривать как список всех заказов, так и список товаров, которые пользователь когда-либо заказывал.

**Основные функции:**
*   Переключение между списками "Заказы" и "Товары".
*   Просмотр списка всех заказов пользователя.
*   Просмотр списка всех товаров, которые пользователь когда-либо заказывал.
*   Сохранение состояния выбранной вкладки.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **TabLayout (tabs):**
    *   **Назначение/Функция:** Предоставляет две вкладки: "Заказы" и "Товары", для переключения между различными списками.
    *   **Возможные состояния:** Выбрана одна из вкладок.
    *   **Взаимодействие пользователя:** Нажатие на вкладку переключает отображаемый фрагмент (`OrdersListFragment` или `OrderedItemsFragment`).
*   **FrameLayout (consumerContainer):**
    *   **Назначение/Функция:** Контейнер для динамической загрузки фрагментов `OrdersListFragment` или `OrderedItemsFragment` в зависимости от выбранной вкладки.
    *   **Взаимодействие пользователя:** Не имеет прямых интерактивных элементов, служит для отображения контента выбранной вкладки.

## 3. Пользовательские Сценарии (User Flows)

*   **Переключение между вкладками:**
    1.  Пользователь открывает экран "Список заказов", возможно, с предустановленной вкладкой (`args.tab`).
    2.  По умолчанию выбрана одна из вкладок.
    3.  Пользователь нажимает на другую вкладку.
    4.  Соответствующий фрагмент (`OrdersListFragment` или `OrderedItemsFragment`) отображается в `consumerContainer`.
    5.  Состояние выбранной вкладки сохраняется.
    6.  Регистрируется аналитическое событие `AnEvent.screenStateChanged()`.

## 4. Навигация

С экрана "Список заказов" возможны следующие переходы:

*   **Внутренние переключения фрагментов:** Между `OrdersListFragment` и `OrderedItemsFragment` в зависимости от выбранной вкладки.
*   **Другие экраны:** Навигация из `OrdersListFragment` или `OrderedItemsFragment` (например, к деталям заказа или товара).

### Deep Links

На этот экран можно попасть по следующим deep links:

*   `ma://{host}/orders`
*   `{scheme}://{host}/lk/orders`

## 5. Отображаемые Данные

*   **Типы данных:**
    *   Строка: Текущая выбранная вкладка (`currentTab`).
*   **Источник данных:**
    *   **API:**
        *   `ApiService.getActiveOrders` (REST метод: `GET /app/v1/orders/active`) - для получения списка активных заказов.
        *   `ApiService.getOverOrders` (REST метод: `GET /app/v1/orders/over`) - для получения списка завершенных заказов.
        *   `ApiService.getOrderedItems` (REST метод: `GET /app/v3/items/ordered`) - для получения списка заказанных товаров.
        *   `ApiService.deleteOrder` (REST метод: `POST /app/v1/orders/delete`) - для удаления заказа.
    *   **Локальное хранилище:**
        *   Таблица `OrdersDao` (для кэширования активных и завершенных заказов, а также для проверки наличия заказов).
        *   Таблица `ItemsDao` (для кэширования заказанных товаров).
        *   `SharedPreferences` (через `ClientRepository` для проверки необходимости запроса авторизации).

## 6. Особые Состояния/Логика

*   **Сохранение состояния вкладки:** Выбранная вкладка сохраняется при изменении конфигурации (например, поворот экрана) и восстанавливается.
*   **Динамическая загрузка фрагментов:** Фрагменты `OrdersListFragment` и `OrderedItemsFragment` динамически добавляются/отсоединяются (`attach`/`detach`) в `consumerContainer` в зависимости от выбранной вкладки, что оптимизирует использование ресурсов.
*   **Аналитика:** Переключение вкладок логируется с помощью `AnUtils.logEvent`.