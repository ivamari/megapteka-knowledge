# ItemQuestionFragment

## 1. Обзор Экрана

Экран "Вопрос о товаре" (ItemQuestionFragment) позволяет пользователю задать вопрос о конкретном товаре. Он предоставляет поля для ввода вопроса, контактных данных (телефон, email) и отображает статус доступности оператора. После отправки вопрос перенаправляется в чат.

**Основные функции:**
*   Ввод вопроса о товаре.
*   Ввод контактных данных (телефон, email).
*   Отображение статуса доступности оператора (онлайн/оффлайн).
*   Отправка вопроса в чат.
*   Валидация поля вопроса.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **EditText (question):**
    *   **Назначение/Функция:** Поле для ввода текста вопроса о товаре.
    *   **Взаимодействие пользователя:** Ввод текста. Валидируется на пустоту.
*   **TextView (onlineStatus):**
    *   **Назначение/Функция:** Отображает статус доступности оператора (например, "Оператор онлайн" или "Оператор оффлайн"). Цвет текста и иконки меняется в зависимости от статуса.
    *   **Взаимодействие пользователя:** Неинтерактивный элемент.
*   **TextView (body):**
    *   **Назначение/Функция:** Отображает дополнительную информацию о консультации, зависящую от статуса оператора (например, "Консультация доступна онлайн" или "Оставьте контакты, мы свяжемся").
    *   **Взаимодействие пользователя:** Неинтерактивный элемент.
*   **TextInputLayout (phoneInput):**
    *   **Назначение/Функция:** Поле для ввода номера телефона. Видимо, если оператор оффлайн.
    *   **Взаимодействие пользователя:** Вво�� номера телефона. Использует форматирование номера телефона.
*   **TextInputLayout (emailInput):**
    *   **Назначение/Функция:** Поле для ввода адреса электронной почты. Видимо, если оператор оффлайн.
    *   **Взаимодействие пользователя:** Ввод адреса электронной почты.
*   **Button (send):**
    *   **Назначение/Функция:** Кнопка для отправки вопроса.
    *   **Взаимодействие пользователя:** Нажатие инициирует валидацию и отправку вопроса.

## 3. Пользовательские Сценарии (User Flows)

*   **Задать вопрос оператору онлайн:**
    1.  Пользователь открывает экран "Вопрос о товаре".
    2.  Система определяет, что оператор онлайн.
    3.  Поля для телефона и email скрыты.
    4.  Пользователь вводит вопрос в поле `question`.
    5.  Нажимает кнопку "Отправить".
    6.  Вопрос отправляется в чат, и пользователь перен��правляется на экран чата (`ChatActivity`).
*   **Задать вопрос оператору оффлайн (с контактами):**
    1.  Пользователь открывает экран "Вопрос о товаре".
    2.  Система определяет, что оператор оффлайн.
    3.  Поля для телефона и email видны.
    4.  Пользователь вводит вопрос, телефон и email.
    5.  Нажимает кнопку "Отправить".
    6.  Вопрос и контактные данные отправляются в чат, и пользователь перенаправляется на экран чата (`ChatActivity`). Экран чата может быть закрыт после отправки, если оператор оффлайн.
*   **Валидация вопроса:**
    1.  При попытке отправить вопрос, поле `question` проверяется на пустоту.
    2.  Если поле пустое, отображается сообщение об ошибке, и фокус переходит к этому полю.

## 4. Навигация

С экрана "Вопрос о товаре" возможны следующие переходы:

*   **`ChatActivity`:** После отправки вопроса, пользователь перенаправляется на экран чата.

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:**
    *   Строки для вопроса, телефона и email.
    *   `Resource<Boolean>`: Для отслеживания статуса доступности оператора (`viewModel.isOperatorOnline`).
*   **Источник данных:**
    *   **API:**
        *   `ApiService.isOperatorOnline` (REST метод: `GET /ma/site/v1/chat/operator-available`) - для получения статуса доступности оператора.
        *   `ApiService.getClient` (REST метод: `GET /app/v1/clients`) - для получения данных клиента (используется для получения email/phone клиента).
    *   **Локальное хранилище:**
        *   Таблица `ClientDao` (для получения данных клиента).
        *   Таблица `AppDao` (для отметки, что по товару больше не нужно предлагать задать вопрос).

## 6. Особые Состояния/Логика

*   **Динамическая видимость полей:** Поля для телефона и email становятся видимыми только если оператор оффлайн.
*   **Форматирование телефона:** Используется `phoneFormatter()` для автоматического форматирования номера телефона по мере ввода.
*   **Скрытие клавиатуры:** Клавиатура автоматически скрывается после отправки вопроса.
*   **Передача данных в чат:** Вопрос, а также телефон и email (если оператор оффлайн), передаются в `ChatActivity` через `ChatActivityArgs`.
*   **Управление флагом `needNewMessage`:** После отправки вопроса, `viewModel.setNoNeedNewMessageForItem()` вызывается для данного товара, чтобы предотвратить повторное предложение задать вопрос о нем.