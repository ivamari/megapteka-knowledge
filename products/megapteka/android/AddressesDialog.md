# AddressesDialog

## 1. Обзор Экрана

`AddressesDialog` — это нижний диалог (BottomSheetDialogFragment), который позволяет пользователю выбирать один или несколько адресов из списка, добавлять новый адрес, а также указывать радиус поиска. Этот диалог используется в контексте выбора адреса для поиска товаров или аптек.

**Основные функции:**
*   Отображение списка сохраненных адресов пользователя.
*   Возможность выбора одного или нескольких адресов.
*   Переход к экрану добавления нового адреса.
*   Переход к экранам выбора адреса на карте или построения маршрута.
*   Установка радиуса поиска.
*   Применение выбранных адресов и радиуса.
*   Сброс выбранных адресов и радиуса.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **TextHeaderSection:**
    *   **Назначение/Функция:** Отображает заголовок диалога, например, "Где найти товар?" или "Где найти аптеку?".
    *   **Взаимодействие пользователя:** Неинтерактивный элемент.
*   **AddressesSection:**
    *   **Назначение/Функция:** Отображает список сохраненных адресов пользователя. Поддерживает выбор одного или нескольких адресов.
    *   **Возможные состояния:** Список адресов, пустой список.
    *   **Взаимодействие пользователя:** Нажатие на адрес для его выбора/снятия выбора. При выборе адреса для магазинов (`args.forStores = true`) диалог автоматически закрывается с результатом.
*   **NewAddressSection:**
    *   **Назначение/Функция:** Элемент, предоставляющий кнопку или ссылку для перехода к экрану добавления нового адреса.
    *   **Взаимодействие пользователя:** Нажатие на элемент инициирует навигацию к `AddEditAddressFragment`.
*   **RadiusSection:**
    *   **Назначение/Функция:** Позволяет пользователю выбрать или ввести радиус поиска (например, 1 км, 5 км).
    *   **Взаимодействие пользователя:** Выбор предустановленного радиуса или ввод пользовательского значения.
*   **RecyclerView:**
    *   **Назначение/Функция:** Контейнер для всех секций диалога.
    *   **Взаимодействие пользователя:** Прокрутка для просмотра содержимого.
*   **Button (apply):**
    *   **Назначение/Функция:** Применяет выбранные адреса и радиус, закрывает диалог.
    *   **Возможные состояния:** Активна, если выбран хотя бы один адрес (для сценариев, где `args.forStores = false`). Скрыта, если `args.forStores = true`.
    *   **Взаимодействие пользователя:** Нажатие для подтверждения выбора.
*   **Button (reset):**
    *   **Назначение/Функция:** Сбрасывает все выбранные адреса и радиус, закрывает диалог.
    *   **Возможные состояния:** Видима, если `args.forStores = false`. Скрыта, если `args.forStores = true`.
    *   **Взаимодействие пользователя:** Нажатие для сброса выбора.

## 3. Пользовательские Сценарии (User Flows)

*   **Выбор адреса для поиска товаров/аптек:**
    1.  Пользователь открывает `AddressesDialog`.
    2.  Отображается список сохраненных адресов.
    3.  Пользователь выбирает один или несколько адресов из списка.
    4.  (Опционально) Пользователь изменяет радиус поиска.
    5.  Пользователь нажимает кнопку "Применить" (если `args.forStores = false`).
    6.  Диалог закрывается, и выбранные данные передаются обратно на предыдущий экран.
*   **Добавление нового адреса:**
    1.  Пользователь нажимает на элемент "Добавить новый адрес".
    2.  Происходит навигация к экрану `AddEditAddressFragment`.
*   **Выбор адреса на карте (для маршрута или точки):**
    1.  Пользователь нажимает на адрес типа `NearRoute` или `NearPointAddress`.
    2.  Происходит навигация к соответствующему экрану карты (`actionToRoute` или `actionToSelectOnMap`).
*   **Сброс выбора:**
    1.  Пользователь нажимает кнопку "Сбросить".
    2.  Диалог закрывается, и на предыдущий экран передаются пустые/сброшенные значения.

## 4. Навигация

С диалога `AddressesDialog` возможны следующие переходы:

*   **`AddEditAddressFragment`:** Для добавления нового адреса.
*   **`RouteFragment`:** Для построения маршрута к выбранному адресу (если адрес типа `NearRoute`).
*   **`SelectOnMapFragment`:** Для выбора адреса на карте (если адрес типа `NearPointAddress`).
*   **Назад к предыдущему экрану:** После применения или сброса выбора, диалог закрывается, и результат передается через `setFragmentResult`.

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `Address`: Объект, представляющий сохраненный адрес пользователя.
    *   `NearPointAddress`: Объект, представляющий адрес, связанный с точкой на карте.
    *   `NearRoute`: Объект, представляющий адрес, связанный с маршрутом.
*   **Источник данных:**
    *   **API:** `ApiService.getAddresses` (REST метод: `GET clients/addresses`)
    *   **Локальное хранилище:** Таблица `AddressDao` (для кэширования и управления адресами локально).

## 6. Особые Состояния/Логика

*   **Производительность на слабых устройствах:** Для устройств с низкой производительностью аниматор элементов `RecyclerView` отключается (`viewBinding.recyclerView.itemAnimator = null`).
*   **Условная видимость кнопок:** Кнопки "Применить" и "Сбросить" скрыты, если диалог ис��ользуется для выбора аптек (`args.forStores = true`), так как в этом случае выбор адреса приводит к немедленному закрытию диалога.
*   **Передача результатов:** Выбранный адрес и радиус передаются обратно на предыдущий экран через `setFragmentResult` с использованием `REQUEST_KEY_ADDRESS` и `RESULT_KEY_ADDRESS`/`RESULT_KEY_RADIUS`.
*   **Состояние BottomSheet:** Диалог может быть развернут (`BottomSheetBehavior.STATE_EXPANDED`) при инициализации, если нет предварительно выбранного адреса, или свернут (`BottomSheetBehavior.STATE_COLLAPSED`) в противном случае. При выборе адреса из списка, диалог разворачивается.