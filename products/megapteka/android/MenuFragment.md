# MenuFragment

## 1. Обзор Экрана

Экран "Меню" (MenuFragment) является центральным навигационным хабом приложения, предоставляющим пользователю доступ к различным разделам и функциям. Он отображает информацию о профиле пользователя (если авторизован), статистику, а также список пунктов меню для перехода к заказам, адресам, отзывам, чату, уведомлениям, настройкам и юридической информации.

**Основные функции:**
*   Отображение статуса авторизации пользователя.
*   Доступ к редактированию профиля для авторизованных пользователей.
*   Отображение статистики пользователя (например, количество заказов, сэкономленные средства).
*   Навигация к основным разделам приложения: "Мои заказы", "Купленные товары", "Мои адреса", "Мои отзывы", "Обратная связь", "Чат с производителями", "Уведомления", "Оформление", "Расшифровка рецепта", "Пользовательское соглашение".
*   Отображение текущего города и возможность его изменения.
*   Отображение количества непрочитанных сообщений в чатах.
*   Копирование Firebase токена в буфер обмена (для отладки).

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **LinearLayout (includeProfile):**
    *   **Назначение/Функция:** Контейнер для отображения информации о профиле пользователя (имя, email) и статистики. Видим, если пользователь авторизован.
    *   **Взаимодействие пользователя:** Нажатие на область профиля переводит на экран редактирования профиля.
*   **TextView (includeProfile.name, includeProfile.email):**
    *   **Назначение/Функция:** Отображают имя и email авторизованного пользователя.
    *   **Взаимодействие пользователя:** Неинтерактивные элементы.
*   **RecyclerView (includeProfile.recyclerView):**
    *   **Назначение/Функция:** Горизонтальный список для отображения статистики пользователя (`StatsSection`).
    *   **Взаимодействие пользователя:** Горизонтальная прокрутка. Нажатие на элемент статистики может инициировать навигацию по связанной ссылке.
*   **LinearLayout (includeAuthButtons.authLayout):**
    *   **Назначение/Функция:** Контейнер с кнопкой "Войти". Видим, если пользователь не авторизован.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Войти" переводит на экран авторизации.
*   **TextView (city):**
    *   **Назначение/Функция:** Отображает текущий выбранный город.
    *   **Взаимодействие пользователя:** Нажатие открывает экран выбора города (`CityChooseActivity`).
*   **TextView (myOrders):**
    *   **Назначение/Функция:** Пункт меню "Мои заказы".
    *   **Взаимодействие пользователя:** Нажатие переводит на экран списка заказов (`OrdersListFragment`).
*   **TextView (myOrderedItems):**
    *   **Назначение/Функция:** Пункт меню "Купленные товары".
    *   **Взаимодействие пользователя:** Нажатие переводит на экран купленных товаров (`OrderedItemsFragment`).
*   **TextView (myAddresses):**
    *   **Назначение/Функция:** Пункт меню "Мои адреса".
    *   **Взаимодействие пользователя:** Нажатие переводит на экран списка адресов (`AddressesFragment`).
*   **TextView (myReviews):**
    *   **Назначение/Функция:** Пункт меню "Мои отзывы".
    *   **Взаимодействие пользователя:** Нажатие переводит на экран товаров для отзыва (`ItemsForReviewFragment`).
*   **TextView (feedback):**
    *   **Назначение/Функция:** Пункт меню "Обратная связь".
    *   **Взаимодействие пользователя:** Нажатие переводит на экран чата (`ChatActivity`).
*   **TextView (dialogs):**
    *   **Назначение/Функция:** Пункт меню "Чат с производителями".
    *   **Взаимодействие пользователя:** Нажатие переводит на экран списка диалогов (`DialogsFragment`).
*   **TextView (dialogsUnreadCount):**
    *   **Назначение/Функция:** Отображает количество непрочитанных сообщений в чатах.
    *   **Возможные состояния:** Видим, если есть непрочитанные сообщения; скрыт в противном случае.
    *   **Взаимодействие пользователя:** Неинтерактивный элемент.
*   **TextView (notifications):**
    *   **Назначение/Функция:** Пункт меню "Уведомления".
    *   **Взаимодействие пользователя:** Нажатие переводит на экран уведомлений (`NotificationsFragment`).
*   **TextView (theme):**
    *   **Назначение/Функция:** Пункт меню "Оформление".
    *   **Взаимодействие пользователя:** Нажатие переводит на экран выбора темы (`ThemeFragment`).
*   **TextView (receipt):**
    *   **Назначение/Функция:** Пункт меню "Расшифровка рецепта".
    *   **Взаимодействие пользователя:** Нажатие переводит на экран расшифровки рецепта (`RecipeFragment`).
*   **TextView (agreement):**
    *   **Назначение/Функция:** Пункт меню "Пользовательское соглашение".
    *   **Взаимодействие пользователя:** Нажатие открывает пользовательское соглашение в `WebActivity`.
*   **TextView (aboutHeader):**
    *   **Назначение/Функция:** Заголовок секции "О приложении".
    *   **Взаимодействие пользователя:** Долгое нажатие копирует Firebase токен в буфер обмена (для отладки).

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр меню:**
    1.  Пользователь открывает экран "Меню".
    2.  Отображается информация о профи����е (если авторизован) или кнопка "Войти".
    3.  Отображается список пунктов меню.
    4.  Отображается текущий город и количество непрочитанных сообщений.
*   **Авторизация/Регистрация:**
    1.  Неавторизованный пользователь нажимает кнопку "Войти".
    2.  Переходит на экран авторизации (`SignInActivity`).
*   **Редактирование профиля:**
    1.  Авторизованный пользователь нажимает на область профиля.
    2.  Переходит на экран редактирования профиля (`ProfileEditFragment`).
*   **Навигация по разделам:**
    1.  Пользователь нажимает на любой пункт меню (например, "Мои заказы", "Мои адреса").
    2.  Происходит навигация к соответствующему экрану.
    3.  Регистрируется аналитическое событие `AnEvent.menuClick`.
*   **Изменение города:**
    1.  Пользователь нажимает на название города.
    2.  Переходит на экран выбора города (`CityChooseActivity`).
*   **Просмотр пользовательского соглашения:**
    1.  Пользователь нажимает на пункт "Пользовательское соглашение".
    2.  Открывается `WebActivity` с текстом соглашения.
*   **Копирование Firebase токена:**
    1.  Разработчик (или пользователь для отладки) долго нажимает на заголовок "О приложении".
    2.  Firebase токен копируется в буфер обмена, и отображается Toast-сообщение.

## 4. Навигация

С экрана "Меню" возможны следующие переходы:

*   **`SignInActivity`:** Для входа в аккаунт.
*   **`ProfileEditFragment`:** Для редактирования профиля.
*   **`CityChooseActivity`:** Для выбора города.
*   **`OrdersListFragment`:** Для просмотра списка заказов.
*   **`OrderedItemsFragment`:** Для просмотра купленных товаров.
*   **`AddressesFragment`:** Для управления адресами.
*   **`ItemsForReviewFragment`:** Для управления отзывами о товарах.
*   **`ChatActivity`:** Для обратной связи.
*   **`DialogsFragment`:** Для просмотра диалогов с производителями.
*   **`NotificationsFragment`:** Для просмотра уведомлений.
*   **`ThemeFragment`:** Для выбора темы оформления.
*   **`RecipeFragment`:** Для расшифровки рецепта.
*   **`WebActivity`:** Для просмотра пользовательского соглашения.
*   **Навигация по DeepLink:** Если элемент статистики имеет deep-ссылку.

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `Client`: Информация о профиле пользователя (имя, email).
    *   `List<ClientStat>`: Статистика пользователя (например, количество заказов, сэкономленные средства).
    *   `City`: Текущий выбранный город.
    *   `Resource<Int>`: Количество непрочитанных сообщений.
*   **Источник данных:**
    *   **API:**
        *   `ApiService.getClient` (REST метод: `GET /app/v1/clients`) - для получения данных клиен��а.
        *   `ApiService.getClientStats` (REST метод: `GET clients/statistics`) - для получения статистики клиента.
        *   `ApiService.getUnreadCount` (REST метод: `GET /app/v1/manufacturer/dialogs/messages/unread-count`) - для получения количества непрочитанных сообщений.
    *   **Локальное хранилище:**
        *   Таблица `CitiesDao` (для получения текущего города).
        *   Таблица `ClientDao` (для получения данных клиента).
        *   `SharedPreferences` (через `AccountRepository` для проверки наличия аккаунта).
    *   **Внешние SDK:**
        *   `FirebaseInstallations` (для получения Firebase токена).

## 6. Особые Состояния/Логика

*   **Условная видимость элементов:** Разделы профиля и кнопки авторизации отображаются в зависимости от того, авторизован ли пользователь.
*   **Динамическое отображение статистики:** `StatsSection` отображает статистику пользователя в горизонтальном списке, ��сли она доступна.
*   **Обновление количества непрочитанных сообщений:** Количество непрочитанных сообщений в чатах динамически обновляется и отображается рядом с пунктом "Чат с производителями".
*   **Аналитика:** Все переходы по пунктам меню логируются с помощью `AnUtils.logEvent`.
*   **Копирование в буфер обмена:** Реализована функция копирования Firebase токена в буфер обмена для удобства отладки.