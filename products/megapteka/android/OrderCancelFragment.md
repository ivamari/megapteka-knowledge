# OrderCancelFragment

## 1. Обзор Экрана

Экран "Отмена заказа" (OrderCancelFragment) позволяет пользователю отменить существующий заказ, выбрав причину отмены из предложенного списка и, при необходимости, добавив комментарий. Экран динамически отображает поле для комментария в зависимости от выбранной причины.

**Основные функции:**
*   Отображение списка причин отмены заказа.
*   Выбор одной причины отмены.
*   Возможность ввода дополнительного комментария к отмене.
*   Отправка запроса на отмену заказа.
*   Обработка состояний загрузки, успеха и ошибки при отмене заказа.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **TextView (reasonLabel):**
    *   **Назначение/Функция:** Отображает заголовок, указывающий на причину отмены, например, "Причина отмены заказа [номер заказа]".
    *   **Взаимодействие пользователя:** Неинтерактивный элемент.
*   **RadioGroup (radioGroup):**
    *   **Назначение/Функция:** Группа радиокнопок, каждая из которых представляет собой одну из причин отмены заказа.
    *   **Взаимодействие пользователя:** Выбор одной радиокнопки. При выборе изменяется видимость поля для комментария.
*   **TextInputLayout (tvMessageInputLayout):**
    *   **Назначение/Функция:** Поле для ввода дополнительного комментария к отмене. Видимо только для определенных причин отмены.
    *   **Возможные состояния:** Видимо/скрыто.
    *   **Взаимодействие пользователя:** Ввод текста.
*   **Button (cancelButton):**
    *   **Назначение/Функция:** Кнопка для подтверждения отмены заказа.
    *   **Возможные состояния:** Активна, если выбрана причина отмены. Отображает индикатор загрузки во время выполнения операции.
    *   **Взаимодействие пользователя:** Нажатие инициирует процесс отмены заказа.
*   **ProgressBar (progress):**
    *   **Назначение/Функция:** Индикатор загрузки, отображаемый во время отправки запроса на отмену заказа.
    *   **Возможные состояния:** Видимый во время загрузки, скрытый в других состояниях.

## 3. Пользовательские Сценарии (User Flows)

*   **Выбор причины отмены:**
    1.  Пользователь открывает экран "Отмена заказа", передавая `orderId` и `title` заказа.
    2.  ViewModel загружает список доступных причин отмены (`viewModel.cancelReasons`).
    3.  Радиокнопки с причинами отмены динамически добавляются в `radioGroup`.
    4.  Пользователь выбирает одну из причин.
    5.  Если выбранная причина требует комментар����я (`isShowComment == true`), поле `tvMessageInputLayout` становится видимым.
*   **Отмена заказа:**
    1.  Пользователь выбирает причину отмены (и, возможно, вводит комментарий).
    2.  Нажимает кнопку "Отменить заказ" (`cancelButton`).
    3.  Регистрируется аналитическое событие `AnEvent.cancelOrder`.
    4.  Отправляется запрос на отмену заказа через `viewModel.cancelOrder()`.
    5.  Отображается индикатор загрузки.
    6.  При успехе отображается диалог "Заказ отменен", после закрытия которого экран закрывается.
    7.  При ошибке отображается диалог с сообщением об ошибке.

## 4. Навигация

С экрана "Отмена заказа" возможны следующие действия:

*   **Назад к предыдущему экрану:** После успешной отмены заказа или при нажатии кнопки "Назад" в тулбаре/системной кнопки "Назад".
*   **Диалоговые окна:** Для отображения сообщений об успехе или ошибках.

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `List<CancelReason>`: Список объектов `CancelReason`, каждый из которых содержит ID, название причины и флаг `isShowComment`.
    *   `Resource<Unit>`: Для отслеживания статуса операции отмены заказа.
*   **Источник данных:**
    *   **API:**
        *   `ApiService.getCancelReasons` (REST метод: `GET /ma/site/v3/orders/cancel/reasons`) - для получения списка причин отмены.
        *   `ApiService.cancelOrder` (REST метод: `POST /app/v2/orders/cancel`) - для отмены заказа.
    *   **Локальное хранилище:** Нет.

## 6. Особые Состояния/Логика

*   **Динамическое отображение поля комментария:** Видимость поля `tvMessageInputLayout` управляется в зависимости от свойства `isShowComment` выбра��ной причины отмены.
*   **Динамическое создание радиокнопок:** Радиокнопки для причин отмены создаются программно на основе данных, полученных из ViewModel.
*   **Стилизация радиокнопок:** При выборе радиокнопки ее текст меняет стиль на более жирный.
*   **Логирование аналитики:** Отмена заказа логируется с помощью `AnUtils.logEvent`, включая сообщение об отмене.
*   **Обработка ошибок:** Ошибки отмены заказа отображаются в виде диалоговых окон.