# StoresControlListFragment

## 1. Обзор Экрана

`StoresControlListFragment` является частью экрана "Аптечный контроль". Он отображает список аптек, которые пользователь может контролировать или проверять. Пользователь может выбрать аптеку из списка, чтобы просмотреть ее детали, выбрать ее для дальнейших действий или загрузить фотографии.

**Основные функции:**
*   Отображение списка аптек для контроля.
*   Выбор аптеки для просмотра деталей или дальнейших действий.
*   Возможность загрузки фотографий для выбранной аптеки.
*   Обработка состояний загрузки, ошибок и пустого списка аптек.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **RecyclerView:**
    *   **Назначение/Функция:** Основной контейнер для отображения секций `StoresSection` и `StateSection`.
    *   **Взаимодействие пользователя:** Вертикальная прокрутка для просмотра содержимого.
*   **StateSection:**
    *   **Назначение/Функция:** Отображает состояния загрузки, ошибки или пустого состояния данных для списка аптек.
    *   **Возможные состояния:**
        *   `LOADING`: Показывает индикатор прогресса и сообщение "Загрузка аптек".
        *   `ERROR`: Показывает сообщение об ошибке и кнопку "Повторить".
        *   `EMPTY`: Показывает сообщение о пустом списке аптек с кнопкой "Вернуться в корзину".
        *   `HIDDEN`: Скрыт, когда данные успешно загружены и отображаются.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Повторить" (в состоянии ошибки) для повторной попытки загрузки данн��х. Нажатие на кнопку в пустом состоянии для возврата на предыдущий экран.
*   **StoresSection:**
    *   **Назначение/Функция:** Адаптер для `RecyclerView`, который управляет отображением отдельных карточек аптек. Каждая карточка, вероятно, включает название, адрес, статус и кнопки действий.
    *   **Взаимодействие пользователя:** Нажатие на карточку аптеки фокусирует ее (выбирает) в ViewModel. Нажатие на кнопку "Выбрать" инициирует выбор аптеки. Нажатие на кнопку "Фотографии" инициирует загрузку фотографий.

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр списка аптек для контроля:**
    1.  Пользователь открывает `StoresControlListFragment`.
    2.  Отображается индикатор загрузки (`StateSection`).
    3.  ViewModel запрашивает список аптек для контроля (`viewModel.storesForControl`).
    4.  При успешной загрузке, индикатор скрывается, и `StoresSection` отображает список аптек.
    5.  Если список аптек пуст, отображается `StateSection` с сообщением о пустом списке.
*   **Выбор аптеки:**
    1.  Пользователь нажимает на карточку аптеки.
    2.  Выбранная аптека передается в ViewModel через `viewModel.focusStore()`.
    3.  (Предполагается, что это может привести к отображению деталей аптеки на карте или в другой части экрана "Аптечный контроль").
*   **Выбор аптеки для действия:**
    1.  Пользователь нажимает на кнопку "Выбрать" на карточке аптеки.
    2.  Выбранная аптека передается в ViewModel через `viewModel.chooseStore()`.
    3.  (Предполагается, что это может привести к переходу на экран с деталями выбранной аптеки для дальнейших действий).
*   **Загрузка фотографий:**
    1.  Пользователь нажимает на кнопку "Фотографи��" на карточке аптеки.
    2.  ID аптеки передается в ViewModel через `viewModel.loadPhotos()`.
    3.  (Предполагается, что это может открыть диалог или экран для загрузки фотографий).
*   **Обработка ошибок загрузки:**
    1.  При возникновении ошибки загрузки данных, `StateSection` отображает сообщение об ошибке и кнопку "Повторить".
    2.  Нажатие на кнопку "Повторить" инициирует повторную попытку загрузки данных.
*   **Возврат на предыдущий экран:**
    1.  В пустом состоянии списка аптек пользователь нажимает кнопку "Вернуться в корзину".
    2.  Происходит возврат на предыдущий экран.

## 4. Навигация

С экрана `StoresControlListFragment` возможны следующие переходы:

*   **Назад к предыдущему экрану:** При нажатии кнопки "Вернуться в корзину" в пустом состоянии или системной кнопки "Назад".
*   **Внутренняя навигация:** К другим частям экрана "Аптечный контроль" (например, к карте или эк��ану загрузки фото), управляемым `StoresControlViewModel`.

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `List<StoreForControl>`: Список объектов `StoreForControl`, каждый из которых содержит информацию об аптеке для контроля.
*   **Источник данных:**
    *   **API:** `ApiService.getStoresForControl` (REST метод: `GET /app/v1/control/stores`) - для получения списка аптек для контроля.
    *   **Локальное хранилище:** Таблица `StoresDao` (для сохранения выбранной аптеки).

## 6. Особые Состояния/Логика

*   **Производительность на слабых устройствах:** Для устройств с низкой производительностью аниматор элементов `RecyclerView` отключается (`viewBinding.recyclerView.itemAnimator = null`).
*   **Динамическая видимость секций:** Секции аптек и состояния отображаются/скрываются в зависимости от наличия данных.
*   **Обработка ошибок:** Ошибки загрузки данных отображаются через `StateSection`.
