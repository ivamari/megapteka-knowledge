# AdviceDetailActivity

## 1. Обзор Экрана

Экран "Детальная совета провизора" (AdviceDetailActivity) предназначен для просмотра подробной информации о советах провизора в формате слайдов. Пользователь может перелистывать советы, добавлять их в избранное, делиться ими и отслеживать свой прогресс просмотра.

**Основные функции:**
*   Отображение советов провизора в формате горизонтальных слайдов.
*   Перелистывание советов вперед и назад.
*   Добавление/удаление советов из избранного.
*   Возможность поделиться советом.
*   Отслеживание просмотренных советов.
*   Обработка состояний загрузки и ошибок при получении советов.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **ViewPager2 (viewPager):**
    *   **Назначение/Функция:** Основной контейнер для отображения советов в виде перелистываемых страниц. Использует `AdviceSection` в качестве адаптера.
    *   **Взаимодействие пользователя:** Горизонтальный свайп для переключения между советами. Перелистывание за пределы первого/последнего совета приводит к закрытию экрана.
*   **AdviceSection:**
    *   **Назначение/Функция:** Адаптер для `ViewPager2`, который управляет отображением отдельных советов. Каждый совет, вероятно, содержит текст, изображения, кнопки и индикаторы прогресса.
    *   **Взаимодействие пользователя:** Обрабатывает клики по кнопкам (например, "Поделиться"), события добавления в избранное, а также уведомляет о просмотре совета.
*   **CubeTransformer:**
    *   **Назначение/Функция:** Пользовательская трансформация страницы для `ViewPager2`, создающая эффект куба при перелистывании.
    *   **Взаимодействие пользователя:** Визуальный эффект при свайпе.

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр советов:**
    1.  Пользователь открывает экран "Детальная совета провизора", возможно, с определенного совета (`args.currentId`).
    2.  Загружаются советы, и первый совет отображается.
    3.  Пользователь свайпает влево/вправо для перехода к следующему/предыдущему совету.
    4.  При просмотре совета регистрируется событие `onViewed`.
*   **Добавление/удаление из избранного:**
    1.  Пользователь нажимает на иконку "Избранное" на текущем совете.
    2.  Статус избранного обновляется через `viewModel.updateFavorite`.
*   **Поделиться советом:**
    1.  Пользователь нажимает на кнопку "Поделиться" на текущем совете.
    2.  Открывается системное диалоговое окно для обмена текстом/ссылкой на совет.
    3.  Регистрируется аналитическое событие `AnEvent.shareLink`.
*   **Завершение просмотра:**
    1.  Пользователь перелистывает за последний совет или свайпает за первый совет (если он первый).
    2.  Экран закрывается (`finish()`).
*   **Обработка ошибок загрузки:**
    1.  При возникновении ошибки загрузки советов отображается диалог с сообщением об ошибке.
    2.  Если после ошибки нет загруженных советов, экран закрывается.

## 4. Навигация

С экрана "Детальная совета провизора" возможны следующие действия:

*   **Закрытие экрана:** Происходит при перелистывании за пределы доступных советов или при нажатии кнопки "Назад" на устройстве.
*   **Системное диалоговое окно "Поделиться":** Открывается для обмена ссылкой на совет.

### Deep Links

На этот экран можно попасть по следующим deep links:

*   `{scheme}://{host}/advices/{current_id}`

## 5. Отображаемые Данные

*   **Типы данных:** Основной тип данных — это список объектов, представляющих советы провизора. Эти объекты, вероятно, содержат:
    *   Текст совета.
    *   Изображения.
    *   Статус избранного.
    *   Ссылки для кнопок (например, для кнопки "Поделиться").
*   **Источник данных:**
    *   **API:** `ApiService.getAdvices` (REST метод: `GET advices`) - для получения списка советов.
    *   **Локальное хранилище:** Таблица `AdvicesDao` (для кэширования и управления советами локально, а также для отслеживания просмотренных советов).

## 6. Особые Состояния/Логика

*   **Трансформация страницы:** Используется `CubeTransformer` для создания уникального визуального эффекта при перелистывании страниц.
*   **Обработка перелистывания за пределы:** Метод `doOnOverScroll` на `ViewPager2` позволяет закрыть активность, если пользователь пытается прокрутить за пределы первого или последнего элемента.
*   **Отслеживание просмотра:** Каждый просмотренный совет регистрируется через `viewModel.setViewed`.
*   **Аналитика:** Действия пользователя (просмотр, добавление в избранное, поделиться) логируются с помощью `AnUtils.logEvent`.
*   **Глобальные изменения:** `globalViewModel.adviceChanges` используется для уведомления других частей приложения об изменениях в статусе избранного советов.