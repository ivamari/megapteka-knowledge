# ItemDetailsFragment

## 1. Обзор Экрана

Экран "Детальная товара" (ItemDetailsFragment) предназначен для отображения подробной информации о конкретном товаре. Он включает в себя основную информацию о товаре, его свойства, связанные товары (аналоги, сопутствующие товары), отзывы, а также функциональность для добавления в корзину, избранное и применения фильтров.

**Основные функции:**
*   Отображение детальной информации о товаре (название, описание, изображения, цена, доступность).
*   Отображение и взаимодействие с различными свойствами товара.
*   Отображение списка связанных товаров (аналогов, сопутствующих) с пагинацией.
*   Добавление товаров в корзину и изменение их количества.
*   Добавление/удаление товаров из избранного.
*   Применение фильтров к списку связанных товаров.
*   Просмотр и отправка отзывов о товаре.
*   Обработка состояний загрузки, ошибок и пустого списка.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **Toolbar (через MenuProvider):** Содержит кнопку "Поделиться".
*   **RecyclerView:** Основной контейнер для отображения всех секций фрагмента.
*   **ItemSection:** Отображает основную информацию о товаре.
*   **FiltersSectionWrapper / FiltersSection:** Отображает доступные фильтры для связанных товаров.
*   **ItemsUnlimitedSection (analogItemsSection):** Отображает список аналогов товара с пагинацией.
*   **ConsumablesSection:** Отображает список сопутствующих товаров.
*   **ReviewsSection / ReviewSection / AverageRatingSection / ShowMoreReviewsSection:** Секции для отображения и взаимодействия с отзывами.
*   **PropertyImportantSection / PropertySection / RichPropertySection / NewScreenPropertySection:** Секции для отображения различных свойств товара.
*   **DescriptionSection / HighlightSection:** Секции для описания и выделенных свойств.
*   **OriginalSection:** Отображает информацию об оригинальном препарате.
*   **CategoriesSection:** Отображает категории товара.
*   **SpecialsSection:** Отображает специальные предложения, связанные с товаром.
*   **ChatButtonSection / ManufactureDialogButtonSection:** Кнопки для взаимодействия с чатом или производителем.
*   **StateSection:** Отображает состояния загрузки, ошибок или пустого списка.
*   **ShopperView:** Нижняя панель для взаимодействия с корзиной (добавление, изменение количества).

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр деталей товара:** Пользователь открывает экран, загружается и отображается информация о товаре и связанных элементах.
*   **Применение фильтров к аналогам:** Пользователь выбирает фильтры в `FiltersSection`, и список аналогов (`analogItemsSection`) обновляется.
*   **Взаимодействие с корзиной/избранным:** Пользователь добавляет/удаляет товар из корзины или избранного.
*   **Просмотр и отправка отзывов:** Пользователь может просматривать существующие отзывы и отправлять новые.
*   **Навигация по связанным элементам:** Переход к деталям аналогов, сопутствующих товаров, специальных предложений.
*   **Поделиться товаром:** Обмен ссылкой на товар.

## 4. Навигация

*   **`FiltersDialog`:** Для применения фильтров.
*   **`ItemQuestionFragment` / `ChatActivity`:** Для вопросов о товаре или чата.
*   **`ManufacturerDetailsFragment` / `PropertyFragment`:** Для просмотра деталей производителя или свойс��в.
*   **`ReviewsFragment`:** Для просмотра всех отзывов.
*   **Другие экраны товаров:** При нажатии на связанный товар.
*   **Системное диалоговое окно "Поделиться".**
*   **Навигация по DeepLink.**

### Deep Links

На этот экран можно попасть по следующим deep links:
*   `{scheme}://{host}/item/{id}`
*   `{scheme}://{host}/item/{code}`

## 5. Отображаемые Данные

*   **Типы данных:** `Item` (детали товара), `PagingData<Item>` (аналоги), `List<Consumable>` (сопутствующие), `List<ItemReview>` (отзывы), `List<Special>` (спецпредложения).
*   **Источник данных:** API (например, `ApiService.getItemDetails`, `ApiService.getAnalogs`, `ApiService.getConsumables`, `ApiService.getItemReviews`, `ApiService.getSpecials`).

## 6. Особые Состояния/Логика

### 6.1. Логика Фильтрации
Экран использует абстрактный класс `Filterable` для представления различных типов фильтров. Для фильтрации связанных товаров (аналогов) пр��меняются `ItemFilterable.DistanceFilterable` и `ItemFilterable.AllFilterable`. Управление фильтрами происходит через `FiltersDialog`, который позволяет пользователю выбирать и применять значения фильтров, обновляя список аналогов.

*   **Общий пул представлений:** Используется `RecycledViewPool` для оптимизации производительности `RecyclerView`.
*   **Динамическая видимость элементов:** Многие секции и кнопки динамически отображаются/скрываются в зависимости от наличия данных или выбранной вкладки.
*   **Обработка пустого состояния:** `StateSection` отображает кастомизированное сообщение и кнопку при отсутствии аналогов.
*   **Синхронизация корзины и избранного:** Обновление UI при изменении количества в корзине или статуса избранного.
*   **Обработка скриншотов:** Возможность поделиться скриншотом экран��.
