# HomeFragment

## 1. Обзор Экрана

Экран "Главный" (HomeFragment) является основным экраном приложения "Мегаптека", предоставляющим пользователю персонализированную ленту контента, включающую советы провизора, информацию о заказах, акции, рекомендации товаров, а также быстрый доступ к поиску, сканированию и другим ключевым функциям. Экран динамически адаптируется под состояние пользователя (авторизован/неавторизован, наличие заказов, наличие непросмотренных советов и т.д.).

**Основные функции:**
*   Отображение персонализированной ленты контента.
*   Быстрый доступ к поиску товаров (текстовый и голосовой) и сканированию штрих-кодов.
*   Просмотр советов провизора и переход к их деталям.
*   Отображение текущих заказов и их статусов.
*   Предложение авторизации для неавторизованных пользователей.
*   Отображение акций и баннеров.
*   Рекомендации товаров (например, "Уже заказывали", "Вы недавно смотрели", "Топ сегодня").
*   Предложение оценить товары после покупки.
*   Управление уведомлениями.
*   Отображение информации о выгоде.
*   Возможность поделиться приложением.
*   Подсказки по оплате.
*   Обработка состояний загрузки и ошибок для различных секций.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **Toolbar:**
    *   **Назначение/Функция:** Содержит кнопку выбора города (`city`) и кнопку уведомлений (`action_notifications`).
    *   **Взаимодействие пользователя:** Нажатие на город открывает экран вы��ора города. Нажатие на иконку уведомлений открывает экран уведомлений.
*   **SearchBar (includedItemsSearchBarHome):**
    *   **Назначение/Функция:** Содержит поле для ввода поискового запроса, кнопку голосового поиска и кнопку сканирования штрих-кода.
    *   **Взаимодействие пользователя:** Нажатие на поле поиска: Переход к экрану поиска товаров. Нажатие на кнопку голосового поиска: Активация голосового ввода. Нажатие на кнопку сканирования: Переход к экрану сканирования штрих-кода.
*   **RecyclerView (rv):**
    *   **Назначение/Функция:** Основной контейнер для отображения всех динамических секций экрана.
    *   **Взаимодействие пользователя:** Вертикальная прокрутка для просмотра содержимого.
*   **AdviceHeaderSection:**
    *   **Назначение/Функция:** Заголовок для секции "Советы провизора" с кн��пкой "Смотреть все".
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Смотреть все" переводит на экран "Советы провизора".
*   **AdvicesSectionWrapper / AdvicesSection:**
    *   **Назначение/Функция:** Горизонтальный список карточек советов провизора.
    *   **Взаимодействие пользователя:** Горизонтальная прокрутка. Нажатие на совет открывает его детали.
*   **OrdersSectionWrapper / LimitedOrdersSection:**
    *   **Назначение/Функция:** Горизонтальный список текущих заказов пользователя.
    *   **Взаимодействие пользователя:** Горизонтальная прокрутка. Нажатие на заказ открывает его детали. Кнопка "Лупа" для просмотра заказа на карте.
*   **AcquaintanceSection:**
    *   **Назначение/Функция:** Карточка-приветствие или предложение ознакомиться с приложением для новых пользователей.
    *   **Взаимодействи�� пользователя:** Нажатие переводит на экран "Давайте знакомиться".
*   **AppUpdateSection:**
    *   **Назначение/Функция:** Карточка с предложением обновить приложение, если доступно новое обновление.
    *   **Взаимодействие пользователя:** Нажатие инициирует процесс обновления приложения.
*   **AuthSection:**
    *   **Назначение/Функция:** Карточка с предложением авторизоваться для неавторизованных пользователей.
    *   **Взаимодействие пользователя:** Нажатие переводит на экран авторизации.
*   **OrdersOnMapSection:**
    *   **Назначение/Функция:** Карточка, предлагающая просмотреть заказы на карте.
    *   **Возможные состояния:** Видима, если есть активные заказы.
    *   **Взаимодействие пользователя:** Нажатие переводит на экран "Заказы на карте".
*   **PushSettingsSection:**
    *   **Назначение/Функци��:** Карточка с предложением включить уведомления.
    *   **Взаимодействие пользователя:** Нажатие открывает системные настройки уведомлений приложения.
*   **EconomySection:**
    *   **Назначение/Функция:** Карточка, отображающая информацию о выгоде или экономии.
    *   **Взаимодействие пользователя:** Неинтерактивный элемент.
*   **SingleButtonsSection:**
    *   **Назначение/Функция:** Горизонтальный список кнопок быстрого доступа к различным функциям.
    *   **Взаимодействие пользователя:**
        *   Нажатие на "Что нового?" переводит на экран "Что нового?" (`FeaturesFragment`).
        *   Нажатие на "Как заказать" переводит на экран "Как заказать" (`HowToOrderFragment`).
        *   Нажатие на "Мои заказы" переводит на экран "Мои заказы" (`OrdersFragment` или `OrderedEarlierFragment`).
        *   Нажатие на "Мегасоветы" переводи�� на экран "Мегасоветы" (`AdvicesFragment`).
        *   Нажатие на "Мои адреса" переводит на экран "Мои адреса" (`AddressesFragment`).
        *   Нажатие на "Мегаптека для друзей" переводит на экран "Мегаптека для друзей" (`ShareFriendsFragment`).
        *   Нажатие на "Расшифровка рецепта" переводит на экран "Расшифровка рецепта" (`RecipeFragment`).
        *   Нажатие на "Задать вопрос о товаре" переводит на экран "Чат" (`ChatActivity` или `ItemQuestionFragment`).
        *   Нажатие на "Аптечный контроль" переводит на экран "Аптечный контроль" (`StoresControlPromptFragment`).
*   **AiDroppedItemsHeaderSection / AiDroppedItemsSectionWrapper / HorizontalItemsSection (ItemSource.AIDropped):**
    *   **Назначение/Функция:** Секция с товарами, рекомендованными ИИ.
    *   **Взаимодействие пользователя:** Горизонтальная прокрутка. Нажатие на товар открывает его детали.
*   **ItemsForReviewHeaderSection / ItemsForReviewSectionWrapper / ItemsForReviewSection:**
    *   **Назначение/Функция:** Секция с товарами, которые пользователь может оценить после покупки.
    *   **Взаимодействие пользователя:** Горизонтальная прокрутка. Нажатие на кнопку "Оценить" открывает экран оценки товара. Кнопка "Закрыть" скрывает элемент.
*   **BannersSection:**
    *   **Назначение/Функция:** Горизонтальный список рекламных баннеров.
    *   **Взаимодействие пользователя:** Горизонтальная прокрутка. Нажатие на баннер переводит по его ссылке.
*   **GoodsHeaderSection / GoodsSectionWrapper / GoodsSection:**
    *   **Назначение/Функция:** Секция с рекомендованными товарами.
    *   **Взаимодействие пользователя:** Горизонтальная прокрутка. Нажатие на товар открывает его детали.
*   **ThanksHeaderSection / ThanksSectionWrapper / ThanksSection:**
    *   **Назначение/Функция:** Секция с бла��одарностями или акциями.
    *   **Взаимодействие пользователя:** Горизонтальная прокрутка. Нажатие на элемент может открыть ссылку или поделиться текстом.
*   **OrderedItemsHeaderSection / OrderedItemsSectionWrapper / HorizontalItemsSection (ItemSource.LastOrdered):**
    *   **Назначение/Функция:** Секция с товарами, которые пользователь заказывал ранее.
    *   **Взаимодействие пользователя:** Горизонтальная прокрутка. Нажатие на товар открывает его детали.
*   **LastViewedItemsHeaderSection / LastViewedItemsSectionWrapper / HorizontalItemsSection (ItemSource.LastViewed):**
    *   **Назначение/Функция:** Секция с товарами, которые пользователь недавно просматривал.
    *   **Взаимодействие пользователя:** Горизонтальная прокрутка. Нажатие на товар открывает его детали.
*   **TopItemsHeaderSection / ItemsUnlimitedSection (ItemSource.Top):**
    *   **Назначение/Функция:** Секция с топовыми това��ами дня.
    *   **Взаимодействие пользователя:** Вертикальная прокрутка. Нажатие на товар открывает его детали.
*   **StateSection:**
    *   **Назначение/Функция:** Отображает состояния загрузки, ошибки или пустого состояния данных для различных секций.
    *   **Возможные состояния:** `LOADING`, `ERROR`, `EMPTY`, `HIDDEN`.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Повторить" (в состоянии ошибки) для повторной попытки загрузки данных.
*   **TooltipHomePaymentBinding:**
    *   **Назначение/Функция:** Всплывающая подсказка о способах оплаты.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Закрыть" скрывает подсказку.

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр главной ленты:**
    1.  Пользователь открывает главный экран.
    2.  Динамически загружаются и отображаются раз��ичные секции контента (советы, заказы, баннеры, товары и т.д.).
    3.  Пользователь прокручивает ленту для просмотра всего содержимого.
*   **Поиск товаров:**
    1.  Пользователь нажимает на поле поиска или иконку голосового поиска/сканера.
    2.  Переходит на соответствующий экран поиска/сканирования.
*   **Взаимодействие с советами провизора:**
    1.  Пользователь нажимает на карточку совета или кнопку "Смотреть все" в заголовке секции.
    2.  Переходит на экран деталей совета (`AdviceDetailActivity`) или на экран списка советов (`AdvicesFragment`).
*   **Просмотр заказов:**
    1.  Пользователь нажимает на карточку заказа.
    2.  Переходит на экран деталей заказа (`OrderDetailFragment`).
    3.  Нажатие на "лупу" на карточке заказа открывает экран заказа на карте (`OrdersOnMapFragment`).
*   **Авторизация:**
    1.  Неавторизованный пользователь нажимает на карточку с предложением авторизоваться.
    2.  Переходит на экран авторизации (`DashboardActivity`).
*   **Оценка товаров:**
    1.  Пользователь нажимает на кнопку "Оценить" на карточке товара в секции "Оцените товары".
    2.  Переходит на экран оценки товара (`ItemReviewFragment`).
    3.  Нажатие на "крестик" скрывает карточку товара из этой секции.
*   **Обновление приложения:**
    1.  Пользователь нажимает на карточку с предложением обновить приложение.
    2.  Инициируется процесс обновления через Google Play Core Library.
*   **Управление уведомлениями:**
    1.  Пользователь нажимает на карточку с предложением включить уведомления.
    2.  Открываются системные настройки уведомлений приложения.
*   **Поделиться приложением:**
    1.  Пользователь нажимает на кнопку "Поделиться" в секции кнопок.
    2.  Открывается системное диалоговое окно для обмена текстом.
*   **Просмотр баннеров:**
    1.  Пользователь прокручивает горизонтальный список баннеров.
    2.  Нажатие на баннер открывает соответствующую ссылку.
*   **Прокрутка к секции "Топ сегодня":**
    1.  При возвращении на главный экран из `ItemsTopFragment` (через `scrollToTopItems` в `savedStateHandle`), экран автоматически прокручивается к секции "Топ сегодня".

## 4. Навигация

С экрана "Главный" возможны следующие переходы:

*   **`CityChooseActivity`:** Для выбора города.
*   **`ItemsSearchFragment`:** Для текстового или голосового поиска товаров.
*   **`ItemsScanActivity`:** Для поиска товаров по штрих-коду.
*   **`AdvicesFragment`:** Для просмотра всех советов провизора.
*   **`AdviceDetailActivity`:** Для просмотра детальной информации о совете.
*   **`OrderDetailFragment`:** Для просмотра детальной информации о заказе.
*   **`OrdersOnMapFragment`:** Для просмотра заказов на карте.
*   **`DashboardActivity`:** Для авторизации/регистрации.
*   **`ItemReviewFragment`:** Для оценки товара.
*   **`ItemsForReviewFragment`:** Для просмотра всех товаров, ожидающих оценки.
*   **`GoodsFragment`:** Для просмотра всех мегатоваров.
*   **`OrderedEarlierFragment`:** Для просмотра всех ранее заказанных товаров.
*   **`NotificationsFragment`:** Для просмотра уведомлений.
*   **Системные настройки уведомлений:** Для управления разрешениями на уведомления.
*   **Системное диалоговое окно "Поделиться":** Для обмена текстом/ссылкой.
*   **`WebActivity`:** Для открытия внешних ссылок.
*   **`AcquaintanceFragment`:** Для ознакомле��ия с приложением.
*   **`FeaturesFragment`:** Для просмотра информации "Что нового?".
*   **`HowToOrderFragment`:** Для просмотра информации "Как заказать".
*   **`OrdersFragment` или `OrderedEarlierFragment`:** Для просмотра "Мои заказы".
*   **`AdvicesFragment`:** Для просмотра "Мегасоветы".
*   **`AddressesFragment`:** Для просмотра "Мои адреса".
*   **`CompatibilityFragment`:** Для проверки "Совместимость лекарств".
*   **`ShareFriendsFragment`:** Для использования функции "Мегаптека для друзей".
*   **`RecipeFragment`:** Для использования функции "Расшифровка рецепта".
*   **`ChatActivity` или `ItemQuestionFragment`:** Для "Задать вопрос о товаре".
*   **`StoresControlPromptFragment`:** Для просмотра "Аптечный контроль".

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:** Экран отображает множество различных типов данных, включая:
    *   `Advice`: Советы провизора.
    *   `Order`: Заказы пользователя.
    *   `Acquaintance`: Ознакомительные элементы.
    *   `HomeButton`: Кнопки быстрого доступа.
    *   `Banner`: Рекламные баннеры.
    *   `ItemForReview`: Товары для оценки.
    *   `Goods`: Рекомендованные товары.
    *   `Thanks`: Благодарности/акции.
    *   `Item`: Ранее заказанные и недавно просмотренные товары, а также топовые товары.
    *   `Economy`: Информация о выгоде.
    *   `NotificationSetting`: Настройки уведомлений.
    *   `Parameter`: Общий параметр (например, текст для обмена).
*   **Источник данных:**
    * `update` (обновление приложения): Внешний SDK (Google Play Core
         Library).
       * `currentCity` (текущий город): Локальное хранилище (CitiesDao).
       * `advices` (советы провизора): API (ApiService.getAdvicesTop (REST
          метод: GET advices/top)) и Локальное хранилище (AdvicesDao).
           * ApiService.getAdvicesTop: GET advices/top
       * `orders` (теку��ие заказы): API (ApiService.getHomeOrders) и
         Локальное хранилище (OrdersDao).
           * ApiService.getHomeOrders: GET /app/v1/orders/main
       * `acquaintances` (ознакомительные элементы): API
         (ApiService.getAcquaintances).
           * ApiService.getAcquaintances: GET /app/v1/acquaintance
       * `showAuth` (секция авторизации): Локальное хранилище (через
         AccountRepository, вероятно SharedPreferences).
           * ApiService.getAuthList: GET /app/v2/auth/list
       * `showPushSettings` (настройки push-уведомлений): Системные
         настройки уведомлений.
           * ApiService.getNotificationsSettings: GET 
             /app/v1/notifications/settings
       * `economy` (информация о выгоде): API (ApiService.getEconomy) и
         API (ApiService.getParameters через ParametersRepository).
           * ApiService.getEconomy: GET /ma/site/v4/orders/benefit
           * ApiService.getParameters: GET parameters
       * `buttons` (кнопки быстрого доступа): API
         (ApiService.getHomeButtons) и Локальное хранилище (AppDao).
           * ApiService.getHomeButtons: GET /app/v6/main/menu
       * `aiDroppedItems` (товары, рекомендованные ИИ): API
         (ApiService.getAiDroppedItems) и Локальное хранилище (ItemsDao).
           * ApiService.getAiDroppedItems: GET 
             /app/v3/items/availability-drop/main
       * `itemsForReview` (товары для оценки): API
         (ApiService.getMainItemsForReview).
           * ApiService.getMainItemsForReview: GET /app/v1/items/rate/main
       * `banners` (баннеры): API (ApiService.getBanners).
           * ApiService.getBanners: GET /app/v2/banners/main
       * `goods` (рекомендованные товары): API (ApiService.getMainGoods).
           * ApiService.getMainGoods: GET /app/v1/goods/main
       * `thanks` (благодарности/акции): API (ApiService.getThanks) и
         Локальное хранилище (ThanksDao).
           * ApiService.getThanks: GET /app/v1/thanks/main
       * `orderedItems` (ранее заказанные товары): API
         (ApiService.getOrderedMainItems) и Локальное хранилище
         (ItemsDao).
           * ApiService.getOrderedMainItems: GET 
             /app/v3/items/ordered/main
       * `lastViewedItems` (недавно просмотренные товары): API
         (ApiService.getLastViewedItems) и Локал��ное хранилище (ItemsDao).
           * ApiService.getLastViewedItems: GET /app/v3/items/viewed/main
       * `topItems` (топовые товары): API (ApiService.getTopItems) и
         Локальное хранилище (ItemsDao).
           * ApiService.getTopItems: GET /app/v2/items/top
       * `paymentPromptShow` (подсказка об оплате): Локальное хранилище
         (SharedPreferences).
       * `textShareStock` (текст для обмена): API
         (ApiService.getParameters) и Локальное хранилище (ParametersDao).
           * ApiService.getParameters: GET parameters
       * `itemHiddenForReview` (скрытые товары для оценки): API
         (ApiService.hideItemForReview).
           * ApiService.hideItemForReview: POST /app/v1/items/rate/hide
       * `settingUpdated` (обновление настроек): API
         (ApiService.updateNotificationsSettings).
           * ApiService.updateNotificationsSettings: POST 
             notifications/settings