# SplashActivity

## 1. Обзор Экрана

Экран "Заставка" (SplashActivity) является стартовым экраном приложения "Мегаптека". Он отображается при запуске приложения, выполняет необходимые инициализации (создание токена устройства, отпечатка, подсчет запусков) и определяет, куда направить пользователя дальше: на экран определения города или сразу на главный экран, если город уже выбран.

**Основные функции:**
*   Инициализация токена устройства и отпечатка.
*   Подсчет количества запусков приложения.
*   Определение наличия выбранного города.
*   Анимация логотипа и текста (для старых версий Android).
*   Перенаправление пользователя на следующий экран (выбор города или главный экран).

## 2. Элементы Пользова��ельского Интерфейса (UI Elements)

*   **ImageView (logo):**
    *   **Назначение/Функция:** Отображает логотип приложения. Анимируется при запуске на старых версиях Android.
    *   **Взаимодействие пользователя:** Неинтерактивный элемент.
*   **TextView (label):**
    *   **Назначение/Функция:** Отображает динамически генерируемый текст-слоган. Анимируется при запуске на старых версиях Android.
    *   **Взаимодействие пользователя:** Неинтерактивный элемент.

## 3. Пользовательские Сценарии (User Flows)

*   **Запуск приложения:**
    1.  Приложение запускается.
    2.  Выполняются фоновые операции: создание/миграция токена устройства, создание отпечатка, увеличение счетчика запусков.
    3.  Если версия Android >= S, происходит немедленный переход к следующему экрану в зависимости от наличия города.
    4.  Если версия Android < S, отображается экран-заставка с анимацией логотипа и текста.
    5.  После завершения анимации и проверки наличия города, происходит переход к следующему экрану.
*   **Определение следующего экрана:**
    1.  Если у пользователя уже выбран город (`viewModel.hasCurrentCity()` возвращает `true`), происходит переход на главный экран (`NavigationActivity`).
    2.  Если город не выбран, происходит переход на экран определения города (`LocationCityActivity`).

## 4. Навигация

С экрана "Заставка" возможны следующие переходы:

*   **`LocationCityActivity`:** Если город пользователя не определен.
*   **`NavigationActivity`:** Если город пользователя уже определен.

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:** Отсутствуют специфические данные, кроме статических текстов из ресурсов и флагов состояния.
*   **��сточник данных:**
    *   **Локальное хранилище:**
        *   Таблица `CitiesDao` (через `RegionsRepository` для проверки наличия текущего города).
        *   `SharedPreferences` (через `Preferences` для `deviceUUID`, `nextDayUpdate`, `appStartCount`).
    *   **Системные службы:** `PackageManager` (для `needDeviceTokenMigration`), `IdentifyUtils` (для `fingerprint`).
    *   **API:** Потенциально `ApiService.migrateDeviceId` (REST метод: `PUT /app/v1/devices/migrate-token`) (через `AppRepository` для миграции токена устройства).

## 6. Особые Состояния/Логика

*   **Обработка `isTaskRoot` и `CATEGORY_LAUNCHER`:** Проверяется, является ли активность корневой задачей и запущена ли она из лаунчера, чтобы избежать повторного запуска при возвращении из других активностей.
*   **Анимация (для старых Android):** На устройствах с Android ниже S (где нет системного Splash Screen API) реализована пользовательская анимация логотипа и текста.
*   **Динамический текст-слоган:** Текст-слоган выбирается случайным образом из массива строк и форматируется для выделения части текста жирным шрифтом.
*   **Задержка перед переходом:** Для старых версий Android предусмотрена задержка перед переходом на следующий экран, чтобы анимация успела завершиться.