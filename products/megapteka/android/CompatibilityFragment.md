# CompatibilityFragment

## 1. Обзор Экрана

Экран "Совместимость лекарств" (CompatibilityFragment) позволяет пользователю проверить совместимость двух выбранных лекарственных препаратов. Пользователь может выбрать два продукта, и система отобразит предупреждение о их совместимости, если таковое имеется.

**Основные функции:**
*   Выбор первого лекарственного препарата для проверки совместимости.
*   Выбор второго лекарственного препарата для проверки совместимости.
*   Отображение результата проверки совместимости (предупреждение или его отсутствие).
*   Возможность удаления выбранных продуктов.
*   Обработка состояний загрузки и ошибок при проверке совместимости.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **TextView (addFirstProduct, addSecondProduct):**
    *   **Назначение/Функция:** Текстовые элементы, которые действуют как кнопки для добавления первого и второго продукта соответственно.
    *   **Взаимодействие пользователя:** Нажатие открывает экран поиска продуктов (`ProductsSearchFragment`).
*   **CardView (firstProductCard, secondProductCard):**
    *   **Назначение/Функция:** Карточки, отображающие выбранные продукты. Видимы, когда продукт выбран.
    *   **Взаимодействие пользователя:** Нажатие на карточку также открывает экран поиска продуктов для изменения выбора.
*   **TextView (firstProduct, secondProduct):**
    *   **Назначение/Функция:** Отображают название выбранного первого и второго продукта соответственно.
    *   **Взаимодействие пользователя:** Неинтерактивные элементы.
*   **ImageView (removeFirstProduct, removeSecondProduct):**
    *   **Назначение/Функция:** Иконки для удаления выбранного первого и второго продукта.
    *   **Взаимодействие пользователя:** Нажатие удаляет соответствующий продукт, скрывает его карточку и очищает результат совместимости.
*   **ProgressBar (progress):**
    *   **Назначение/Функция:** Индикатор загрузки, отображаемый во время проверки совместимости.
    *   **Возможные состояния:** Видимый во время загрузки, скрытый в других состояниях.
*   **CardView (warningCard):**
    *   **Назначение/Функция:** Карточка, отображающая предупреждение о совместимости. Цвет фона карточки меняется в зависимости от типа предупреждения.
    *   **Возможные состояния:** Видима, если есть предупреждение; скрыта в противном случае.
    *   **Взаимодействие пользователя:** Неинтерактивный элемент.
*   **TextView (warningTitle, warningText):**
    *   **Назначение/Функция:** Отображают заголовок и текст предупреждения о совместимости.
    *   **Взаимодействие пользователя:** Неинтерактивные элементы.

## 3. Пользовательские Сценарии (User Flows)

*   **Выбор продуктов для проверки:**
    1.  Пользователь нажимает на "Добавить первый продукт" или на карточку первого продукта.
    2.  Открывается экран `ProductsSearchFragment` для выбора продукта (с указанием позиции 1).
    3.  Пользователь выбирает продукт на экране поиска.
    4.  Выбранный продукт возвращается на `CompatibilityFragment` и устанавливается как первый продукт.
    5.  Аналогичные шаги выполняются для выбора второго продукта (с указанием позиции 2).
*   **Проверка совместимости:**
    1.  После выбора обоих продуктов, ViewModel автоматически инициирует провер��у совместимости.
    2.  Отображается индикатор загрузки (`progress`).
    3.  При получении результата, индикатор скрывается.
    4.  Если есть предупреждение, `warningCard` отображается с соответствующим цветом и текстом.
*   **Удаление продукта:**
    1.  Пользователь нажимает на иконку "Удалить" рядом с выбранным продуктом.
    2.  Продукт удаляется, его карточка скрывается, и результат совместимости очищается.
*   **Обработка ошибок:**
    1.  При возникновении ошибки во время проверки совместимости, отображается диалог с сообщением об ошибке.
    2.  Индикатор загрузки скрывается.

## 4. Навигация

С экрана "Совместимость лекарств" возможны следующие переходы:

*   **`ProductsSearchFragment`:** Для поиска и выбора лекарственных препаратов.
*   **Диалоговые окна:** Для отображения сообщений об ошибках.

### Deep Links

На этот экран можно попасть по следующим deep links:

*   `ma://{host}/compatibility`

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `Product`: Объект, представляющий лекарственный препарат, с информацией о названии.
    *   `Warning`: Объект, представляющий предупреждение о совместимости, с заголовком, текстом и цветом.
    *   `Resource<Warning>`: Используется для отслеживания статуса проверки совместимости.
*   **Источник данных:**
    *   **API:** `ApiService.checkCompatibility` (REST метод: `GET /app/v1/compatibility`) - для проверки совместимости продуктов.
    *   **Локальное хранилище:** Нет.

## 6. Особые Состояния/Логика

*   **Видимость элементов:** Карточки продуктов и предупреждение о совместимости динамически изменяют свою видимость в зависимости от наличия выбранных продуктов и результата проверки.
*   **Цвет предупреждения:** Цвет фона `warningCard` устанавливаетс�� на основе значения `warning.getColorInt()`, что позволяет визуально различать типы предупреждений.
*   **Сброс состояния:** При удалении одного из продуктов, результат совместимости сбрасывается, и `warningCard` скрывается.