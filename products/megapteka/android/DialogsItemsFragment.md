# DialogsItemsFragment

## 1. Обзор Экрана

Экран "Товары для чата" (DialogsItemsFragment) позволяет пользователю искать товары, чтобы начать диалог с производителем или службой поддержки по конкретному продукту. Экран включает поисковую строку с голосовым вводом и отображает список товаров, соответствующих запросу.

**Основные функции:**
*   Поиск товаров по текстовому запросу.
*   Голосовой поиск товаров.
*   Отображение списка товаров с пагинацией.
*   Переход к детальному диалогу по выбранному товару.
*   Обработка состояний загрузки, ошибок и пустого списка при поиске товаров.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **EditText (searchView):**
    *   **Назначение/Функция:** Поле для ввода поискового запроса для товаров.
    *   **Взаимодействие пользователя:** Ввод текста для фильтрации списка товаров. Запросы отправляются с задержкой (debounce) для оптимизации производительности.
*   **ImageButton (searchSpeech):**
    *   **Назначение/Функция:** Кнопка для активации голосового поиска.
    *   **Возможные состояния:** Видима, если распознавание речи доступно на устройстве.
    *   **Взаимодействие пользователя:** Нажатие инициирует голосовой ввод. Иконка анимируется во время записи голоса.
*   **TextView (header):**
    *   **Назначение/Функция:** Заголовок экрана, который также может содержать кликабельную часть для перехода к списку всех диалогов.
    *   **Взаимодействие пользователя:** Нажатие на кликабельную часть текста переводит на экран `DialogsFragment`.
*   **RecyclerView:**
    *   **Назначение/Функция:** Основной контейнер для отображения секций `ItemsSection` и `StateSection`.
    *   **Взаимодействие пользователя:** Вертикальная прокрутка для просмотра содержимого.
*   **ItemsSection:**
    *   **Назначение/Функция:** Адаптер для `RecyclerView`, который управляет отображением отдельных товаров, найденных по запросу.
    *   **Взаимодействие пользователя:** Нажатие на элемент товара инициирует переход к экрану детального диалога по этому товару.
*   **StateSection:**
    *   **Назначение/Функция:** Отображает состояния загрузки, ошибки или пустого состояния данных для списка товаров.
    *   **Возможные состояния:**
        *   `LOADING`: Показывает индикатор прогресса и сообщение "Загрузка товаров".
        *   `ERROR`: Показывает сообщение об ошибке и кнопку "Повторить".
        *   `EMPTY`: Показывает сообщение о пус��ом результате поиска.
        *   `HIDDEN`: Скрыт, когда данные успешно загружены и отображаются.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Повторить" (в состоянии ошибки) для повторной попытки загрузки данных.

## 3. Пользовательские Сценарии (User Flows)

*   **Поиск товара:**
    1.  Пользователь вводит текст в поле `searchView`.
    2.  Запрос отправляется в ViewModel с задержкой (debounce).
    3.  ViewModel инициирует поиск товаров.
    4.  Отображается индикатор загрузки (`StateSection`).
    5.  При получении результатов, `ItemsSection` отображает найденные товары.
    6.  Если результатов нет, отображается `StateSection` с сообщением о пустом поиске.
*   **Голосовой поиск:**
    1.  Пользователь нажимает на иконку микрофона (`searchSpeech`).
    2.  Активируется системный распознаватель речи.
    3.  Пользовател�� произносит запрос.
    4.  Результат распознавания текста автоматически вставляется в `searchView`.
*   **Переход к диалогу по товару:**
    1.  Пользователь нажимает на товар в списке результатов поиска.
    2.  Происходит навигация к экрану `DialogDetailsFragment` с передачей ID выбранного товара.
*   **Переход к списку диалогов:**
    1.  Пользователь нажимает на кликабельную часть текста в заголовке (`header`).
    2.  Происходит навигация к экрану `DialogsFragment`.

## 4. Навигация

С экрана "Товары для чата" возможны следующие переходы:

*   **`DialogDetailsFragment`:** Для просмотра и ведения диалога по конкретному товару.
*   **`DialogsFragment`:** Для просмотра списка всех диалогов.

### Deep Links

На этот экран можно попасть по следующим deep links:

*   `ma://{host}/manufacturer/dialogs/new`

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `PagingData<DialogItem>`: Для отображения списка товаров, где `DialogItem` представляет собой товар, по которому можно начать диалог.
*   **Источник данных:**
    *   **API:** `ApiService.getDialogItems` (REST метод: `GET /app/v1/manufacturer/dialogs/items`) - для получения списка товаров для диалогов.
    *   **Локальное хранилище:** Нет.

## 6. Особые Состояния/Логика

*   **Сохранение состояния запроса:** Текущий поисковый запрос сохраняется при изменении конфигурации (например, поворот экрана) и восстанавливается.
*   **Производительность на слабых устройствах:** Для устройств с низкой производительностью аниматор элементов `RecyclerView` отключается (`viewBinding.recyclerView.itemAnimator = null`).
*   **Оптимизация поиска:** Используется `debounce` и `distinctUntilChanged` для предотвращения частых запросов при вводе текста.
*   **Анимация голосового поиска:** Иконка микрофона анимируется с использованием `AnimatedVectorDrawableCompat` ��о время записи голоса.
*   **Обработка ошибок Paging:** `handleLoadStates` обрабатывает различные состояния загрузки (начальная загрузка, добавление, ошибка) и отображает соответствующий UI через `StateSection`.