# UniqueStoresForOrderListFragment

## Обзор Экрана
`UniqueStoresForOrderListFragment` — это фрагмент, который отображает список аптек, где доступен для заказа конкретный уникальный товар. Он предоставляет пользователю информацию о товаре (изображение, название, цена, количество), список аптек с ценами и доступностью, а также предупреждения, если таковые имеются. Пользователь может изменять количество товара, просматривать детали заказов в аптеке, информацию о доступности для маломобильных групп и выбирать аптеку для оформления заказа.

## Элементы Пользовательского Интерфейса (UI Elements)
*   **RecyclerView**:
    *   **Назначение/Функция**: Основной контейнер для отображения списка аптек, предупреждений и состояния загрузки. Использует `ConcatAdapter` для объединения различных секций.
    *   **Возможные состояния**: Отображение списка аптек, пустое состояние (с сообщением "Нет аптек для заказа" и кнопкой "Вернуться в корзину"), состояние загрузки (с индикатором прогресса и сообщением "Загрузка аптек..."), состояние ошибки (с сообщением об ошибке и кнопкой "Повторить").
    *   **Взаимодействие пользователя**: Прокрутка списка.
*   **Информация о товаре (включенный макет `includedBottomItem`)**:
    *   **Назначение/Функция**: Отображает изображение товара (`itemImage`), название (`itemName`), цену от (`itemAmount`), точную цену (`itemPrice`) и контрол для изменения количества (`itemShopper`).
    *   **Возможные состояния**: Отображение данных товара.
    *   **Взаимодействие пользователя**: Нажатие на кнопки "+" и "-" в `itemShopper` для измене��ия количества товара.
*   **Предупреждения (через `CheckWarningsSection`)**:
    *   **Назначение/Функция**: Отображает список предупреждений, связанных с заказом или аптеками (например, о недоступности товара).
    *   **Возможные состояния**: Видимые (если есть предупреждения), скрытые.
    *   **Взаимодействие пользователя**: Нажатие на кнопки в предупреждениях (например, "Сбросить фильтры").
*   **Список аптек (через `StoresSection`)**:
    *   **Назначение/Функция**: Отображает список аптек с информацией о цене товара в каждой из них, доступности и возможностью выбора.
    *   **Возможные состояния**: Отображение списка аптек.
    *   **Взаимодействие пользователя**: Нажатие на аптеку для фокусировки, нажатие на кнопку "Заказы в аптеке" для просмотра деталей, нажатие на иконку доступности, нажатие на кнопку "Выбрать".
*   **Индикатор прогресса/Сообщения о состоянии (через `StateSection`)**:
    *   **Назначение/Функция**: Отображает сообщения о состоянии (загрузка, пусто, ошибка) и индикатор прогресса.
    *   **Возможные состояния**: Видимый (в зависимости от состояния данных), скрытый.
    *   **Взаимодействие пользователя**: Нажатие на кнопку "Повторить" при ошибке, нажатие на кнопку "Вернуться в корзину" в пустом состоянии.

## Пользовательские Сценарии (User Flows)
*   **Просмотр доступных аптек**: Пользователь переходит на этот экран, чтобы увидеть, в каких аптеках доступен выбранный уникальный товар.
*   **Изменение количества товара**: Пользователь может увеличить или уменьшить количество товара, которое он хочет заказать.
*   **Просмотр предупреждений**: Пользователь видит предупреждения, если есть проблемы с заказом или доступностью.
*   **Просмотр деталей заказов в аптеке**: Пользователь может развернуть информацию об аптеке, чтобы увидеть, какие еще товары из его корзины доступны в этой аптеке.
*   **Просмотр информации о доступности**: Пользователь может нажать на иконку доступности, чтобы получить подробную информацию о доступности аптеки для маломобильных групп.
*   **Выбор аптеки**: Пользователь выбирает аптеку, в которой он хочет оформить заказ.
*   **Повторная загрузка данных**: При возникновении ошибки загрузки данных пользователь может нажать кнопку "Повторить" для повторной попытки.
*   **Возврат в корзину**: В пустом состоянии пользователь может вернуться в корзину.

## Навигация
*   **Переход на `UniqueStoresForOrderListFragment`**:
    *   Является частью `UniqueStoresForOrderFragment` и отображается внутри него.
*   **Переход с `UniqueStoresForOrderListFragment`**:
    *   На предыдущий экран (корзина): При нажатии на кнопку "Вернуться в корзину" в пустом состоянии (`findNavController().popBackStack()`).
    *   По диплинку: При нажатии на кнопку в предупреждении (`link?.navigateDeeplink`).
    *   Обновление списка: Изменение количества товара или скрытие предупреждений может привести к обновлению списка аптек.

### Deep Links

На этот экран нет прямых deep links.

## Отображаемые Данные
*   **Типы данных**: Объект `UniqueItem` (информация о товаре), список объектов `Check` (информация об аптеках и их предложениях), список объектов `CheckWarning` (предупреждения).
*   **Источники данных**:
    *   **API:**
        *   `ApiService.checkPreorderOrder` (REST метод: `GET /app/v1/preorders/check`) - для получения списка аптек для предзаказа (данные передаются из родительского ViewModel).
        *   `ApiService.checkDiscountedOrder` (REST метод: `GET /app/v1/discounted/orders/check`) - для получения списка аптек для уцененного заказа (данные передаются из родительского ViewModel).
        *   `ApiService.getOrdersInStore` (REST метод: `GET /app/v1/orders/store`) - для получения списка заказов в конкретной аптеке.
    *   **Локальное хранилище:** Нет прямого использования локального хранилища для списка аптек, но данные о выбранной аптеке могут быть сохранены через `StoresDao` в родительском фрагменте.

## Особые Состояния/Логика
*   **Обработка состояний данных**: Фрагмент отслеживает состояние ресурсов (`Resource<List<Check>>` и `List<CheckWarning>`) для отображения соответствующего UI (прогресс, данные, пусто, ошибка).
*   **Изменение количества товара**: Методы `onQuantityInc` и `onQuantityDec` в `ShopperListener` обрабатывают увеличение/уменьшение количества товара и отправляют соответствующие события в `ViewModel`.
*   **`ConcatAdapter`**: Используется для эффективного объединения нескольких адаптеров (для предупреждений, аптек и состояния) в один `RecyclerView`.
*   **Оптимизация для слабых устройств**: Отключается анимация `itemAnimator` для `RecyclerView`.
*   **Взаимодействие с ViewModel**: Фрагмент вызывает методы `resetFilters`, `getOrdersInStore`, `focusStore`, `chooseStore`, `incQuantity`, `decQuantity` в `UniqueStoresForOrderViewModel`.
*   **Аналитика**: Отслеживаются события изменения количества уникального товара (`AnEvent.incUniqueItemQuantity`, `AnEvent.decUniqueItemQuantity`).