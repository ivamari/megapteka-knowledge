# GroupsFragment

## Обзор Экрана
`GroupsFragment` — это фрагмент, который отображает список товарных групп и подгрупп, являясь частью более крупного экрана "Каталог". Он позволяет пользователю просматривать категории товаров, разворачивать их для просмотра подгрупп и переходить к списку товаров по выбранной подгруппе. Фрагмент обрабатывает различные состояния загрузки данных и ошибки.

## Элементы Пользовательского Интерфейса (UI Elements)
*   **RecyclerView**:
    *   **Назначение/Функция**: Отображает динамический список товарных групп и подгрупп в виде сетки (GridLayoutManager).
    *   **Возможные состояния**: Отображение данных, пустое состояние (с сообщением "Пусто"), состояние загрузки (с индикатором прогресса и сообщением "Загрузка групп..."), состояние ошибки (с сообщением об ошибке и кнопкой "Повторить").
    *   **Взаимодействие пользователя**: Прокрутка списка, нажатие на группу для её разворачивания/сворачивания, нажатие на подгруппу для перехода к списку товаров.
*   **Индикатор прогресса/Сообщения о состоянии (через `StateSection`)**:
    *   **Назначение/Функция**: Отображает сообщения о состоянии (загрузка, пусто, ошибка) и индикатор прогресса.
    *   **Возможные состояния**: Видимый (в зависимости от состояния данных), скрытый.
    *   **Взаимодействие пользователя**: Нажатие на кнопку "Повторить" при ошибке.

## Пользовательские Сценарии (User Flows)
*   **Просмотр категорий товаров**: Пользователь открывает экран "Каталог" и видит список основных товарных групп.
*   **Разворачивание/сворачивание группы**: Пользователь нажимает на заголовок группы, чтобы увидеть или скрыть её подгруппы.
*   **Переход к списку товаров**: Пользователь нажимает на конкретную подгруппу, чтобы перейти на экран со списком товаров, относящихся к этой подгруппе.
*   **Повторная загрузка данных**: При возникновении ошибки загрузки данных пользователь может нажать кнопку "Повторить" для повторной попытки.

## Навигация
*   **Переход на `GroupsFragment`**:
    *   Является частью `CatalogFragment` и отображается внутри него.
*   **Переход с `GroupsFragment`**:
    *   На экран `ItemsFragment`: При нажатии на подгруппу осуществляется переход к экрану `ItemsFragment` с передачей кода и названия подгруппы (`BottomNavDirections.actionToItems`).

### Deep Links

На этот экран нет прямых deep links.

## Отображаемые Данны��
*   **Типы данных**: Список объектов `Group`, каждый из которых может содержать список `Subgroup`.
*   **Источники данных**: 
    *   **API:**
        *   `ApiService.getGroups` (REST метод: `GET /app/v1/groups`) - для получения списка групп.
        *   `ApiService.getGroup` (REST метод: `GET /ma/site/v2/groups` или `GET /app/v1/groups`) - для получения информации о конкретной группе.
    *   **Локальное хранилище:** Нет.

## Особые Состояния/Логика
*   **Обработка состояний данных**: Фрагмент отслеживает состояние ресурса (`Resource.Status.LOADING`, `Resource.Status.SUCCESS`, `Resource.Status.ERROR`) для отображения соответствующего UI (прогресс, данные, ошибка).
*   **Адаптивная сетка**: Используется `GridLayoutManager` с динамическим `spanSizeLookup` для отображения элементов в 1 или 2 колонки в зависимости от свойства `isFullWidth` группы.
*   **Оптимизация для слабых устройств**: На устройствах с низкой производительностью отключается анимация `itemAnimator` для `RecyclerView`.
*   **Аналитика**: Отслеживаются события нажатия на подгруппы (`AnEvent.subgroupClick`) и разворачивания групп (`AnEvent.groupClick`).
*   **Вложенность**: Фрагмент является вложенным (`isNested = true`) и получает имя экрана от родительского фрагмента (`CatalogFragment`).
*   **Декорации элементов**: Используются `DividerItemDecoration` для разделителей и `SpacesItemDecoration` для отступов между элементами списка.