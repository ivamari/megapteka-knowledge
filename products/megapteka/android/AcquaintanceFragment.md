# AcquaintanceFragment

## 1. Обзор Экрана

Экран "Давайте знакомиться" (AcquaintanceFragment) предназначен для ознакомления новых или возвращающихся пользователей с ключевыми функциями, акциями или важной информацией приложения "Мегаптека". Он служит в качестве онбординга или информационного экрана, представляя пользователю список интерактивных элементов, каждый из которых ведет к определенному разделу или действию в приложении.

**Основные функции:**
*   Отображение списка ознакомительных элементов.
*   Отслеживание прогресса выполнения ознакомительных задач.
*   Навигация пользователя к соответствующим функциям или разделам приложения.
*   Обработка различных состояний загрузки данных (загрузк��, успех, ошибка, пусто).

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **RecyclerView**:
    *   **Назначение/Функция:** Основной контейнер для отображения всех секций экрана (состояние, заголовок, список ознакомительных элементов).
    *   **Возможные состояния:** Отображает контент, управляет прокруткой.
    *   **Взаимодействие пользователя:** Вертикальная прокрутка для просмотра содержимого.
*   **StateSection**:
    *   **Назначение/Функция:** Отображает состояния загрузки, ошибки или пустого состояния данных.
    *   **Возможные состояния:**
        *   `LOADING`: Показывает индикатор прогресса и сообщение "Загрузка".
        *   `ERROR`: Показывает сообщение об ошибке и кнопку "Повторить".
        *   `HIDDEN`: Скрыт, когда данные успешно загружены и отображаются.
    *   **Взаимодействие пользователя:** Нажатие на кнопку "Повторить" (в состоянии ошибки) для повторной попытки загрузки данных.
*   **HeaderSection**:
    *   **Назначение/Функция:** Отображает заголовок или вступительный текст для списка ознакомительных элементов.
    *   **Возможные состояния:** Отображает данные, переданные из ViewModel.
    *   **Взаимодействие пользователя:** Не имеет прямых интерактивных элементов.
*   **AcquaintancesSection**:
    *   **Назначение/Функция:** Отображает список индивидуальных ознакомительных элементов. Каждый элемент может содержать заголовок, описание и кнопку/ссылку.
    *   **Возможные состояния:** Отображает данные, переданные из ViewModel.
    *   **Взаимодействие пользователя:** Нажатие на элемент или его кнопку инициирует навигацию или выполнение определенного действия.

## 3. Пользовательские Сценарии (User Flows)

*   **Инициализация и загрузка данных:**
    1.  Экран открывается.
    2.  Отображается индикатор загрузки (`StateSection`).
    3.  ViewModel запрашивает список ознакомительных элементов.
*   **Успешное отображение контента:**
    1.  Данные успешно получены.
    2.  Индикатор загрузки скрывается.
    3.  `HeaderSection` и `AcquaintancesSection` отображают полученные данные.
*   **Взаимодействие с ознакомительным элементом:**
    1.  Пользователь нажимает на один из элементов списка или его кнопку.
    2.  Регистрируется аналитическое событие (`AnEvent.acquaintanceClick`).
    3.  В ViewModel отправляется событие `sendAcquaintanceEvent`.
    4.  Выполняется навигация в зависимости от ссылки (`it.button?.link`):
        *   Если ссылка `ma://megapteka.ru/notifications/enable-push`, открываются системные настройки уведомлений приложения.
        *   Если ссылка `ma://megapteka.ru/items/top`, происходит возврат на `homeFragment` с прокруткой к верхним элементам.
        *   Для других deep-ссылок выполняется навигация по указанной ссылке.
*   **Пустое состояние данных:**
    1.  Если список ознакомительных элементов пуст или равен null.
    2.  Экран закрывается (`popBackStack`).
*   **Состояние ошибки:**
    1.  При возникновении ошибки загрузки данных.
    2.  `StateSection` отображает сообщение об ошибке и кнопку "Повторить".

## 4. Навигация

С экрана "Давайте знакомиться" возможны следующие перехо��ы:

*   **Настройки уведомлений приложения:** При нажатии на элемент с deep-ссылкой `ma://megapteka.ru/notifications/enable-push`.
*   **Главный экран (`homeFragment`):** При нажатии на элемент с deep-ссылкой `ma://megapteka.ru/items/top`. Экран `homeFragment` будет прокручен к верхним элеме��там.
*   **Другие экраны приложения:** Через обработку общих deep-ссылок, указанных в данных ознакомительных элементов (например, на экраны товаров, акций, категорий и т.д.).
*   **Закрытие экрана:** Экран может быть закрыт (удален из стека навигации) автоматически, если список ознакомительных элементов пуст.

### Deep Links

На этот экран нет прямых deep links.

## 5. Отображаемые Данные

*   **Типы данных:** Основной тип данных, отображаемый на экране, — это список объектов `Acquaintance`. Каждый объект `Acquaintance` предположительно содержит:
    *   `id`: Уникальный идентификатор элемента.
    *   `title`: Заголовок или краткое описание элемента.
    *   `button`: Опциональный объект, содержащий `text` (текст кнопки) и `link` (deep-ссылка для навигации).
    *   `isCompleted`: Булево значение, указывающее, выполнен ли данный ознакомительный элемент.
*   **И��точник данных:**
    *   **API:** `ApiService.getAcquaintances` (REST метод: `GET /app/v1/acquaintance`)
    *   **Локальное хранилище:** Нет прямого использования локального хранилища для получения списка `Acquaintance` в этом методе.

## 6. Особые Состояния/Логика

*   **Отсутствие интернет-соединения/ошибки загрузки:**
    *   В случае ошибки загрузки данных (`Resource.Status.ERROR`), `StateSection` отображает соответствующее сообщение об ошибке.
*   **Пустые списки данных:**
    *   Если `resource.data.isNullOrEmpty()` (т.е. нет ознакомительных элементов для отображения), фрагмент автоматически закрывается (`findNavController().popBackStack()`).
*   **Бизнес-логика:**
    *   **Отслеживание выполнения задач:** Метод `attributes()` используется для аналитики, подсчитывая количество выполненных задач (`isCompleted`) из общего числа ознакомительных элементов.
    *   **Ус��овная навигация по deep-ссылкам:** В зависимости от содержимого deep-ссылки, приложение выполняет различные действия: открывает системные настройки, переходит на главный экран с определенным поведением или осуществляет общую навигацию по deep-ссылке.
    *   **Аналитика:** Каждое взаимодействие с ознакомительным элементом логируется через `AnUtils.logEvent` для отслеживания пользовательского поведения.