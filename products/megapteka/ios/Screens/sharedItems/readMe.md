# Экран "Поделиться товарами" (SharedItemsVC)

## Описание и назначение экрана
Экран предназначен для просмотра, выбора и добавления в корзину списка товаров, которые были кем-то поделены с пользователем по специальной ссылке или коду. Пользователь может выбрать все или отдельные товары, изменить их количество, увидеть итоговую сумму и добавить выбранные позиции в свою корзину. Экран часто используется в сценариях совместных покупок или рекомендаций.

## Общая иерархия экрана
Экран реализован на базе `UIViewController` (`SharedItemsVC`) с использованием вертикального стека и таблицы (`UITableView`). Основная разметка строится через XIB-файл. Вся основная область — это одна секция таблицы с кастомным header и ячейками товаров.

---

## 1. Верхняя панель
- На экране отсутствует стандартная верхняя панель навигации (`hiddenNavBar = true`).
- Встраивается в модальное окно (`ModalCardVC`), где верхняя и нижняя панели скрыты.

---

## 2. Основная область (основной контент)

### 2.1. Секции и их элементы

#### 2.1.1. Секция товаров (единственная секция)
- **Кодовое имя секции:** `items` (`Section.items`)
- **Header секции:**
  - Класс: `SharedItemsMarkingHeaderView`
  - Элементы:
    - Кнопка "Выбрать все" (`ButtonWithSelection`)
    - Разделительная линия (`UIView`)
  - Взаимодействие: нажатие на чекбокс выбирает/снимает выбор со всех товаров в списке.

- **Ячейки секции:**
  - Класс: `MarkableItemView` (через `MarkableItemsTCM`)
  - Каждый товар отображается отдельной ячейкой с многоуровневой структурой:
    - Чекбокс выбора товара (`ButtonWithSelection`)
    - Картинка товара (`ItemImageView`)
    - Название товара (`ExtendedHitLabel`)
    - Производитель (`ExtendedHitLabel`)
    - Цена (`ExtendedHitLabel`)
    - Количество аптек/наличие (`ExtendedHitLabel`)
    - Кнопка "В избранное" (`ItemFavoriteButton`)
    - Кнопка удаления товара (`ExtendedHitButton`)
    - Кнопки изменения количества (+/-) и счетчик (`ItemActionButtonsListView`) — [Нужно дополнить: описание поведения и ограничений]
    - Цена за штуку при количестве > 1 (`ExtendedHitLabel`)
    - Коллекция стикеров/индикаторов (`UICollectionView`)
    - Блок ворнингов/предупреждений (`UIStackView`) — отображается только при наличии предупреждений по товару
    - Разделительная линия (`UIView`)
  - Взаимодействие:
    - Чекбокс — выбор/снятие выбора товара
    - Кнопки +/- — изменение количества (при достижении лимитов — ворнинг)
    - Кнопка "В избранное" — добавление/удаление из избранного
    - Кнопка удаления — удаляет товар из списка
    - Нажатие на ячейку — открывает подробную карточку товара (`ItemDetailVC`)
    - Кнопка "Похожие" — открывает экран похожих товаров (`ItemsSimilarVC`)
    - Кнопка "Личные заказы" — открывает экран личных заказов по товару (`ItemPersonalOrderedVC`)

---

## 3. Всплывающие и дополнительные элементы
- Алерты (`AlertModel`) — отображаются через стандартный механизм showAlert, например, при ошибках или лимитах.
- Ворнинги (желтые плашки) — могут появляться внутри ячеек товаров, если товар недоступен или есть особые условия доставки (например, "под заказ от 3 дней").

---

## 4. Нижняя навигационная панель
- Отсутствует. Экран встроен в модальное окно, нижняя панель скрыта.

---

## 5. Открываемые экраны при взаимодействии с элементами
- Кнопка "Похожие" — открывает экран похожих товаров (`ItemsSimilarVC`)
- Кнопка "Личные заказы" — открывает экран личных заказов по товару (`ItemPersonalOrderedVC`)
- Нажатие на ячейку товара — открывает подробную карточку товара (`ItemDetailVC`)
- Кнопка "Добавить в корзину" — добавляет выбранные товары в корзину и закрывает экран

---

## 6. Схематичное дерево иерархии экрана
```
Экран "Общие товары" (SharedItemsVC)
├── Основная область (UIStackView)
│   └── Таблица товаров (UITableView)
│       └── Секция товаров (Section.items)
│           ├── Header секции (SharedItemsMarkingHeaderView)
│           │   ├── Кнопка "Выбрать все" (ButtonWithSelection)
│           │   └── Разделитель (UIView)
│           └── Ячейки товаров (MarkableItemView)
│               ├── Чекбокс выбора (ButtonWithSelection)
│               ├── Картинка товара (ItemImageView)
│               ├── Название (ExtendedHitLabel)
│               ├── Производитель (ExtendedHitLabel)
│               ├── Цена (ExtendedHitLabel)
│               ├── Количество аптек/наличие (ExtendedHitLabel)
│               ├── Кнопка "В избранное" (ItemFavoriteButton)
│               ├── Кнопка удаления (ExtendedHitButton)
│               ├── Кнопки +/- и счетчик (ItemActionButtonsListView)
│               ├── Цена за штуку (ExtendedHitLabel)
│               ├── Коллекция стикеров (UICollectionView)
│               ├── Блок ворнингов (UIStackView) — при необходимости
│               └── Разделитель (UIView)
│
├── Нижняя область (UIView)
│   ├── Лейбл "Количество товаров" (UILabel)
│   ├── Лейбл "Сумма" (UILabel)
│   └── Кнопка "Добавить в корзину" (UIButton)
│
└── [Всплывающие элементы]
    ├── Алерты (AlertModel)
    └── Модальные окна/ворнинги
```

---

## [Нужно дополнить]
- Описание поведения и ограничений блока изменения количества (`ItemActionButtonsListView`): лимиты, ворнинги, обработка ошибок.
- Описание возможных дополнительных модальных окон и ворнингов, которые могут появляться при ошибках или лимитах.
- Возможные дополнительные действия в ячейке товара, если есть другие кнопки или элементы. 
