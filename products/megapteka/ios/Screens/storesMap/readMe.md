# Экран «Аптека на карте» (StoresMapVC)

## Описание и назначение экрана
Экран предназначен для отображения аптек на карте, выбора конкретной аптеки и просмотра подробной информации о ней. Пользователь может увидеть расположение аптек, узнать подробности о выбранной аптеке, построить маршрут, а также получить сведения о времени работы, расстоянии, бренде, доступности и других параметрах. Экран является частью сценария выбора аптеки для заказа или получения информации.

## Общая иерархия экрана
Экран реализован на базе UIViewController (`StoresMapVC`) с использованием кастомных компонентов и BottomSheet для отображения карточки аптеки. Основные области:
- Верхняя панель (навигационный бар)
- Основная область (карта с маркерами аптек и плавающая карточка аптеки)
- Всплывающие элементы (BottomSheet с информацией об аптеке)

---

## 1. Верхняя панель
### 1.1. Назначение и элементы
- **Заголовок** (`navigationItem.title`): «Аптека на карте»
  - Отображается всегда, не содержит дополнительных кнопок.

---

## 2. Основная область (контент)
Экран состоит из карты (`viewMap: UIView`), на которую накладываются элементы управления и карточка аптеки.

### 2.1. Элементы управления картой (StackViewPassthroughHit)
Расположены вертикально справа поверх карты:
- **Кнопка компаса** (`CompassButton`)
  - Сброс ориентации карты. Появляется при изменении направления.
  - Взаимодействие: нажатие сбрасывает компас.
- **Кнопка «Мое местоположение»** (`UIButton`, styleOnlyImage: goToCurrentLocation)
  - Перемещает карту к текущей геолокации пользователя.
  - Взаимодействие: нажатие, при отсутствии разрешения — алерт с переходом в настройки.
- **Кнопка «Плюс» (Zoom In)** (`UIButton`, styleOnlyImage: zoomIn)
  - Приближает карту. Поддерживает удержание для плавного увеличения.
- **Кнопка «Минус» (Zoom Out)** (`UIButton`, styleOnlyImage: zoomOut)
  - Отдаляет карту. Поддерживает удержание для плавного уменьшения.

### 2.2. Карта (`BaseMapAdapter`)
- Отображает маркеры аптек.
- Поддерживает выбор аптеки, скроллинг, масштабирование, сброс компаса.
- Взаимодействие: выбор маркера — отображение карточки аптеки.

### 2.3. Карточка аптеки (BottomSheet, `StoreMapView`)
Всплывающая панель поверх карты, появляется при выборе аптеки.

#### Секции и элементы карточки:
- **Адрес аптеки** (`labelAddress`, `viewAddressContainer`)
  - Всегда отображается, неактивен для нажатия.
- **Метро** (`stackViewMetro`)
  - Отображается, если у аптеки есть станции метро.
- **Бренд аптеки** (`imageViewBrand`, `labelBrand`, `viewBrandContainer`)
  - Логотип и название бренда.
- **Расстояние и время** (`labelDistance`, `labelDistanceTime`, `viewDistanceBg`, `viewDistanceTimeBg`)
  - Показывает расстояние до аптеки и примерное время в пути.
- **Доступность для маломобильных** (`viewAccessibility: StoreAccessibilityView`)
  - Иконка, если аптека доступна для МГН.
- **График работы** (`labelSchedule`, `viewScheduleContainer`)
  - Основное расписание аптеки.
- **Описание графика** (`textViewScheduleDescr`)
  - Подробное описание, раскрывается по действию.
- **Дата готовности заказа** (`labelArrivalDate`)
  - Если применимо, отображает дату, когда заказ будет готов.
- **Время сборки заказа** (`labelBuildTime`)
  - Минимальное время сборки заказа.
- **Срок брони** (`labelReservationDays`)
  - Сколько дней заказ будет ждать в аптеке.
- **Варнинги/предупреждения** (`stackViewWarnings`)
  - Динамически отображаются предупреждения (например, о графике работы).
- **Кнопка «Построить маршрут»** (`buttonRoute: ExtendedHitButton`)
  - Открывает экран построения маршрута.
  - Взаимодействие: нажатие вызывает переход к построению маршрута.

---

## 3. Всплывающие и дополнительные элементы
- **BottomSheet (ViBottomSheetVC)**
  - Карточка аптеки появляется/скрывается при выборе/снятии выбора аптеки.
  - Может менять высоту (сворачивается, разворачивается).
  - Взаимодействие: свайп вниз скрывает карточку, нажатие на элементы — действия.
- **Алерт о разрешении геолокации**
  - Показывается при попытке перейти к текущей локации без разрешения.

---

## 4. Нижняя навигационная панель
На экране отсутствует нижняя навигационная панель.

---

## 5. Открываемые экраны при взаимодействии с элементами
- **Кнопка «Построить маршрут»** (buttonRoute)
  - Открывает: Экран построения маршрута (RouteBuildingWorker, внешний экран)
- **Кнопка «Мое местоположение»**
  - При отсутствии разрешения — открывает системные настройки.
- **Свайп по карточке аптеки вниз**
  - Скрывает карточку, снимает выбор аптеки.

---

## 6. Схематичное дерево иерархии экрана
```
Экран «Аптека на карте» (StoresMapVC)
├── Верхняя панель (UINavigationBar)
│   └── Заголовок: «Аптека на карте»
├── Основная область (viewMap: UIView)
│   ├── Карта (BaseMapAdapter)
│   ├── Элементы управления картой (StackViewPassthroughHit)
│   │   ├── Кнопка компаса (CompassButton)
│   │   ├── Кнопка «Мое местоположение» (UIButton)
│   │   ├── Кнопка «Плюс» (UIButton)
│   │   └── Кнопка «Минус» (UIButton)
│   └── Карточка аптеки (BottomSheet, StoreMapView)
│       ├── Адрес аптеки (labelAddress)
│       ├── Метро (stackViewMetro)
│       ├── Бренд аптеки (imageViewBrand, labelBrand)
│       ├── Расстояние и время (labelDistance, labelDistanceTime)
│       ├── Доступность для МГН (viewAccessibility)
│       ├── График работы (labelSchedule)
│       ├── Описание графика (textViewScheduleDescr)
│       ├── Дата готовности заказа (labelArrivalDate)
│       ├── Время сборки заказа (labelBuildTime)
│       ├── Срок брони (labelReservationDays)
│       ├── Варнинги/предупреждения (stackViewWarnings)
│       └── Кнопка «Построить маршрут» (buttonRoute)
└── Всплывающие элементы
    └── BottomSheet (ViBottomSheetVC)
```

---

## [Нужно дополнить]
- Не хватает информации о точных условиях отображения некоторых элементов карточки (например, когда показывается дата готовности заказа, варнинги и др.).
- Не раскрыта логика появления/скрытия некоторых элементов (например, описание графика, предупреждения).
- Не описаны все возможные состояния карты (например, если нет аптек, если нет доступа к геолокации).
- Не указаны все возможные действия с маркерами на карте (например, если поддерживается кластеризация или фильтрация). 