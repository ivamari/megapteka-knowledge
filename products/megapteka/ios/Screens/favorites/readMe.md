# Экран «Избранное» (FavoritesVC)

## Описание и назначение экрана
Экран «Избранное» предназначен для отображения списка товаров, добавленных пользователем в избранное, а также рекомендаций, советов и специальных предложений. Пользователь может просматривать, искать, сортировать, удалять товары из избранного, переходить к подробной информации о товаре, добавлять товары в корзину, а также получать советы и рекомендации. Экран также информирует пользователя о важных событиях (например, необходимости авторизации или снижении доступности товара).

## Общая иерархия экрана
Экран реализован на основе UIViewController (`FavoritesVC`) с использованием UITableView для отображения секций и элементов. Верхняя панель содержит заголовок и строку поиска. Основная область состоит из секций: предупреждения, меню, фильтры, информационный блок, избранные товары, рекомендации, а также динамически отображаемые всплывающие элементы. В нижней части экрана расположена навигационная панель.

---

## 1. Верхняя панель
### 1.1. Назначение и элементы
- **Заголовок экрана** (navigationItem.title)
  - Название: «Избранное»
  - Отображается всегда.
- **Кнопка поиска** (SearchBarService)
  - Поле для ввода поискового запроса по товарам в избранном.
  - Отображается, если в избранном есть товары или активен поиск.
  - Взаимодействие: ввод текста, очистка, отмена поиска.
  - При вводе текста фильтрует список товаров, при отмене — сбрасывает поиск.

---

## 2. Основная область (основной контент)
Основная область реализована через UITableView (`tableView`), разбитую на секции. Секции могут динамически отображаться или скрываться в зависимости от состояния экрана.

### 2.1. Секции и их элементы

- **Секция предупреждений** (`FavoritesWarningView`)
  - Назначение: информирование пользователя о важных событиях (например, неавторизованный пользователь, снижение доступности товара).
  - Элементы:
    - Фон (желтый)
    - Иконка предупреждения
    - Заголовок
    - Описание с возможной ссылкой (например, на авторизацию)
    - Кнопка закрытия
  - Логика отображения: появляется при наличии соответствующего предупреждения в данных.
  - Взаимодействие: нажатие на ссылку (открывает экран авторизации), нажатие на крестик скрывает предупреждение.

- **Секция меню** (`FavoritesMenuItemView`)
  - Назначение: быстрый доступ к советам провизора и мегасоветам.
  - Элементы:
    - Ячейки меню:
      - Совет провизора
      - Мегасоветы
  - Взаимодействие: нажатие открывает соответствующий экран.
    - Совет провизора → экран советов (AdvicesVC)
    - Мегасоветы → экран мегасоветов (SpecialListVC)

- **Секция фильтров** (`SearchFiltersView`)
  - Назначение: фильтрация и сортировка товаров в избранном.
  - Элементы:
    - Кнопка сортировки
    - [Могут быть другие фильтры, если они доступны]
  - Логика отображения: отображается, если есть товары и доступные фильтры.
  - Взаимодействие: нажатие на сортировку открывает экран сортировки (ItemsSortsVC).

- **Секция информационного блока** (`FavoritesInfoView`)
  - Назначение: информирование пользователя о возможности получать push-уведомления о снижении цены на избранные товары.
  - Элементы:
    - Текст с HTML-ссылкой «управлять»
  - Логика отображения: отображается, если в избранном есть товары.
  - Взаимодействие: нажатие на ссылку открывает настройки уведомлений (экран по deeplink).

- **Секция гибкого промпта** (`FlexiblePromptView`)
  - Назначение: отображение различных информационных или пустых состояний (например, «ничего не найдено», «нет избранных товаров»).
  - Элементы:
    - Иллюстрация
    - Заголовок
    - Описание
    - Кнопка действия (например, «В каталог»)
  - Логика отображения: появляется при отсутствии товаров, ошибке или пустом результате поиска.
  - Взаимодействие: нажатие на кнопку может открыть каталог или повторить запрос.

- **Секция избранных товаров** (`CatalogueItemsTCM`)
  - Назначение: отображение списка товаров, добавленных в избранное.
  - Элементы (каждая ячейка):
    - Изображение товара
    - Название товара
    - Производитель
    - Цена
    - Количество аптек
    - Кнопка «В корзину»
    - Кнопка «Удалить из избранного» (иконка сердца)
  - Логика отображения: отображается, если есть товары в избранном.
  - Взаимодействие:
    - Нажатие на товар — переход к деталям товара (ItemDetailVC)
    - Нажатие на «В корзину» — добавление товара в корзину
    - Нажатие на сердце — удаление из избранного

- **Секция рекомендаций** (`CatalogueItemsTCM` с header `SectionNameHeaderView`)
  - Назначение: отображение товаров, рекомендованных пользователю.
  - Элементы:
    - Заголовок секции «Подобрано для вас»
    - Ячейки товаров (структура аналогична избранным товарам)
  - Логика отображения: отображается, если есть рекомендации и не активен поиск.
  - Взаимодействие: аналогично секции избранных товаров.

---

## 3. Всплывающие и дополнительные элементы
- **Гибкие промпты** (`FlexiblePromptView`)
  - Назначение: отображение ошибок, пустых состояний, информационных сообщений.
  - Условия показа: отсутствие товаров, ошибка загрузки, пустой результат поиска.
  - Взаимодействие: кнопки действий (например, «В каталог», «Повторить попытку»).

- **Ворнинги** (`FavoritesWarningView`)
  - Назначение: предупреждения о потере данных, необходимости авторизации, снижении доступности товара.
  - Условия показа: наличие соответствующих предупреждений в данных.
  - Взаимодействие: закрытие, переход по ссылке.

---

## 4. Нижняя навигационная панель
- **TabBar (UITabBarController)**
  - Кнопки:
    - Главный
    - Каталог
    - Корзина
    - Избранное (активная)
    - Меню
  - Взаимодействие: переход между основными разделами приложения.

---

## 5. Открываемые экраны при взаимодействии с элементами

- **Кнопка «Советы провизора»**
  - Открывает: Экран советов (AdvicesVC)
- **Кнопка «Мегасоветы»**
  - Открывает: Экран мегасоветов (SpecialListVC)
- **Кнопка сортировки**
  - Открывает: Экран сортировки (ItemsSortsVC)
- **Кнопка «В корзину»**
  - Добавляет товар в корзину (без перехода)
- **Кнопка «Удалить из избранного»**
  - Удаляет товар из избранного (без перехода)
- **Ячейка товара**
  - Открывает: Экран деталей товара (ItemDetailVC)
- **Ссылка «управлять»** в информационном блоке
  - Открывает: Экран настроек уведомлений (deeplink)
- **Кнопка «В каталог»** (в гибком промпте)
  - Открывает: Экран каталога (CatalogVC)
- **Ссылка в ворнинге**
  - Открывает: Экран авторизации (AuthLoginVC)

---

## 6. Схематичное дерево иерархии экрана
```
Экран «Избранное» (FavoritesVC)
├── Верхняя панель (UINavigationBar)
│   ├── Заголовок «Избранное»
│   └── Строка поиска (SearchBarService)
├── Основная область (UITableView)
│   ├── Секция предупреждений (FavoritesWarningView)
│   ├── Секция меню (FavoritesMenuItemView)
│   │   ├── Совет провизора
│   │   └── Мегасоветы
│   ├── Секция фильтров (SearchFiltersView)
│   │   └── Кнопка сортировки
│   ├── Секция информационного блока (FavoritesInfoView)
│   │   └── Текст с HTML-ссылкой
│   ├── Секция гибкого промпта (FlexiblePromptView)
│   │   ├── Иллюстрация
│   │   ├── Заголовок
│   │   ├── Описание
│   │   └── Кнопка действия
│   ├── Секция избранных товаров (CatalogueItemsTCM)
│   │   └── Ячейки товаров
│   │       ├── Изображение
│   │       ├── Название
│   │       ├── Производитель
│   │       ├── Цена
│   │       ├── Количество аптек
│   │       ├── Кнопка «В корзину»
│   │       └── Кнопка «Удалить из избранного»
│   └── Секция рекомендаций (CatalogueItemsTCM + SectionNameHeaderView)
│       ├── Заголовок «Подобрано для вас»
│       └── Ячейки товаров (структура как выше)
├── Всплывающие элементы
│   ├── Гибкие промпты (FlexiblePromptView)
│   └── Ворнинги (FavoritesWarningView)
└── Нижняя навигационная панель (UITabBarController)
    ├── Главный
    ├── Каталог
    ├── Корзина
    ├── Избранное
    └── Меню
```

---

## [Нужно дополнить]
- Не хватает информации о точном составе и логике отображения фильтров в секции SearchFiltersView (какие фильтры могут быть, кроме сортировки).
- Не полностью раскрыта логика отображения гибких промптов (FlexiblePromptView) — возможные типы сообщений и кнопок.
- Неизвестно, какие дополнительные состояния могут быть у товаров (например, «нет в наличии», «похожие»), кроме отображённых на скриншотах.
- Не хватает информации о возможных ошибках и их отображении (например, сетевые ошибки).
- Не описаны все возможные deeplink-сценарии для ссылок в информационном блоке и ворнингах. 