# Экран «Оценить заказ» (OrderRateVC)

## Описание и назначение экрана
Экран предназначен для оценки заказа пользователем после его получения. Пользователь может выставить рейтинг, выбрать причины неудовлетворенности (если рейтинг ниже максимального), оставить комментарий, прикрепить фото и подтвердить согласие на обработку персональных данных. Экран завершает сценарий обратной связи по заказу и помогает собрать отзывы для улучшения сервиса.

## Общая иерархия экрана
Экран реализован на основе UIViewController (`OrderRateVC`) с использованием UITableView для отображения многоуровневого контента, разбитого на секции. В нижней части экрана находится фиксированная панель с кнопкой подтверждения и предупреждением о необходимости согласия с условиями.

---

## 1. Верхняя панель
### 1.1. Назначение и элементы
- **Навигационная панель** (стандартная UINavigationBar)
  - Кнопка «Назад» (возврат к предыдущему экрану)
  - Заголовок: «Оценить заказ» (отображается всегда)

---

## 2. Основная область (UITableView)
Основная область реализована через UITableView, разбитую на секции. Каждая секция — отдельный компонент с собственным XIB и классом.

### 2.1. Секции и их элементы (в порядке отображения)

- **Секция: Информация о заказе и рейтинг** (`OrderRateHeaderView`)
  - Назначение: отображение информации о заказе и выставление рейтинга.
  - Элементы:
    - Номер заказа (label)
    - Название аптеки (label)
    - Сумма заказа (label)
    - Миниатюры товаров заказа (stackView с изображениями)
    - Рейтинг (звёзды, компонент `CosmosView`)
  - Взаимодействие: пользователь может выставить рейтинг, тапнув по звёздам. После выбора рейтинга обновляются последующие секции.
  - Особенности: если нет данных — секция скрыта.

- **Секция: Заголовок причин неудовлетворенности** (`OrderRateSubjectsTitleView`)
  - Назначение: отображение заголовка «Что испортило впечатление?»
  - Элементы: заголовок (label)
  - Логика: отображается только если выбран рейтинг ниже максимального.

- **Секция: Список причин неудовлетворенности** (`OrderRateSubjectView`, multiple selection)
  - Назначение: выбор одной или нескольких причин, почему заказ не понравился.
  - Элементы:
    - Список причин (каждая причина — отдельная ячейка)
      - Примеры:
        - Нагрубили в аптеке
        - Цена в аптеке выше чем в приложении
        - Товар из заказа был не в наличии
        - Аптека долго собирала заказ
        - Аптеку сложно найти
        - Не смог найти все товары в приложении
        - В аптеке выдали не тот товар
    - Чекбокс/галочка для выбранных причин
    - Разделитель между причинами
  - Взаимодействие: пользователь может выбрать одну или несколько причин. Выбранные причины отмечаются галочкой.
  - Логика: секция появляется только если выбран рейтинг ниже максимального.

- **Секция: Комментарий** (`OrderRateCommentView`)
  - Назначение: поле для ввода дополнительного комментария.
  - Элементы:
    - Многострочное текстовое поле (ViTextView) с плейсхолдером
  - Взаимодействие: пользователь может ввести текст. Текст сохраняется в модели.
  - Особенности: секция всегда отображается, комментарий необязателен.

- **Секция: Добавление фото** (`OrderRatePhotoView`)
  - Назначение: возможность прикрепить фотографию к отзыву.
  - Элементы:
    - Кнопка «Добавить фото» (PhotoAttachmentView)
    - Превью выбранного фото (если фото добавлено)
    - Кнопка удаления фото (если фото добавлено)
  - Взаимодействие: при нажатии открывается выбор фото (камера/галерея). Можно удалить выбранное фото.
  - Особенности: секция всегда отображается.

- **Секция: Согласие на обработку данных** (`OrderRateAgreementsView`)
  - Назначение: чекбокс согласия с политикой обработки персональных данных.
  - Элементы:
    - Чекбокс (RichCheckBox)
    - Текст согласия с активной ссылкой на политику конфиденциальности
  - Взаимодействие: пользователь должен поставить галочку для возможности отправки отзыва. По нажатию на ссылку открывается политика в браузере.
  - Особенности: если нет данных для оценки — секция скрыта.

---

## 3. Всплывающие и дополнительные элементы
- **Алерты и предупреждения**
  - Алерт при ошибке отправки/загрузки данных
  - Алерт при попытке отправить отзыв без выбора рейтинга
- **Ворнинг внизу экрана**
  - Если чекбокс согласия не отмечен, появляется красная панель с текстом: «Необходимо принять условия соглашения, чтобы продолжить»
  - Скрывается при установке галочки

---

## 4. Нижняя навигационная панель
- **Фиксированная нижняя панель** (viewBottomContainer)
  - Кнопка «Готово» (buttonConfirm)
    - Активна только если отмечен чекбокс согласия
    - По нажатию отправляет отзыв, в случае успеха открывает экран благодарности (OrderRateThanksVC)
  - Текстовое предупреждение (labelRequirements)
    - Отображается, если чекбокс не отмечен
  - Цвет фона меняется в зависимости от состояния (активный/неактивный)
- **Системная нижняя навигация приложения** (TabBar)
  - Кнопки: Главный, Каталог, Корзина, Избранное, Меню
  - Переход между разделами приложения

---

## 5. Открываемые экраны при взаимодействии с элементами
- **Кнопка «Готово»**
  - Открывает экран успешной оценки (OrderRateThanksVC)
- **Чекбокс согласия**
  - Открывает: Ссылку на политику конфиденциальности (WebVC)
- **Кнопка «Добавить фото»**
  - Открывает: системный выбор фото (камера/галерея)

---

## 6. Схематичное дерево иерархии экрана
```
Экран «Оценить заказ» (OrderRateVC)
├── Верхняя панель (UINavigationBar)
│   ├── Кнопка «Назад»
│   └── Заголовок «Оценить заказ»
├── Основная область (UITableView)
│   ├── Секция: Информация о заказе и рейтинг (OrderRateHeaderView)
│   │   ├── Номер заказа (label)
│   │   ├── Название аптеки (label)
│   │   ├── Сумма заказа (label)
│   │   ├── Миниатюры товаров (stackView)
│   │   └── Рейтинг (CosmosView)
│   ├── Секция: Заголовок причин неудовлетворенности (OrderRateSubjectsTitleView)
│   │   └── Заголовок (label)
│   ├── Секция: Список причин (OrderRateSubjectView)
│   │   ├── Причина (label)
│   │   ├── Галочка выбранности (imageView)
│   │   └── Разделитель (view)
│   ├── Секция: Комментарий (OrderRateCommentView)
│   │   └── Многострочное текстовое поле (ViTextView)
│   ├── Секция: Добавление фото (OrderRatePhotoView)
│   │   ├── Кнопка «Добавить фото» (PhotoAttachmentView)
│   │   ├── Превью фото (если выбрано)
│   │   └── Кнопка удаления фото (если выбрано)
│   └── Секция: Согласие на обработку данных (OrderRateAgreementsView)
│       ├── Чекбокс (RichCheckBox)
│       └── Текст с ссылкой на политику
├── Всплывающие элементы
│   ├── Алерты (ошибки, благодарности)
│   └── Ворнинг о необходимости согласия
└── Нижняя панель
    ├── Кнопка «Готово» (buttonConfirm)
    └── Текстовое предупреждение (labelRequirements)
```

---

## [Нужно дополнить]
- Не хватает информации о точном составе и названиях причин неудовлетворенности (OrderRateInfo.Rate.Subject) — требуется описание из модели данных или API.
- Неясно, как реализовано отображение миниатюр товаров (MiniaturePhotoItemView) — требуется описание компонента.
- Не описаны все возможные состояния алертов и их тексты — требуется список из TextProvider.
- Не хватает информации о поведении при ошибках загрузки фото.