# Экран "О товаре" (ItemDetailVC)

## Описание и назначение экрана
Экран предназначен для отображения полной информации о товаре: его характеристик, наличия, цены, отзывов, аналогов, специальных предложений, а также для совершения действий — добавления в корзину, избранное, заказа, отправки вопроса производителю и др. Экран решает задачи выбора, анализа и покупки товара, а также получения справочной информации.

## Общая иерархия экрана
Экран реализован на базе UIViewController (`ItemDetailVC`) с основной областью в виде UITableView (`tableView`), разбитой на секции. В нижней части экрана расположена фиксированная панель действий (viewBuyButtonContainer), содержащая основные кнопки и счетчик для взаимодействия с товаром (добавления в корзину, оформление предзаказа или уценки, добавление в избранное). Всплывающие элементы (алерты, подсказки) отображаются поверх основного контента. Навигация осуществляется через стандартную нижнюю панель приложения.

---

## 1. Верхняя панель
### 1.1. Назначение и элементы
- Заголовок экрана: "О товаре" (navigationItem.title)
- Кнопка "Назад" (стандартная)
- Кнопка "Поделиться" (бар-кнопка справа, появляется если есть ссылка на товар)

---

## 2. Основная область (UITableView, секции)

### 2.1. Секции и их элементы (строго по Section.array)

#### 2.1.1. Информация о товаре (Section.info, ItemDetailInfoSM)
- Название, изображение, производитель, форма выпуска, дозировка, фасовка, количество покупок, рейтинг, отзывы, стикеры "ИН N", "Оригинал" и др.
- Взаимодействие: нажатие на подчеркнутый текст с количеством отзывов — переход к секции отзывов; нажатие на стикер открывает попап (`TooltipVC`)
- Особенности: часть информации может быть скрыта в зависимости от состояния товара

#### 2.1.2. Стикеры (Section.stickers, ItemDetailStickersView)
- Коллекция стикеров (например, "Хранить в морозильнике", рекомендованный возраст)
- Взаимодействие: нажатие на некоторые интерактивные стикеры открывает попап (`TooltipVC`)
- Особенности: отображается только если есть стикеры

#### 2.1.3. Совместимые товары (Section.compatibleItems, ItemDetailCompatibleItemsView)
- Превью изображений совместимых товаров, кнопка "Все товары"
- Взаимодействие: нажатие на "Все товары" — скролл к секции совместимых товаров; на карточку товара — открытие детальной карточки (ItemDetailVC)
- Особенности: отображается только если есть совместимые товары

#### 2.1.4. Блок наличия (Section.availability, ItemDetailAvailabilityView)
- Информация о наличии: "Товар в наличии в N аптеках", "Временно нет в наличии", "Нет в наличии в вашем городе", "Под заказ", "Уценка" и др.
- Взаимодействие: нажатие на адрес — переход к выбору аптеки; на "Сообщить о поступлении" — подписка на уведомление
- Особенности: отображение зависит от статуса товара и города пользователя

#### 2.1.5. Блок обратной связи об ошибке (Section.errorFeedback, ItemDetailErrorFeedbackView)
- Кнопка "Нашли ошибку в описании или фото?"
- Взаимодействие: открывает экран отправки обратной связи (ItemErrorFeedbackVC)

#### 2.1.6. Атрибуты товара (Section.attributes, ItemDetailAttributeView)
- Коллекция фильтров: форма выпуска, дозировка, фасовка, уценка, способ заказа
- Взаимодействие: выбор фильтра — обновление данных товара и секций ниже
- Особенности: фильтры могут быть неактивны или скрыты в зависимости от наличия вариантов

#### 2.1.7. Важные свойства (Section.propertiesImportantH + Section.propertiesImportant, ItemDetailPropertyCardView)
- Заголовок "Особенности товара" и горизонтальный скролл карточек с важными свойствами товара.
- Возможные карточки (по скриншоту):
  - Срок годности после вскрытия (например, "12 месяцев", иконка банки)
  - Время наступления эффекта (например, "30 минут", иконка часов)
  - Водителям (например, "Запрещено", иконка водителя)
  - Детям (например, "С 3-х лет", иконка лошадки)
  - Беременным (например, "Разрешено", иконка младенца)
  - Кормящим матерям (например, "С осторожностью", иконка бутылочки)
  - Аллергикам (например, "С осторожностью", иконка молекулы)
  - Взаимодействие с алкоголем (например, "С осторожностью", иконка бутылок)
  - Температура хранения (например, "2–5°C", иконка термометра)
  - Диабетикам (например, "Разрешено", иконка капли)
- Взаимодействие: отсутствует, карточки не кликабельны.
- Особенности: список и порядок карточек может меняться в зависимости от товара, цветовая индикация статусов (жёлтый, зелёный, красный).

#### 2.1.8. Переключатель "Инструкция/Аналоги" (Section.segments, ItemDetailSegmentsView)
- Сегментированный контрол (ItemDetailSegmentedControl)
- Взаимодействие: переключение между режимами "Инструкция" и "Аналоги" — меняет набор отображаемых секций ниже

#### 2.1.9. Задать вопрос производителю (Section.askManufacturer, ItemDetailAskManufacturerView)
- Текст, описание, кнопка "Задать вопрос о товаре"
- Взаимодействие: открывает экран чата с производителем (ManufacturerDialogDetailVC)
- Особенности: отображается только если у товара есть чат с производителем и выбран режим "Инструкция"

#### 2.1.10. Свойства товара (Section.properties, PropertyView)
- Список свойств товара (например, состав, показания, противопоказания)
- Взаимодействие: нажатие на свойство — открытие подробного описания или переход по ссылке
- Особенности: отображается только в режиме "Инструкция"

#### 2.1.11. Описание товара (Section.description, ItemDetailDescriptionView)
- Краткое описание, кнопка "Подробнее"/"Скрыть"
- Взаимодействие: нажатие на "Подробнее" раскрывает описание полностью и меняет кнопку на "Скрыть"; повторное нажатие сворачивает описание обратно.

#### 2.1.12. Оригинальный препарат (Section.original, ItemDetailOriginalView)
- Секция с информацией об оригинальном препарате.
- Может содержать кнопку для перехода к оригиналу или подробной информации.
- Показывается только если у товара есть оригинальный аналог.

#### 2.1.13. Категории (Section.categoriesH + Section.categories + Section.categoriesF, ItemDetailCategoryView)
- Заголовок "Категории" и список категорий, к которым относится товар
- Взаимодействие: переход в соответствующую категорию

#### 2.1.14. Отступы (Section.spacingUnderHighlighted, EmptyGenericView)
- Вспомогательные секции для создания вертикальных отступов между блоками.
- Не содержат данных, не отображаются явно для пользователя.
- Используются для визуального разделения логических блоков.

#### 2.1.15. Выделенные свойства (Section.propertiesHighlighted, ItemDetailExPropertyCellModel)
- Секция для выделенных свойств товара (например, особо важные характеристики).
- Может содержать отдельные карточки с акцентом.
- Показывается только если есть такие свойства.
- Взаимодействие: при нажатии на кнопку Подробнее раскрывает описание свойства, при нажатии на кнопку Скрыть обратно сворачивает описание свойства.

#### 2.1.16. Блок "Задать вопрос" (Section.askQuestion, ItemDetailAskQuestionView)
- Секция для блока "Задать вопрос".
- Содержит кнопку для перехода к форме вопроса.
- Показывается только если доступна функция вопросов.
- После нажатия открывается форма для ввода вопроса.

#### 2.1.17. Свойства (детально) (Section.propertiesDetail, PropertyDetailView)
- Секция для подробных свойств товара (например, расширенное описание, дополнительные параметры)
- Взаимодействие: нажатие на свойство — открытие подробного описания или переход по ссылке
- Особенности: отображается только если есть такие свойства

#### 2.1.18. Специальные предложения (Section.specialsH + Section.specials, SpecialCarouselView)
- Заголовок "Специальные предложения" и карусель спецпредложений
- Взаимодействие: нажатие на карточку — переход к спецпредложению (SpecialDetailVC)
- Особенности: отображается только если есть предложения

#### 2.1.19. Отзывы (Section.feedbacks, ItemFeedbackView, ItemDetailFeedbacksHeaderView, Section.feedbacksMore, ItemDetailFeedbacksMoreView)
- Заголовок, рейтинг, количество отзывов, список отзывов (ограничено 5)
- Кнопка "Показать все отзывы" появляется, если отзывов больше 5
- Взаимодействие: нажатие на "Оставить отзыв" — открытие формы отзыва; на "2 отзыва" — скролл к отзывам; на "Показать все отзывы" — открытие экрана со всеми отзывами

#### 2.1.20. Форма отправки отзыва (Section.feedbackPost, ItemFeedbackPostView)
- Секция для формы отправки отзыва с фото.
- Содержит поля для текста, фото, кнопку отправки.
- Показывается только если пользователь может оставить отзыв.
- После отправки формы появляется алерт об успешной отправке.

#### 2.1.21. Аналоги — фильтры (Section.analogsFilters, SearchFiltersView)
- Секция с фильтрами аналогов
- Взаимодействие: выбор фильтра — обновление списка аналогов
- Особенности: отображается только в режиме "Аналоги"

#### 2.1.22. Аналоги — список (Section.analogsItems, CatalogueItemsTCM)
- Список аналогов
- Взаимодействие: нажатие на аналог — переход к его карточке (ItemDetailVC)
- Особенности: отображается только в режиме "Аналоги"

#### 2.1.23. Аналоги — подсказки (Section.analogsPrompt, FlexiblePromptView)
- Секция с подсказками по аналогам в случае пустого списка в результате применения фильтров
- Особенности: отображается только в режиме "Аналоги"

#### 2.1.24. Индикатор загрузки (Section.loader, LoaderView)
- Секция для отображения индикатора загрузки.
- Показывается, когда данные товара ещё не загружены или происходит обновление информации.
- Не содержит интерактивных элементов, скрывается после загрузки данных.

#### 2.1.25. Динамические секции совместимых товаров по категориям (Section.consumablesSection, CatalogueItemsTCM)
- Список совместимых товаров по категориям (добавляется динамически)
- Взаимодействие: нажатие на товар — переход к его карточке (ItemDetailVC)
- Особенности: отображается только в режиме "Инструкция" и если есть данные

### 2.2. Нижняя фиксированная панель действий (viewBuyButtonContainer)

- **Назначение:** Фиксированная панель внизу экрана для основных действий с товаром.
- **Состав панели:**
  - **Кнопки действий с товаром (ItemActionButtonsDetailView):**
    - **Основная кнопка действия (ItemBuyButtonDetailView):** 
      - Отображает действие в зависимости от состояния товара ("В корзину", "Предзаказ", "Заказать уценку", "Нет в наличии" и др.).
      - Взаимодействие: нажатие добавляет товар в корзину, оформляет предзаказ или запускает соответствующий сценарий. Если товар уже в корзине — появляется счетчик.
    - **Счетчик количества товара (ProductCounterView):**
      - Взаимодействие: позволяет увеличить или уменьшить количество товара. При достижении лимита появляется всплывающая подсказка (ColoredTooltipView). При уменьшении до 0 товар удаляется из корзины.
      - Особенности: отображается, если товар уже добавлен в корзину.
  - **Кнопка "Сообщить о поступлении" (buttonRememberMe, ExtendedHitButton):**
    - Взаимодействие: нажатие добавляет товар в избранное.
    - Особенности: отображается, если товар недоступен и еще не добавлен в избранное.
  - **Краткая подсказка о наличии (labelShortAvailability):** 
    - Текстовое сообщение о статусе товара (например, "Товар скоро появится", "Ограниченное количество").
    - Неинтерактивный элемент, отображается только при необходимости.

- **Особенности отображения:**
  - Кнопки и счетчик могут быть скрыты или показаны в зависимости от состояния товара, наличия в корзине, лимитов и т.д.
  - Если все элементы скрыты, панель также скрывается.
  - Всплывающие подсказки (ColoredTooltipView) появляются при попытке превысить лимит или при других ограничениях.

---

## 3. Всплывающие и дополнительные элементы
- Алерты (AlertModel): предупреждения, ошибки, подтверждения, подсказки (например, "Вы уже добавили максимальное количество товаров в корзину", "Данный товар доступен по предзаказу" и др.)
- Модальные окна: подтверждение отправки вопроса, уведомление о поступлении, подробности по уценке и др.
- Всплывающие подсказки: ограничения по количеству, отсутствие товара, условия предзаказа и др.
- Особенности: отображаются поверх основного контента, блокируют взаимодействие с экраном до закрытия

---

## 4. Нижняя навигационная панель
- Стандартная панель приложения (UITabBar): Главный, Каталог, Корзина, Избранное, Меню
- Взаимодействие: переход между разделами приложения

---

## 5. Открываемые экраны при взаимодействии с элементами

- Кнопка "В корзину"/"Предзаказ"/"Заказать уценку" (ItemActionButtonsDetailView)
  - Открывает: Корзина (CartVC) или оформление заказа
- Кнопка "Оставить отзыв о товаре"
  - Открывает: Форма отзыва (ItemFeedbackVC)
- Кнопка "Задать вопрос о товаре"
  - Открывает: Чат с производителем (ManufacturerDialogDetailVC)
- Кнопка "Нашли ошибку в описании или фото?"
  - Открывает: Форма обратной связи (ItemErrorFeedbackVC)
- Кнопка "Подробнее"/"Скрыть" в описании
  - Раскрывает/сворачивает описание товара
- Кнопка "Сообщить о поступлении"
  - Открывает: Модальное окно подтверждения
- Переключатель "Инструкция/Аналоги"
  - Меняет набор отображаемых секций
- Фильтры аналогов
  - Обновляют список аналогов
- Элементы секции "Категории"
  - Открывают соответствующую категорию
- Элементы секций "Совместимые товары" и "Аналоги"
  - Открывают карточку выбранного товара (ItemDetailVC)

---

## 6. Схематичное дерево иерархии экрана
```
Экран "О товаре" (ItemDetailVC)
├── Верхняя панель (UINavigationBar)
│   ├── Заголовок "О товаре"
│   ├── Кнопка "Назад"
│   └── Кнопка "Поделиться"
├── Основная область (UITableView)
│   ├── Секция: Информация о товаре (ItemDetailInfoSM)
│   ├── Секция: Стикеры (ItemDetailStickersView)
│   ├── Секция: Совместимые товары (ItemDetailCompatibleItemsView)
│   ├── Секция: Блок наличия (ItemDetailAvailabilityView)
│   ├── Секция: Обратная связь об ошибке (ItemDetailErrorFeedbackView)
│   ├── Секция: Атрибуты товара (ItemDetailAttributeView)
│   ├── Секция: Важные свойства (ItemDetailPropertyCardView)
│   ├── Секция: Переключатель "Инструкция/Аналоги" (ItemDetailSegmentsView)
│   ├── Секция: Задать вопрос производителю (ItemDetailAskManufacturerView)
│   ├── Секция: Свойства товара (PropertyView)
│   ├── Секция: Описание товара (ItemDetailDescriptionView)
│   ├── Секция: Оригинальный препарат (ItemDetailOriginalView)
│   ├── Секция: Категории (ItemDetailCategoryView)
│   ├── Секция: Отступы (EmptyGenericView)
│   ├── Секция: Выделенные свойства (ItemDetailExPropertyCellModel)
│   ├── Секция: Блок "Задать вопрос" (ItemDetailAskQuestionView)
│   ├── Секция: Свойства (детально) (PropertyDetailView)
│   ├── Секция: Специальные предложения (SpecialCarouselView)
│   ├── Секция: Отзывы (ItemFeedbackView, ItemDetailFeedbacksHeaderView, ItemDetailFeedbacksMoreView)
│   ├── Секция: Форма отправки отзыва (ItemFeedbackPostView)
│   ├── Секция: Аналоги — фильтры (SearchFiltersView)
│   ├── Секция: Аналоги — список (CatalogueItemsTCM)
│   ├── Секция: Аналоги — подсказки (FlexiblePromptView)
│   ├── Секция: Индикатор загрузки (LoaderView)
│   └── Динамические секции совместимых товаров по категориям (CatalogueItemsTCM)
├── Фиксированная панель действий (viewBuyButtonContainer)
│   ├── Кнопки действий с товаром (ItemActionButtonsDetailView)
│   │   ├── Основная кнопка действия (ItemBuyButtonDetailView)
│   │   └── Счетчик количества товара (ProductCounterView)
│   ├── Кнопка "Напомнить" (buttonRememberMe, ExtendedHitButton)
│   └── Краткая подсказка о наличии (labelShortAvailability)
├── Всплывающие элементы (AlertModel, модальные окна)
└── Нижняя навигационная панель (UITabBar)
```

---

## [Нужно дополнить]
- Не все состояния и переходы между экранами можно однозначно определить по коду и скриншотам (например, подробности по спецпредложениям, взаимодействие с некоторыми стикерами, детализация свойств и категорий)
- Не все алерты и модальные окна описаны в деталях (условия показа, тексты, сценарии закрытия)
- [Нужно дополнить] — требуется уточнение по кастомным действиям, дополнительным состояниям и переходам 