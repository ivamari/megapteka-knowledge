# Экран «Чат» (ChatVC, ChatContainerVC)

## Описание и назначение экрана

Экран «Чат» предназначен для онлайн-консультаций пользователей с провизорами Мегаптеки. Здесь пользователь может задать вопросы по лекарствам, получить помощь с оформлением заказа, а также вести переписку с оператором. Экран также информирует пользователя о политике обработки персональных данных.

---

## Общая иерархия экрана

Экран состоит из следующих основных областей:
- Верхняя панель (навигационный бар)
- Основная область (область сообщений и переписки)
- Нижняя навигационная панель (табар)
- Всплывающие элементы (алерты, индикаторы загрузки)

---

## 1. Верхняя панель

### 1.1. Назначение и элементы

- **Заголовок экрана** (UINavigationBar, свойство navigationItem.title)
  - Название: «Чат»
  - Отображается по центру верхней панели.
- **Кнопка «Назад»** (UINavigationBarButton)
  - Слева, возвращает на предыдущий экран.

---

## 2. Основная область

### 2.1. Контейнер чата (ChatContainerVC)
  - Основной view-контроллер, отвечающий за отображение переписки и взаимодействие с SDK чата, вложен в ChatVC как дочерний контроллер.
  - Вся история переписки, а также ввод и отправка сообщений реализованы внутри webView, который полностью контролирует внешний вид и структуру сообщений.

- **Список сообщений пользователя и оператора**
  - Контент сообщений формируется и отображается через webView, управляемый SDK чата (OnlineChatSdk).
  - Сообщения могут быть текстовыми, с вложениями, с аватаром отправителя.

- **Поле ввода сообщения**
  - Находится в нижней части основной области, над таббаром.
  - Позволяет ввести текст сообщения и отправить его оператору.
  - Внешний вид и функциональность определяются SDK.

- **Кнопка отправки сообщения** 
  - Находится справа от поля ввода.
  - Активна, если поле ввода не пустое.
  - При нажатии отправляет сообщение оператору.

### 2.2. Индикатор загрузки (LoadIndicatorService)
  - Отображается поверх основного контента при отправке сообщения или загрузке истории.
  - Скрывается после завершения операции.

---

## 3. Всплывающие и дополнительные элементы

- **Алерты об успешной отправке сообщения** (AlertModel)
  - Показываются после успешной отправки оффлайн-сообщения.
  - Содержат кнопку закрытия.

- **Алерты об ошибке** (AlertModel)
  - Показываются при ошибке отправки сообщения.
  - Содержат текст ошибки и кнопку закрытия.

- **Локальные push-уведомления** (ChatNotifier)
  - Отправляются, если пользователь неактивен на экране чата и поступило новое сообщение от оператора.

---

## 4. Нижняя навигационная панель

- **Табар (UITabBar)**
  - Кнопки: Главный, Каталог, Корзина, Избранное, Меню.
  - Кнопка «Меню» выделена как активная.
  - Позволяет быстро переходить между основными разделами приложения.

---

## 5. Открываемые экраны при взаимодействии с элементами

- **Кнопка «Назад»** — возвращает на предыдущий экран (название зависит от сценария).
- **Ссылка на политику конфиденциальности** — открывает внешний браузер или WebView с адресом политики.
- **Кнопка отправки сообщения** — отправляет сообщение, не открывает новый экран.
- **Push-уведомление** — при тапе переводит пользователя в чат (ChatVC).

---

## 6. Схематичное дерево иерархии экрана

```
Экран «Чат» (ChatVC)
├── Верхняя панель (UINavigationBar)
│   ├── Кнопка «Назад»
│   ├── Заголовок «Чат»
├── Основная область (ChatContainerVC)
│   ├── Список сообщений пользователя и оператора (webView, SDK чата)
│   ├── Поле ввода сообщения (webView, SDK чата)
│   └── Кнопка отправки сообщения (webView, SDK чата)
├── Индикатор загрузки (LoadIndicatorService)
└── Нижняя навигационная панель (UITabBar)
    ├── Главный
    ├── Каталог
    ├── Корзина
    ├── Избранное
    └── Меню (активная)
```