# Документация для экрана фильтрации адресов (FilterAddressesVC)

## Описание и назначение экрана

Экран предназначен для выбора способа поиска товаров или аптек по адресу или геолокации пользователя. Пользователь может выбрать, где искать товары/аптеки (рядом, по определённой точке на карте, по сохранённым или новым адресам), а также задать радиус поиска. 

**Особенность:** В ответе API метода получения списка товаров (в каталоге, поиске и других местах) приходит информация о доступном радиусе поиска. Поэтому на этом экране отображается блок управления радиусом поиска и доступны кнопки "Сбросить" и "Применить" — пользователь может применить фильтр по радиусу для списка товаров. 

Для фильтрации списка аптек радиус поиска недоступен, и соответствующие блоки (радиус и кнопки действий) не отображаются.

Экран используется как часть сценария фильтрации и уточнения местоположения для поиска товаров или аптек в приложении Мегаптека.

## Общая иерархия экрана

Экран реализован на основе UIViewController (`FilterAddressesVC`). Основная разметка построена с помощью вертикального UIStackView, который содержит:

- Таблицу адресов/точек выбора (UITableView)
- Блок управления радиусом поиска (UIView)
- Блок кнопок действий (UIView с UIStackView)

---

## 1. Верхняя панель

### 1.1. Назначение и элементы

- **Заголовок экрана** — отображается в верхней части, зависит от сценария (например, "Аллергия" или "Выберите аптеку"). Реализован через внешний контейнер/родительский экран, не входит в FilterAddressesVC напрямую.
- **Кнопка "Назад"** — слева вверху, возвращает на предыдущий экран. Реализована во внешнем контроллере.
- **Поисковая строка** — отображается только в некоторых сценариях (например, при поиске товаров), содержит поле ввода, иконку микрофона и сканера штрихкода. Не входит в FilterAddressesVC, реализована на родительском экране.

[Нужно дополнить]: Точные классы и структура верхней панели и поисковой строки определяются внешним экраном.

---

## 2. Основная область (основной контент)

### 2.1. Секции и их элементы

#### Секция: Список вариантов поиска адреса/аптеки (UITableView, свойство `tableView`)

- **Тип**: UITableView (plain)
- **Ячейки**: реализованы через кастомный view `FilterAddressItemView` внутри generic-ячейки.
- **Модель ячейки**: `FilterAddressItem` (enum)
  - Варианты:
    - `.address(NearbyAddress)` — адрес, точка на карте, сохранённый адрес, рабочий адрес и т.д.
    - `.addAddress` — кнопка "Добавить новый адрес"
- **Внутри FilterAddressItemView**:
  - `labelTitle` (UILabel) — название адреса/варианта ("Рядом со мной", "Рядом с домом", "Указать точку на карте" и т.д.)
  - `imageViewSelection` (UIImageView) — иконка выбора (галочка), отображается только для выбранного варианта
  - `viewSeparator` (UIView) — разделительная линия между ячейками
- **Взаимодействие**:
  - Тап по ячейке адреса — выбирает адрес, отмечает его галочкой, может вызвать дополнительное действие (например, переход к выбору точки на карте)
  - Тап по "Добавить новый адрес" — открывает экран добавления адреса
- **Особенности**:
  - Список вариантов динамически формируется в зависимости от сценария (поиск товаров или аптек, наличие сохранённых адресов и т.д.)
  - Для некоторых вариантов (например, "Указать точку на карте") может открываться карта для выбора точки

---

## 3. Всплывающие и дополнительные элементы

- **Модальное окно выбора** — основной экран реализован как модальное окно (bottom sheet), которое появляется поверх основного контента.
- **Блок управления радиусом поиска** (`viewRadiusContainer`)
  - **labelRadiusTitle** (UILabel) — подпись "Радиус поиска"
  - **sliderRadius** (ViSingleSlider) — слайдер для выбора радиуса (от min до max, значения задаются программно)
  - **labelRadius** (UILabel) — отображает выбранный радиус (например, "до 5 км")
  - **Взаимодействие**: изменение значения слайдера обновляет радиус поиска, отображаемый в labelRadius, и влияет на результаты поиска
  - **Особенности**: 
    - Блок отображается только если в ответе API для списка товаров присутствует информация о радиусе поиска.
    - Для фильтрации списка аптек этот блок не отображается.
- **Блок кнопок действий** (`viewActionButtonsContainer`)
  - **viewFilterButtons** (UIStackView)
    - **buttonReset** (UIButton) — кнопка "Сбросить", сбрасывает выбранные фильтры и возвращает значения по умолчанию
    - **buttonConfirm** (UIButton) — кнопка "Применить", подтверждает выбор и закрывает модальное окно
  - **Особенности**: 
    - Блок отображается только если доступен фильтр по радиусу (для товаров).
    - Для фильтрации аптек этот блок не отображается.

---

## 4. Нижняя навигационная панель

- На данном экране отсутствует собственная нижняя навигационная панель. Вся навигация осуществляется через модальное окно и кнопки действий.

---

## 5. Схематичное дерево иерархии экрана

```
Экран фильтрации адресов (FilterAddressesVC)
├── [Внешняя верхняя панель и поисковая строка] [Нужно дополнить]
├── Основная область (UIStackView)
│   ├── Список вариантов поиска (UITableView, tableView)
│   │   ├── Ячейка FilterAddressItemView
│   │   │   ├── labelTitle (UILabel)
│   │   │   ├── imageViewSelection (UIImageView)
│   │   │   └── viewSeparator (UIView)
│   ├── Блок радиуса поиска (UIView, viewRadiusContainer)
│   │   ├── labelRadiusTitle (UILabel)
│   │   ├── sliderRadius (ViSingleSlider)
│   │   └── labelRadius (UILabel)
│   └── Блок кнопок действий (UIView, viewActionButtonsContainer)
│       └── viewFilterButtons (UIStackView)
│           ├── buttonReset (UIButton)
│           └── buttonConfirm (UIButton)
└── [Модальное отображение, sheet] [Нужно дополнить]
```

---

## [Нужно дополнить]

- Точная структура и классы верхней панели, поисковой строки и заголовка экрана, так как они реализованы во внешнем контроллере и не входят в FilterAddressesVC напрямую.
- Описание возможных алертов, ворнингов или других всплывающих элементов, если они есть в других сценариях.
- Детали по взаимодействию с картой и добавлением нового адреса (какой экран открывается, как реализовано взаимодействие).
- Возможные состояния экрана при ошибках или отсутствии данных.

--- 