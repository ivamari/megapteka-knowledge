# Экран каталога товаров (CatalogueItemsVC)

## Описание и назначение экрана

Экран предназначен для поиска, фильтрации и просмотра товаров в выбранной категории каталога. Пользователь может искать товары по ключевым словам, сортировать и фильтровать результаты, просматривать подробную информацию о товаре, а также видеть специальные предложения и баннеры. Экран поддерживает различные состояния: отображение списка товаров, отсутствие товаров по фильтрам, отсутствие товаров рядом, ошибки загрузки и др.

## Общая иерархия экрана

Экран реализован на базе UIViewController (`CatalogueItemsVC`) с использованием UITableView для отображения основной области контента, а также кастомных UIView для панели поиска и фильтров. Разметка построена через XIB-файл с использованием UIStackView для вертикального размещения элементов.

---

## 1. Верхняя панель

### 1.1. Назначение и элементы

- **Заголовок экрана** (`navigationItem.title`)
  - Отображает название выбранной категории (например, "Аллергия").
  - Динамически меняется в зависимости от выбранной категории.
- **Кнопка "Назад"** (стандартная для UINavigationController)
  - Возвращает пользователя на предыдущий экран.

---

## 2. Основная область (основной контент)

Основная область реализована через UITableView (`tableView`), которая содержит несколько секций. Секции и их элементы динамически меняются в зависимости от состояния экрана.

### 2.1. Секции и их элементы (в порядке отображения)

#### 2.1.1. Секция фильтров (`SearchFiltersView`)

- **Описание**: Содержит фильтры для сортировки и отбора товаров.
- **Элементы**:
  - Кнопка сортировки (например, "По популярности", "По цене", "По алфавиту").
  - Кнопка фильтра Рядом с адресом (например, "Рядом со мной", "Рядом с домом").
  - Кнопка дополнительных фильтров ("Фильтры").
- **Взаимодействие**:
  - Нажатие на сортировку открывает модальное окно выбора сортировки (`ItemsSortsVC`). После выбора сортировки окно закрывается, применяется выбранный вариант.
    - **Варианты сортировки**:
      - По популярности (по умолчанию)
      - По цене (по возрастанию)
      - По цене (по убыванию)
      - По алфавиту (А-Я)
      - По алфавиту (Я-А)
  - Нажатие на фильтр по адресу открывает окно выбора адреса или радиуса (`FilterAddressesVC`). После выбора фильтр применяется.
    - **Варианты**: "Рядом со мной", "Рядом с домом", другие сохранённые адреса пользователя.
  - Нажатие на "Фильтры" открывает окно с дополнительными фильтрами (`FiltersListVC`). Можно выбрать несколько фильтров, применить или сбросить.
    - **Варианты**: фильтры по характеристикам товаров (например, производитель, форма выпуска, наличие акций и др.)

---

#### Модальное окно сортировки (`ItemsSortsVC`)

- Открывается при нажатии на кнопку сортировки (например, "По популярности").
- Содержит список вариантов сортировки (`SortItem`), текущий выбранный отмечен галочкой.
- После выбора сортировки окно закрывается, выбранный вариант применяется к списку товаров.

---

#### 2.1.2. Секция баннера (`BannerTSM`)

- **Описание**: Отображает рекламный или информационный баннер (например, "Какой у вас тип кожи?").
- **Элементы**:
  - Картинка и текст баннера.
- **Взаимодействие**:
  - Нажатие на баннер может вести на внешний или внутренний экран (через deeplink).

#### 2.1.3. Секция с отступом (`EmptyGenericView`)

- **Описание**: Служит для визуального разделения секций, отображается только при отсутствии промпта (сообщения).
- **Элементы**: Пустой UIView с фиксированной высотой.

#### 2.1.4. Секция товаров (`CatalogueItemsTCM`)

- **Описание**: Основная секция, отображающая список товаров в виде ячеек.
- **Элементы**:
  - Ячейки товаров (`CatalogueItemCell` или аналогичный класс).
    - Картинка товара.
    - Название и описание.
    - Цена, наличие, количество аптек.
    - Кнопка "В корзину".
    - Индикаторы (например, "Оригинал", "Со склада", "ИН 20").
    - Кнопка "Избранное" (сердечко).
    - Информация о наличии рядом (желтая плашка).
- **Взаимодействие**:
  - Нажатие на ячейку открывает подробную информацию о товаре.
  - Нажатие на "В корзину" добавляет товар в корзину.
  - Нажатие на "Избранное" добавляет/удаляет товар из избранного.

#### 2.1.5. Секция промпта/сообщения (`FlexiblePromptView`)

- **Описание**: Отображается при отсутствии товаров, ошибках или других специальных состояниях.
- **Элементы**:
  - Иллюстрация (например, единорог с вопросом).
  - Заголовок сообщения (например, "Ничего не найдено", "Товаров рядом нет").
  - Описание причины (например, "По выбранным фильтрам товары не найдены...").
  - Кнопка действия ("СБРОСИТЬ ФИЛЬТРЫ", "Повторить", "Назад" и др.) — отображается в зависимости от типа сообщения.
- **Взаимодействие**:
  - Нажатие на кнопку выполняет соответствующее действие (сброс фильтров, повторить запрос, вернуться назад).

---

## 3. Всплывающие и дополнительные элементы

- **Алерты** (`AlertModel`)
  - Отображаются при ошибках загрузки, проблемах с сетью и других исключительных ситуациях.
  - Содержат заголовок, описание и кнопки действий (например, "Повторить", "Отмена").
- **Индикатор загрузки** (`LoadIndicatorService`)
  - Показывается поверх экрана при загрузке данных.

---

## 4. Нижняя навигационная панель

- **TabBar (UITabBar)**
  - Кнопки: "Главный", "Каталог", "Корзина", "Избранное", "Меню".
  - Подсвечивает текущий раздел ("Каталог").
  - Позволяет быстро переходить между основными разделами приложения.

---

## 5. Схематичное дерево иерархии экрана

```
Экран каталога товаров (CatalogueItemsVC)
├── Верхняя панель (UINavigationBar)
│   ├── Заголовок категории (navigationItem.title)
│   └── Кнопка "Назад"
├── Основная область (UIView -> UIStackView)
│   └── UITableView (tableView)
│       ├── Секция фильтров (SearchFiltersView)
│       │   ├── Кнопки сортировки/фильтрации
│       │   └── Кнопка "СБРОСИТЬ ФИЛЬТРЫ" (динамически)
│       ├── Секция баннера (BannerTSM)
│       │   └── Баннер с картинкой и текстом
│       ├── Секция с отступом (EmptyGenericView)
│       ├── Секция товаров (CatalogueItemsTCM)
│       │   └── Ячейки товаров (CatalogueItemCell)
│       │       ├── Картинка товара
│       │       ├── Название, описание, цена, наличие
│       │       ├── Кнопка "В корзину"
│       │       ├── Кнопка "Избранное"
│       │       └── Индикаторы и плашки
│       └── Секция промпта/сообщения (FlexiblePromptView)
│           ├── Иллюстрация
│           ├── Заголовок сообщения
│           ├── Описание причины
│           └── Кнопка действия (динамически)
├── Всплывающие элементы
│   ├── Алерты (AlertModel)
│   └── Индикатор загрузки (LoadIndicatorService)
└── Нижняя навигационная панель (UITabBar)
    ├── Главный
    ├── Каталог
    ├── Корзина
    ├── Избранное
    └── Меню
```

---

## [Нужно дополнить]

- Не хватает информации о точной структуре и классах ячеек товаров (`CatalogueItemCell` и их составных частей), так как их реализация не найдена в предоставленных файлах.
- Не раскрыта структура и внешний вид компонента `FlexiblePromptView` (иллюстрация, кнопки, стилизация), требуется уточнение по коду или макетам.
- Для полного списка возможных дополнительных фильтров требуется уточнение структуры `modelFilters` и их вариантов в конкретной категории.