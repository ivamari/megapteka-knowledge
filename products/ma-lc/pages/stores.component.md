# Страница: Список аптек (Stores)

## 1. Обзор Страницы

- **Назначение**: Отображение полного списка аптек, принадлежащих сети, с возможностью поиска, фильтрации, сортировки и выполнения различных действий над каждой аптекой.
- **Роль**: Основной инструмент для управления и мониторинга аптечной сети.
- **Основные функции**:
    - Просмотр списка аптек с ключевой информацией.
    - Фильтрация аптек по различным параметрам (UUID, адрес, город, статус).
    - Сортировка списка по адресу, рейтингу или времени сборки.
    - Управление каждой аптекой через контекстное меню (изменение режима работы, загрузка фото, временное отключение и т.д.).
    - Выгрузка отчета по аптекам в формате Excel.

## 2. Элементы Пользовательского Интерфейса (UI)

- **Заголовок**: `<h1>Список аптек</h1>`
- **Фильтр**:
    - **Название**: `app-filter`.
    - **Назначение**: Предоставляет набор полей для фильтрации списка аптек.
    - **Поля фильтра**:
        - Код аптеки (UUID)
        - Адрес
        - Город
        - Статус (Активные/Отключенные)
        - Причина отключения
- **Пагинация**:
    - **Название**: `app-pagination`.
    - **Назначение**: Навигация по страницам списка аптек.
- **Таблица аптек**:
    - **Назначение**: Отображает отфильтрованный и отсортированный список аптек.
    - **Колонки**:
        - `Код аптеки`: UUID аптеки. Кликабелен, открывает модальное окно с детальной информацией. Также содержит ссылки для просмотра или загрузки фотографий.
        - `Город`: Название города.
        - `Адрес`: Полный адрес аптеки. Заголовок колонки является элементом сортировки.
        - `Рейтинг Мегаптеки`: Внутренний рейтинг аптеки. Заголовок колонки является элементом сортировки.
        - `Время сборки`: Среднее время сборки заказа. Заголовок колонки является элементом сортировки.
        - `Режим работы`: Отображает текущий график работы аптеки.
        - `Активность`: Отображает текущий статус (активна/неактивна) и содержит контекстное меню для управления аптекой.
- **Контекстное меню**:
    - **Название**: `app-controls-menu`.
    - **Назначение**: Предоставляет быстрый доступ к действиям для конкретной аптеки.
    - **Действия**:
        - Создать тестовый заказ
        - Скрыть аптеку из списка (для удаленных)
        - Отключить/Включить аптеку
        - Изменить режим работы
        - Как найти вход? (редактирование информации о входе)
        - Загрузить фото
- **Кнопка "Скачать в Excel"**:
    - **Название**: `app-excel-button`.
    - **Назначение**: Инициирует загрузку отчета по аптекам в формате Excel.
- **Модальное окно**:
    - **Название**: `app-modal`.
    - **Назначение**: Используется для отображения различных форм и информации (детали аптеки, редактирование графика, загрузка фото и т.д.).

## 3. Пользовательские Сценарии (User Flows)

- **Поиск и просмотр аптеки**:
    1. Пользователь вводит адрес в поле "Адрес" в фильтре.
    2. Список аптек автоматически обновляется, отображая только подходящие результаты.
    3. Пользователь находит нужную аптеку и кликает на ее UUID.
    4. Открывается модальное окно с подробной информацией об аптеке.
- **Временное отключение аптеки**:
    1. Пользователь находит нужную аптеку в списке.
    2. Нажимает на иконку контекстного меню в строке этой аптеки.
    3. В выпадающем меню выбирает "Отключить аптеку".
    4. Открывается модальное окно с формой для указания причины и срока отключения.
    5. После подтверждения аптека меняет свой статус.
- **Загрузка отчета**:
    1. Пользователь применяет необходимые фильтры (например, выбирает только активные аптеки в определенном городе).
    2. Нажимает кнопку "Скачать в Excel".
    3. Браузер начинает загрузку файла с отчетом, содержащим отфильтрованный список аптек.

## 4. Навигация

- **Переходы с этой страницы**: Прямых переходов на другие страницы нет. Взаимодействие происходит через модальные окна.
- **Переходы на эту страницу**:
    - Через основное меню навигации (пункт "Аптеки").
    - С Дашборда, при клике на виджеты, связанные с аптеками.

## 5. Отображаемые Данные

- **Типы данных**:
    - Список аптек (`Store[]`).
    - Параметры фильтрации и сортировки.
    - Информация для модальных окон (графики работы, фотографии, причины отключения).
- **Источники данных (API)**:
    - `GET merch-lk/v1/stores`: Основной метод для получения списка аптек. Принимает множество параметров для фильтрации, сортировки и пагинации.
    - `GET merch-lk/v1/stores/download`: Загрузка отчета в Excel. Принимает те же параметры фильтрации и сортировки, что и основной метод.
    - `POST merch-lk/v1/stores/hide`: Скрытие удаленной аптеки из списка.
    - `POST merch-lk/v1/stores/schedule/edit`: Изменение графика работы.
    - `POST merch-lk/v1/stores/control/create`: Загрузка фотографий.
    - `GET merch-lk/v1/stores/photos`: Получение фотографий аптеки.
    - `POST merch-lk/v1/stores/photos/delete`: Удаление фотографии.
    - `POST merch-lk/v1/stores/entrance-info/edit`: Редактирование информации о входе.
    - `POST merch-lk/v1/stores/enabled/edit`: Включение/отключение аптеки.
- **Отправляемые данные**:
    - Параметры фильтрации и сортировки в URL.
    - Данные из форм в модальных окнах (например, новый график работы, причина отключения) отправляются в теле POST-запросов.

## 6. Особые Состояния/Логика

- **Загрузка**:
    - При загрузке списка аптек отображается `app-loader` на всю область таблицы.
    - При загрузке отчета в Excel кнопка заменяется на `app-loader`.
- **Пустое состояние**: Если по заданным фильтрам не найдено ни одной аптеки, отображается компонент `app-empty`.
- **Debounce**: Запросы на обновление списка после изменения фильтров отправляются с задержкой в 500 мс, чтобы избежать лишних запросов во время ввода текста.
- **Динамическое формирование меню**: Контекстное меню для каждой аптеки генерируется динамически в зависимости от ее статуса (например, для удаленной аптеки есть пункт "Скрыть", а для активной - "Отключить").
- **Модальные окна**: Компоненты для модальных окон (редактирование, подтверждение и т.д.) загружаются и отображаются динамически.
