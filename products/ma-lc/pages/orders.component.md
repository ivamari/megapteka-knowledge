# Страница: Заказы (Orders)

## 1. Обзор Страницы

- **Назначение**: Отображение списка всех заказов, поступивших в аптечную сеть, с возможностью их фильтрации и выгрузки.
- **Роль**: Ключевой инструмент для мониторинга и анализа потока заказов.
- **Основные функции**:
    - Просмотр пагинированного списка заказов.
    - Фильтрация заказов по номеру, дате, городу, аптеке и статусу.
    - Просмотр ключевой информации по каждому заказу: дата, номер, адрес аптеки, сумма, статус, оценка.
    - Выгрузка отфильтрованного списка заказов в формате Excel.

## 2. Элементы Пользовательского Интерфейса (UI)

- **Заголовок**: `<h1>Заказы</h1>`
- **Фильтр**:
    - **Название**: `app-filter`.
    - **Назначение**: Предоставляет набор полей для фильтрации списка заказов.
    - **Поля фильтра**:
        - Номер заказа (внешний ID)
        - Месяц заказа
        - Город
        - Аптека
        - Статус заказа (завершенные/не завершенные)
        - Причина отмены
- **Мета-информация о заказах**:
    - **Название**: `app-orders-meta`.
    - **Назначение**: Отображает сводную информацию (KPI) по отфильтрованным заказам, такую как среднее время сборки, процент выкупа и т.д.
- **Пагинация**:
    - **Название**: `app-pagination`.
    - **Назначение**: Навигация по страницам списка заказов.
- **Таблица заказов**:
    - **Назначение**: Отображает отфильтрованный список заказов.
    - **Колонки**:
        - `Дата заказа`: Дата и время создания заказа. Имеет специальную отметку, если заказ тестовый.
        - `№ заказа`: Внутренний и внешний ID заказа.
        - `Код аптеки`: UUID аптеки, в которой был сделан заказ. Кликабелен, открывает модальное окно с детальной информацией об аптеке.
        - `Адрес`: Город и адрес аптеки.
        - `Сумма`: Итоговая сумма заказа.
        - `Статус`: Текущий статус заказа (например, "Готов к выдаче", "Отменен"). Для отмененных заказов указывается причина. Для "зависших" заказов отображается специальная метка.
        - `Оценка`: Оценка, поставленная клиентом, и его текстовый отзыв (во всплывающей подсказке).
- **Кнопка "Скачать в Excel"**:
    - **Название**: `app-excel-button`.
    - **Назначение**: Инициирует загрузку отчета по заказам в формате Excel.

## 3. Пользовательские Сценарии (User Flows)

- **Поиск конкретного заказа**:
    1. Пользователь вводит номер заказа в поле "Номер заказа" в фильтре.
    2. Список автоматически обновляется, показывая только искомый заказ.
- **Анализ отмененных заказов за прошлый месяц**:
    1. Пользователь выбирает прошлый месяц в фильтре "Месяц заказа".
    2. В фильтре "Статус заказа" выбирает "завершенные".
    3. В фильтре "Причина отмены" выбирает интересующую причину (например, "Отмена аптекой до сборки").
    4. Таблица отображает все заказы, соответствующие данным критериям.
    5. Пользователь нажимает "Скачать в Excel" для дальнейшего анализа.

## 4. Навигация

- **Переходы с этой страницы**: Прямых переходов на другие страницы нет. Клик по UUID аптеки открывает модальное окно.
- **Переходы на эту страницу**:
    - Через основное меню навигации (пункт "Заказы").
    - С Дашборда, при клике на виджеты, связанные с причинами отмен.

## 5. Отображаемые Данные

- **Типы данных**:
    - Список заказов (`Order[]`).
    - Параметры фильтрации.
    - Мета-информация по заказам.
- **Источники данных (API)**:
    - `GET merch-lk/v1/orders`: Основной метод для получения списка заказов. Принимает параметры для фильтрации и пагинации.
    - `GET merch-lk/v1/orders/download`: Загрузка отчета в Excel. Принимает те же параметры фильтрации.
    - `GET merch-lk/v2/orders/meta`: Получение сводной мета-информации для блока `app-orders-meta`.
- **Отправляемые данные**:
    - Параметры фильтрации и пагинации передаются в URL.

## 6. Особые Состояния/Логика

- **Загрузка**:
    - При загрузке списка заказов отображается `app-loader` на всю область таблицы.
    - При загрузке отчета в Excel кнопка заменяется на `app-loader`.
- **Пустое состояние**: Если по заданным фильтрам не найдено ни одного заказа, отображается компонент `app-empty`.
- **Debounce**: Запросы на обновление списка после изменения фильтров отправляются с задержкой в 500 мс для предотвращения избыточных запросов.
- **Выделение "зависших" заказов**: Строки таблицы с заказами, которые не были обработаны вовремя (`is_hung: true`), подсвечиваются особым стилем.
