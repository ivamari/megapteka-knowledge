# Страница: Аналитика (Analytics)

## 1. Обзор Страницы

- **Назначение**: Предоставление аналитических отчетов по доле рынка и ассортименту.
- **Роль**: Инструмент для стратегического анализа конкурентной среды и товарной матрицы.
- **Основные функции**:
    - Просмотр отчета "Доля" для оценки позиции сети в регионах по количеству и сумме заказов.
    - Просмотр отчета "Ассортимент" для анализа наличия и цен на ТОП-50 товаров в выбранных регионах.
    - Выгрузка отчета по ассортименту в формате Excel.

## 2. Элементы Пользовательского Интерфейса (UI)

Страница разделена на два основных блока-отчета: "Доля" и "Ассортимент".

### Отчет "Доля"

- **Заголовок**: `<h1>Доля</h1>`
- **Описание**: Текстовый блок, объясняющий методику расчета показателей в отчете.
- **Таблица "Доля"**:
    - **Назначение**: Отображает долю аптечной сети в заказах сервиса за последние 30 дней в разрезе регионов.
    - **Колонки**:
        - `Регион`: Название региона.
        - `Доля (количество)`: Процент заказов сети от общего числа и место в рейтинге среди других сетей. Заголовок является элементом сортировки.
        - `Доля (сумма)`: Процент оборота сети от общего и место в рейтинге. Заголовок является элементом сортировки.

### Отчет "Ассортимент"

- **Заголовок**: `<h1>Ассортимент (ТОП-50 самых популярных SKU по каждому региону)</h1>`
- **Описание**: Текстовый блок, объясняющий значения колонок "Наличие", "Цена" и "Место".
- **Выбор регионов (`app-choose-box`)**:
    - **Назначение**: Позволяет пользователю выбрать до 5 регионов для построения отчета по ассортименту.
    - **Взаимодействие**: При вводе названия региона в поле поиска, подгружается список совпадающих регионов. Выбранные регионы отображаются в виде плашек.
- **Таблица "Ассортимент"**:
    - **Назначение**: Отображает данные по ТОП-50 товарам для каждого выбранного региона.
    - **Структура**: Таблица сгруппирована по регионам. Каждую региональную группу можно свернуть или развернуть.
    - **Колонки**:
        - `Название товара`: Наименование товара. Является ссылкой на карточку товара на сайте.
        - `Наличие`: Процент аптек сети в данном регионе, где товар есть в наличии.
        - `Цена`: Минимальная цена на товар в аптеках сети в данном регионе.
        - `Минимальная цена`: Минимальная цена на товар среди всех аптек в регионе.
        - `Место`: Позиция аптечной сети в рейтинге по минимальной цене на данный товар.
- **Кнопка "Скачать в Excel"**:
    - **Назначение**: Инициирует загрузку отчета по ассортименту для выбранных регионов.

## 3. Пользовательские Сценарии (User Flows)

- **Анализ доли рынка**:
    1. Пользователь заходит на страницу "Аналитика".
    2. Просматривает таблицу "Доля", чтобы понять, в каких регионах сеть наиболее сильна, а в каких уступает конкурентам.
    3. Сортирует таблицу по колонке "Доля (количество)", чтобы увидеть регион с наилучшим/наихудшим показателем.
- **Сравнение цен на популярные товары**:
    1. Пользователь в блоке "Ассортимент" выбирает несколько интересующих его регионов.
    2. Таблица "Ассортимент" загружает данные.
    3. Пользователь разворачивает список товаров для конкретного региона.
    4. Сравнивает свою минимальную цену ("Цена") с минимальной ценой на рынке ("Минимальная цена") и свое место в рейтинге.
    5. Нажимает "Скачать в Excel" для более глубокого анализа.

## 4. Навигация

- **Переходы с этой страницы**:
    - Внешний сайт: Клик по названию товара в таблице "Ассортимент" ведет на карточку этого товара.
- **Переходы на эту страницу**:
    - Через основное меню навигации (пункт "Аналитика").

## 5. Отображаемые Данные

- **Типы данных**:
    - Статистика по доле рынка (`AnalyticsPartRow[]`).
    - Данные по ассортименту (`AnalyticsAssortmentRow[]`).
- **Источники данных (API)**:
    - `GET merch-lk/v1/analytics/part`: Получение данных для отчета "Доля". Принимает параметры сортировки.
    - `GET merch-lk/v1/analytics/assortment`: Получение данных для отчета "Ассортимент". Принимает `region_ids`.
    - `GET merch-lk/v1/analytics/assortment/download`: Загрузка отчета по ассортименту.
    - `GET merch-lk/v1/regions`: (используется `RegionsServiceInjection`) Получение списка регионов для компонента выбора.
- **Отправляемые данные**:
    - Параметры сортировки для отчета "Доля" (`sort_by`, `sort_direction`).
    - Массив ID регионов для отчета "Ассортимент" (`region_ids`).

## 6. Особые Состояния/Логика

- **Загрузка**: Каждый из двух отчетов имеет свой индикатор загрузки (`app-loader`), который отображается во время получения данных.
- **Пустое состояние**: Если для отчета нет данных, отображается компонент `app-empty`.
- **Ограничение выбора регионов**: В отчете "Ассортимент" можно выбрать не более 5 регионов одновременно.
- **Интерактивность таблицы**: Списки товаров в таблице "Ассортимент" можно сворачивать и разворачивать по клику на заголовок региона.
