# Страница: Отмены (Cancels)

## 1. Обзор Страницы

- **Назначение**: Предоставление детальной статистики по отменам заказов в разрезе аптек.
- **Роль**: Инструмент для выявления проблемных аптек и анализа причин отмен с целью повышения качества сервиса.
- **Основные функции**:
    - Просмотр сводной таблицы по отмеченным заказам для каждой аптеки.
    - Фильтрация данных по аптеке, месяцу и городу.
    - Сортировка аптек по общему количеству заказов или по количеству отмен определенного типа.
    - Выгрузка отчета по отменам в формате Excel.

## 2. Элементы Пользовательского Интерфейса (UI)

- **Заголовок**: `<h1>Отмены</h1>`
- **Фильтр**:
    - **Название**: `app-filter`.
    - **Назначение**: Предоставляет поля для фильтрации данных.
    - **Поля фильтра**:
        - Код аптеки (UUID)
        - Аптека (выбор из списка)
        - Месяц заказа
        - Город
- **Мета-информация об отменах**:
    - **Название**: `app-cancels-meta`.
    - **Назначение**: Отображает общую сводную статистику (KPI) по всем отмененным заказам, соответствующим фильтрам.
- **Пагинация**:
    - **Название**: `app-pagination`.
    - **Назначение**: Навигация по страницам списка аптек.
- **Таблица отмен**:
    - **Назначение**: Отображает статистику отмен по каждой аптеке.
    - **Колонки**:
        - `Аптека`: UUID и адрес аптеки.
        - `Заказы`: Общее количество заказов в данной аптеке за период.
        - `Автоотмена (зависший заказ)`: Процент и количество отмен по причине долгой обработки.
        - `Автоотмена (устаревший заказ)`: Процент и количество отмен по причине истечения срока годности.
        - `Отмена клиентом`: Процент и количество отмен по инициативе клиента.
        - `Отмена аптекой до сборки`: Процент и количество отмен аптекой до того, как заказ был собран.
        - `Отмена аптекой до срока брони`: Процент и количество отмен аптекой до истечения срока брони.
        - `Отмена аптекой по сроку брони`: Процент и количество отмен аптекой после истечения срока брони.
    - **Сортировка**: Заголовки всех колонок, кроме "Аптека", являются кликабельными элементами для сортировки.
- **Кнопка "Скачать в Excel"**:
    - **Название**: `app-excel-button`.
    - **Назначение**: Инициирует загрузку отчета по отменам.

## 3. Пользовательские Сценарии (User Flows)

- **Выявление аптек с большим количеством автоотмен**:
    1. Пользователь заходит на страницу "Отмены".
    2. Кликает на заголовок колонки "Автоотмена (зависший заказ)" для сортировки по убыванию.
    3. Вверху списка отображаются аптеки с наибольшим процентом и количеством данного типа отмен.
    4. Пользователь может применить фильтр по городу или месяцу для более детального анализа.
- **Загрузка отчета для анализа**:
    1. Пользователь устанавливает нужные фильтры (например, выбирает конкретный месяц).
    2. Нажимает кнопку "Скачать в Excel".
    3. Получает файл для дальнейшей работы и анализа данных.

## 4. Навигация

- **Переходы с этой страницы**: Прямых переходов на другие страницы нет. Клик по адресу аптеки открывает модальное окно с ее детальной информацией.
- **Переходы на эту страницу**:
    - Через основное меню навигации (пункт "Отмены").

## 5. Отображаемые Данные

- **Типы данных**:
    - Список статистических данных по отмеченным заказам в разрезе аптек (`Cancel[]`).
    - Параметры фильтрации и сортировки.
- **Источники данных (API)**:
    - `GET merch-lk/v1/cancels`: Основной метод для получения данных по отменам. Принимает параметры для фильтрации, сортировки и пагинации.
    - `GET merch-lk/v1/cancels/download`: Загрузка отчета в Excel. Принимает те же параметры фильтрации и сортировки.
    - `GET merch-lk/v1/cancels/meta`: Получение сводной мета-информации для блока `app-cancels-meta`.
- **Отправляемые данные**:
    - Параметры фильтрации, сортировки и пагинации передаются в URL.

## 6. Особые Состояния/Логика

- **Загрузка**:
    - При загрузке данных отображается `app-loader` на всю область таблицы.
    - При загрузке отчета кнопка "Скачать в Excel" заменяется на `app-loader`.
- **Пустое состояние**: Если по заданным фильтрам не найдено данных, отображается компонент `app-empty`.
- **Debounce**: Запросы на обновление списка после изменения фильтров отправляются с задержкой в 500 мс.
- **Расчет процентов**: Значения в ячейках таблицы (процент и количество) рассчитываются и форматируются на бэкенде и приходят в готовом виде.
