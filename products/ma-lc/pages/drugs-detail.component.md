# Страница: Редактирование товара (Drug Detail)

## 1. Обзор Страницы

- **Назначение**: Предоставление интерфейса для детального редактирования информации о товаре Собственной Торговой Марки (СТМ).
- **Роль**: Основной инструмент для управления контентом карточки товара.
- **Основные функции**:
    - Просмотр текущей информации о товаре.
    - Редактирование обязательных атрибутов (свойств) товара.
    - Загрузка и удаление изображений товара.
    - Создание, редактирование и удаление информационных блоков (описание, состав и т.д.).
    - Управление контентом как от сети, так и от производителя.

## 2. Элементы Пользовательского Интерфейса (UI)

- **Заголовок**: `<h1>Редактирование товара {{ name }}</h1>`
    - Отображает название редактируемого товара.
- **Кнопка "Вернуться к списку товаров"**:
    - **Название**: `app-button-back`.
    - **Назначение**: Возвращает пользователя на страницу со списком товаров СТМ.
- **Ссылка "Товар на сайте"**:
    - **Назначение**: Открывает карточку данного товара на основном сайте в новой вкладке.
- **Стикеры (`app-stickers`)**:
    - **Назначение**: Отображает статусы-стикеры, информирующие о степени заполненности карточки (например, "Нет фото", "Нет описания").
- **Блок "Изображения" (`app-images`)**:
    - **Назначение**: Управление галереей изображений товара.
    - **Взаимодействие**:
        - Позволяет загружать новые изображения (drag-n-drop или через диалог выбора файла).
        - Позволяет удалять существующие изображения.
- **Блок "Свойства" (`app-props`)**:
    - **Назначение**: Отображает и позволяет редактировать ключевые атрибуты товара (например, "Бренд", "Страна", "Производитель"). Представлен в виде списка "ключ-значение".
- **Блок "Информационные блоки" (`app-blocks`)**:
    - **Назначение**: Управление текстовыми блоками с подробной информацией о товаре (например, "Описание", "Состав", "Способ применения").
    - **Взаимодействие**:
        - Добавление новых блоков.
        - Редактирование заголовка и содержимого существующих блоков.
        - Удаление блоков.
- **Разделение контента**:
    - Страница визуально разделена на два основных раздела: "Обязательная информация" (управляется аптечной сетью) и "Информация от производителя". Каждый раздел содержит свои блоки для изображений и текстовой информации.

## 3. Пользовательские Сценарии (User Flows)

- **Добавление описания товара**:
    1. Пользователь заходит на страницу редактирования.
    2. Прокручивает до раздела "Информационные блоки".
    3. Нажимает "Добавить блок".
    4. В появившейся форме вводит заголовок "Описание" и вставляет текст описания в поле содержимого.
    5. Нажимает "Сохранить". Данные отправляются на сервер, и новый блок появляется в списке.
- **Загрузка нового изображения**:
    1. Пользователь находит блок "Изображения".
    2. Перетаскивает файл изображения на специальную область или нажимает на нее для открытия системного диалога выбора файла.
    3. После выбора файла изображение загружается на сервер и автоматически добавляется в галерею.

## 4. Навигация

- **Переходы с этой страницы**:
    - `/drugs`: При нажатии на кнопку "Вернуться к списку товаров".
    - Внешний сайт: При клике на ссылку "Товар на сайте".
- **Переходы на эту страницу**:
    - Со страницы списка СТМ (`/drugs`) при нажатии кнопки "Редактировать" на карточке товара.

## 5. Отображаемые Данные

- **Типы данных**:
    - Детальная информация о товаре (`DrugsDetail`), включая название, URL, изображения, свойства и информационные блоки.
- **Источники данных (API)**:
    - `GET merch-lk/v1/drugs/detail`: Получение всей информации о товаре по его `id`.
    - `POST merch-lk/v1/drugs/detail/update`: Универсальный метод для обновления данных о товаре. Используется для:
        - Загрузки/удаления изображений.
        - Создания/редактирования/удаления информационных блоков.
        - Обновления свойств (атрибутов).
- **Отправляемые данные**:
    - `id` (number): ID товара, передается в URL.
    - В теле POST-запроса на `update` передаются только измененные данные, например:
        - `{ "image": { "new": File } }` для загрузки нового изображения.
        - `{ "image": { "deleted": 123 } }` для удаления изображения с ID 123.
        - `{ "block": { "id": 456, "content": "Новый текст" } }` для обновления текстового блока.
        - `{ "prop": { "code": "brand", "value": "Новый бренд" } }` для обновления свойства.

## 6. Особые Состояния/Логика

- **Загрузка**:
    - При первоначальной загрузке данных о товаре отображается `app-loader`.
    - Во время загрузки нового изображения в блоке `app-images` показывается индикатор загрузки.
- **Ошибки**: При ошибках API (загрузка данных, обновление) пользователю показывается всплывающее уведомление (toast) с текстом ошибки.
- **Реактивность**: После каждого успешного изменения (например, добавление фото или редактирование блока) на сервер уходит запрос, и в ответ приходят обновленные "стикеры", которые тут же отображаются на странице, информируя пользователя об изменении статуса заполненности карточки.
