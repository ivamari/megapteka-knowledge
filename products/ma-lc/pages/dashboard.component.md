# Страница: Дашборд (Dashboard)

## 1. Обзор Страницы

- **Назначение**: Отображение ключевых показателей эффективности (KPI) аптечной сети в виде наглядных виджетов.
- **Роль**: Предоставляет владельцу сети быстрый обзор состояния бизнеса, позволяя оценить общую картину по заказам, аптекам и рейтингам.
- **Основные функции**:
    - Просмотр динамики заказов.
    - Мониторинг количества и статуса аптек.
    - Анализ лучших и худших аптек по разным критериям.
    - Отслеживание статистики по активным, отмененным и выполненным заказам.

## 2. Элементы Пользовательского Интерфейса (UI)

- **Заголовок**: `<h1>Основные показатели аптек</h1>`
    - Назначение: Информирует пользователя о содержимом страницы.
- **График "Доля заказов сети"**:
    - Назначение: Визуализирует долю заказов сети в общей массе заказов сервиса за последние недели.
    - Элементы:
        - **Кнопка "Общая доля"**: Переключает график на отображение общей доли заказов по всей сети.
        - **Кнопка "Доля в регионе"**: Переключает график на отображение доли заказов в конкретном регионе. При активации появляется фильтр по регионам.
        - **Фильтр по регионам**: Появляется при выборе "Доля в регионе", позволяет выбрать конкретный регион для анализа.
- **Виджет "Количество аптек"**:
    - Назначение: Отображает общее, активное и отключенное количество аптек.
    - Взаимодействие: Клик по каждому показателю перенаправляет на страницу "Аптеки" с предустановленным фильтром.
- **Виджет "Количество аптек в карантине"**:
    - Назначение: Показывает число аптек, временно заблокированных из-за низкого рейтинга.
    - Взаимодействие: Клик по виджету перенаправляет на страницу "Аптеки" с фильтром по аптекам в карантине.
- **Виджеты "Лучшие/Худшие аптеки по рейтингу Мегаптеки"**:
    - Назначение: Отображают топ-5 аптек с самым высоким и самым низким внутренним рейтингом.
    - Взаимодействие: Клик по заголовку перенаправляет на страницу "Аптеки" с соответствующей сортировкой.
- **Виджеты "Лучшие/Худшие аптеки по рейтингу клиентов"**:
    - Назначение: Отображают топ-5 аптек с самым высоким и самым низким рейтингом на основе оценок покупателей.
- **Виджеты Заказов ("Активные", "Отмененные", "Выданные", "Зависшие")**:
    - Назначение: Показывают статистику по заказам за последние 30 дней (количество и общая сумма).
- **Виджеты Отмен ("Автоотмены", "Отмены до сборки", "Отмены раньше срока брони")**:
    - Назначение: Показывают топ-5 аптек, лидирующих по разным типам отмен.
    - Взаимодействие: Клик по заголовку перенаправляет на страницу "Заказы" с соответствующим фильтром.
- **Виджет "Долгая сборка"**:
    - Назначение: Показывает топ-5 аптек с самым долгим средним временем сборки заказа.
    - Взаимодействие: Клик по заголовку перенаправляет на страницу "Аптеки" с сортировкой по времени сборки.
- **Иконка с подсказкой (Tooltip)**:
    - Назначение: При наведении курсора объясняет, как рассчитывается тот или иной показатель.

## 3. Пользовательские Сценарии (User Flows)

- **Анализ динамики заказов**:
    1. Пользователь заходит на Дашборд.
    2. Видит график "Доля заказов сети".
    3. Нажимает кнопку "Доля в регионе".
    4. В появившемся фильтре выбирает интересующий регион.
    5. График перестраивается, показывая данные для выбранного региона.
- **Переход к списку проблемных аптек**:
    1. Пользователь видит в виджете "Худшие аптеки" аптеку с низким рейтингом.
    2. Кликает на заголовок виджета.
    3. Система перенаправляет его на страницу "Аптеки", отсортированную по возрастанию рейтинга.

## 4. Навигация

- **Переходы с этой страницы**:
    - `/stores` (Аптеки): При клике на виджеты, связанные с аптеками (количество, карантин, рейтинги, долгая сборка).
    - `/orders` (Заказы): При клике на виджеты, связанные с причинами отмен.
- **Переходы на эту страницу**:
    - Через основное меню навигации (пункт "Дашборд").
    - Является страницей по умолчанию после авторизации.

## 5. Отображаемые Данные

- **Типы данных**:
    - Статистика по заказам (количество, суммы, динамика).
    - Списки аптек (лучшие, худшие, по причинам отмен).
    - Статистика по количеству аптек.
- **Источники данных (API)**:
    - `GET merch-lk/v2/analytics/dashboard/orders`: Получение данных для виджетов по активным, отмененным, выданным и зависшим заказам.
    - `GET merch-lk/v2/analytics/dashboard/stores/quantity`: Получение данных для виджета "Количество аптек".
    - `GET merch-lk/v2/analytics/dashboard/stores/cancel`: Получение данных для виджетов по причинам отмен.
    - `GET merch-lk/v2/analytics/dashboard/stores/build-time`: Получение данных для виджета "Долгая сборка".
    - `GET merch-lk/v2/analytics/dashboard/stores/rating`: Получение данных для виджетов "Лучшие/Худшие аптеки".
    - `GET merch-lk/v2/analytics/dashboard/dynamic/orders`: Получение данных для графика динамики заказов. Принимает опциональный параметр `region_id`.
- **Отправляемые данные**:
    - `region_id` (number): Отправляется при фильтрации графика динамики заказов по региону.

## 6. Особые Состояния/Логика

- **Загрузка данных**: Во время загрузки данных для каждого виджета отображается компонент `app-loader`.
- **Ошибки загрузки**: Если API-запрос завершается с ошибкой, пользователю отображается всплывающее уведомление (toast) с текстом ошибки.
- **Сохранение фильтра**: Выбранный регион в фильтре "Доля в регионе" сохраняется в `localStorage` и восстанавливается при следующем заходе на страницу.
- **Пустое состояние**: Если данные для виджета отсутствуют, он отображается пустым (например, "Нет данных для отображения").
