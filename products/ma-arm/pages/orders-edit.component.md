# Страница Редактирования Заказа (EditComponent)

## Обзор Страницы

**Назначение:** Эта страница предназначена для просмотра и редактирования деталей существующего заказа.

**Основные функции:**
-   Просмотр детальной информации о заказе.
-   Изменение статуса заказа.
-   Добавление и редактирование комментариев.
-   Просмотр истории статусов заказа.
-   Редактирование состава заказа (добавление/удаление/изменение товаров).
-   Выполнение различных действий с заказом (разблокировать, выгрузить повторно, дополнить).

## Элементы Пользовательского Интерфейса (UI Elements)

| Название элемента | Назначение/функция | Возможные состояния | Взаимодействие пользователя |
| --- | --- | --- | --- |
| Информационные поля | Отображают различную информацию о заказе (номер, ФИО, телефон, email, город, аптека и т.д.). | - | - |
| Выпадающий список "Статус" | Позволяет изменить текущий статус заказа. | - | Выбор нового статуса. |
| Поле "Комментарий" | Позволяет добавить или отредактировать комментарий к заказу. | - | Ввод текста. |
| Чекбокс "Заказ обработан" | Отметка о том, что заказ обработан. | - Выбран<br>- Не выбран | Нажатие. |
| Таблица "Товары" | Отображает состав заказа и позволяет его редактировать. | - | Добавление, удаление, изменение товаров. |
| Кнопка "Разблокировать" | Разблокирует заказ, если он был заблокирован. | - Видима (если заказ можно разблокировать) | Нажатие. |
| Кнопка "Выгрузить повторно" | Повторно выгружает заказ. | - Видима (если заказ можно выгрузить повторно) | Нажатие. |
| Кнопка "Дополнить" | Создает новый заказ с данными текущего пользователя. | - | Нажатие. |
| Кнопка "Сохранить" | Сохраняет изменения и возвращает на предыдущую страницу. | - Активная<br>- Неактивная (во время загрузки) | Нажатие. |
| Кнопка "Применить" | Сохраняет изменения и остается на текущей странице. | - Активная<br>- Неактивная (во время загрузки) | Нажатие. |
| Кнопка "Отменить" | Отменяет изменения и возвращает на предыдущую страницу. | - Активная<br>- Неактивная (во время загрузки) | Нажатие. |
| Кнопка "Сменить клиента" | Открывает модальное окно для смены клиента, привязанного к заказу. | - | Нажатие. |
| Кнопка "Продлить ожидание" | Продлевает срок ожидания заказа на сутки. | - | Нажатие. |
| Кнопка "Заблокировать устройство" | Добавляет устройство клиента в блок-лист. | - | Нажатие. |

## Пользовательские Сценарии (User Flows)

1.  **Редактирование статуса заказа:**
    -   Пользователь открывает страницу редактирования заказа.
    -   Пользователь выбирает новый статус из выпадающего списка.
    -   Пользователь нажимает "Сохранить" или "Применить".

2.  **Редактирование состава заказа:**
    -   Пользователь открывает страницу редактирования заказа.
    -   Пользователь вносит изменения в таблицу с товарами.
    -   Пользователь нажимает "Сохранить" или "Применить".

## Навигация

**Переходы с текущей страницы:**
-   Возврат на предыдущую страницу (список активных или архивных заказов).
-   `/orders/active/new/:id`: Переход на страницу создания нового заказа с данными текущего пользователя.
-   `/stores/list?id=:store_id`: Переход на страницу аптеки.

**Переходы на текущую страницу:**
-   Со страницы активных заказов: `/orders/active/:id`.
-   Со страницы архивных заказов: `/orders/archive/:id`.

## Отображаемые Данные

**Получаемые данные:**
-   Детальная информация о заказе.
    -   **REST эндпоинт:** `GET /orders/detail`
    -   **Сервис:** `ApiOrdersService`
    -   **Метод сервиса:** `detail()`
-   Список статусов заказов.
    -   **Сервис:** `OrdersService`
    -   **Метод сервиса:** `listStatuses()`

**Отправляемые данные:**
-   `id` (number): ID заказа.
-   `status_id` (number): ID нового статуса.
-   `comments` (string, опционально): Комментарий.
-   `is_processed` (boolean, опционально): Флаг "Заказ обработан".

**REST эндпоинт для отправки данных:**
-   **Метод:** `PUT`
-   **Эндпоинт:** `/orders`
-   **Сервис:** `ApiOrdersService`
-   **Метод сервиса:** `put()`

## Особые Состояния/Логика

-   **Загрузка данных:** Во время загрузки информации о заказе, на странице отображается индикатор загрузки.
-   **Условное отображение кнопок:** Кнопки "Разблокировать" и "Выгрузить повторно" отображаются только если для заказа доступны эти действия.
-   **Подтверждение действий:** Перед сохранением изменений, а также перед выполнением других действий (разблокировка, повторная выгрузка и т.д.), система запрашивает подтверждение у пользователя.
-   **Редактирование данных аптеки:** На странице можно редактировать телефон аптеки.
-   **Смена клиента:** Есть возможность привязать заказ к другому клиенту.
-   **Блокировка устройства:** Можно заблокировать устройство клиента.
