# Страница Отчета "Топ Товаров" (TopItemsComponent)

## Обзор Страницы

**Назначение:** Эта страница предназначена для формирования и скачивания отчета "Топ товаров". Отчет представляет собой Excel-файл, содержащий топ-50 товаров по количеству выкупленных заказов в указанном регионе (и опционально городе) для выбранной аптечной сети.

**Основные функции:**
-   Выбор аптечной сети.
-   Выбор региона.
-   Выбор города (опционально, становится доступным после выбора региона).
-   Формирование и скачивание отчета.

## Элементы Пользовательского Интерфейса (UI Elements)

| Название элемента | Назначение/функция | Возможные состояния | Взаимодействие пользователя |
| --- | --- | --- | --- |
| Поле "Аптечная сеть" | Поиск и выбор аптечной сети для отчета. | - | Ввод текста для поиска, выбор из списка. |
| Поле "Регион" | Поиск и выбор региона для отчета. | - | Ввод текста для поиска, выбор из списка. |
| Поле "Город" | Поиск и выбор города внутри выбранного региона. | - Появляется после выбора региона. | Ввод текста для поиска, выбор из списка. |
| Кнопка "Сформировать" | Запускает процесс формирования и скачивания отчета. | - Активная<br>- Неактивная (во время загрузки) | Нажатие. |
| Кнопка "Очистить" | Сбрасывает все поля формы. | - | Нажатие. |

## Пользовательские Сценарии (User Flows)

1.  **Формирование отчета:**
    -   Пользователь открывает страницу.
    -   Выбирает аптечную сеть.
    -   Выбирает регион.
    -   При необходимости, выбирает город.
    -   Нажимает кнопку "Сформировать".
    -   Система генерирует отчет, и браузер предлагает скачать Excel-файл.

## Навигация

**Переходы с текущей страницы:**
-   Нет (происходит скачивание файла).

**Переходы на текущую страницу:**
-   Прямой переход по URL `/reports/top-items`.

## Отображаемые Данные

**Получаемые данные (для фильтров):**
-   Список аптечных сетей: `GET /stores/networks`
-   Список регионов: `GET /regions`
-   Список городов: `GET /v2/cities`

**Отправляемые данные (для формирования отчета):**
-   `network_id` (number): ID выбранной сети.
-   `region_id` (number): ID выбранного региона.
-   `city_id` (number, опционально): ID выбранного города.

**REST эндпоинт для получения отчета:**
-   **Метод:** `GET`
-   **Эндпоинт:** `/reports/top-items`
-   **Сервис:** `ApiReportsService`
-   **Метод сервиса:** `getReportsTopItems()`

## Особые Состояния/Логика

-   **Загрузка данных:** Во время формирования отчета на странице отображается индикатор загрузки.
-   **Валидация формы:** Поля "Аптечная сеть" и "Регион" являются обязательными.
-   **Скачивание файла:** Сервис `ApiReportsService` обрабатывает ответ от API как `blob` и инициирует скачивание файла браузером.
-   **Зависимые фильтры:** Поле "Город" становится доступным и загружает список городов только после того, как выбран "Регион".
-   **Асинхронный поиск:** Для всех полей выбора реализован асинхронный поиск по мере ввода текста.
