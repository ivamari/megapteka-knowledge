# Страница Создания Нового Заказа (NewComponent)

## Обзор Страницы

**Назначение:** Эта страница предназначена для создания нового заказа.

**Основные функции:**
-   Ввод данных клиента (ФИО, телефон, email).
-   Выбор города и аптеки.
-   Добавление товаров в заказ.
-   Сохранение нового заказа.

## Элементы Пользовательского Интерфейса (UI Elements)

| Название элемента | Назначение/функция | Возможные состояния | Взаимодействие пользователя |
| --- | --- | --- | --- |
| Поле "ФИО" | Ввод ФИО клиента. | - Пустое<br>- Заполненное | Ввод текста. |
| Поле "Телефон" | Ввод номера телефона клиента. | - Пустое<br>- Заполненное | Ввод номера. |
| Поле "Электронная почта" | Ввод email клиента. | - Пустое<br>- Заполненное | Ввод текста. |
| Выпадающий список "Город" | Выбор города, в котором будет сделан заказ. | - | Выбор элемента. |
| Поле "Адрес магазина" | Поиск и выбор аптеки для самовывоза. | - | Ввод текста для поиска. |
| Таблица "Товары" | Добавление и редактирование товаров в заказе. | - | Добавление, удаление, изменение количества товаров. |
| Кнопка "Создать заказ" | Сохраняет новый заказ и переходит на страницу его редактирования. | - Активная<br>- Неактивная (во время загрузки) | Нажатие. |
| Кнопка "Отменить" | Отменяет создание заказа и возвращает на предыдущую страницу. | - Активная<br>- Неактивная (во время загрузки) | Нажатие. |

## Пользовательские Сценарии (User Flows)

1.  **Создание нового заказа:**
    -   Пользователь заполняет данные клиента.
    -   Пользователь выбирает город и аптеку.
    -   Пользователь добавляет товары в заказ.
    -   Пользователь нажимает кнопку "Создать заказ".
    -   Система сохраняет заказ и перенаправляет на страницу редактирования этого заказа.

2.  **Создание заказа на основе существующего пользователя:**
    -   Пользователь переходит на страницу с параметром `id` пользователя в URL.
    -   Форма автоматически заполняется данными этого пользователя.
    -   Пользователь добавляет товары и сохраняет заказ.

## Навигация

**Переходы с текущей страницы:**
-   `/orders/active/:id`: При успешном создании заказа, происходит переход на страницу редактирования этого заказа.
-   Возврат на предыдущую страницу при нажатии кнопки "Отменить".

**Переходы на текущую страницу:**
-   Прямой переход по URL `/orders/active/new`.
-   Переход со страницы активных заказов с `id` пользователя: `/orders/active/new/:id`.

## Отображаемые Данные

**Получаемые данные:**
-   Данные пользователя (если передан `id` в URL).
    -   **REST эндпоинт:** `GET /orders`
    -   **Сервис:** `ApiOrdersService`
    -   **Метод сервиса:** `get()`
-   Список городов.
    -   **REST эндпоинт:** `GET /v2/cities`
    -   **Сервис:** `ApiCitiesService`
    -   **Метод сервиса:** `getV2()`

**Отправляемые данные:**
-   `fio` (string): ФИО клиента.
-   `phone` (string): Телефон клиента.
-   `email` (string): Email клиента.
-   `city_id` (number): ID города.
-   `store_id` (number): ID аптеки.
-   `items` (array): Массив товаров в заказе.
-   `client_id` (number, опционально): ID клиента.
-   `account_device_id` (number, опционально): ID устройства клиента.

**REST эндпоинт для отправки данных:**
-   **Метод:** `POST`
-   **Эндпоинт:** `/orders`
-   **Сервис:** `ApiOrdersService`
-   **Метод сервиса:** `post()`

## Особые Состояния/Логика

-   **Предзаполнение формы:** Если в URL передается `id` пользователя, форма автоматически заполняется его данными.
-   **Динамическая загрузка аптек:** Поле выбора аптеки становится доступным только после выбора города, и список аптек загружается в соответствии с выбранным городом.
-   **Подтверждение сохранения:** Перед сохранением заказа, система запрашивает подтверждение у пользователя.
-   **Состояние загрузки:** Во время сохранения заказа, кнопки "Создать заказ" и "Отменить" становятся неактивными и на них отображается индикатор загрузки.
