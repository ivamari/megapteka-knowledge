# Страница Редактирования/Создания Мегасовета (DetailComponent)

## Обзор Страницы

**Назначение:** Эта страница предназначена для создания и редактирования мегасоветов (статей, акций).

**Основные функции:**
-   Заполнение основной информации о мегасовете (название, текст, изображения).
-   Настройка SEO-параметров.
-   Управление видимостью на разных платформах (сайт, мобильное приложение).
-   Установка дат публикации и активности.
-   Привязка товаров и тегов.
-   Добавление контентных блоков.

## Элементы Пользовательского Интерфейса (UI Elements)

| Название элемента | Назначение/функция | Возможные состояния | Взаимодействие пользователя |
| --- | --- | --- | --- |
| Поле "Название" | Ввод названия мегасовета. | - | Ввод текста. |
| Поле "Теги" | Выбор тегов для мегасовета. | - | Выбор из списка, поиск. |
| Поле "Автор" | Выбор автора мегасовета. | - | Выбор из списка. |
| Поле "Превью текст" | Ввод краткого описания для превью. | - | Ввод текста. |
| Поле "Превью картинка" | Загрузка изображения для превью. | - | Выбор файла. |
| Поле "Детальная картинка" | Загрузка основного изображения. | - | Выбор файла. |
| Поле "СЕО Тайтл" | Ввод SEO-заголовка. | - | Ввод текста. |
| Поле "СЕО Дескрипшен" | Ввод SEO-описания. | - | Ввод текста. |
| Чекбоксы видимости | Управление видимостью на главном экране, на сайте, в МП. | - Выбран<br>- Не выбран | Нажатие. |
| Поля "Дата публикации и окончания" | Выбор диапазона дат активности мегасовета. | - | Выбор дат. |
| Поле "Сортировка" | Установка порядка отображения. | - | Ввод числа. |
| Выпадающий список "Статус" | Выбор статуса (например, "Опубликован", "Черновик"). | - | Выбор из списка. |
| Таблица "Блоки" | Добавление и редактирование контентных блоков. | - | Добавление, удаление, редактирование. |
| Таблица "Товары" | Привязка товаров к мегасовету. | - | Добавление, удаление товаров. |
| Кнопки "Сохранить", "Применить", "Отменить" | Управление сохранением изменений. | - | Нажатие. |

## Пользовательские Сценарии (User Flows)

1.  **Создание нового мегасовета:**
    -   Пользователь открывает пустую форму.
    -   Заполняет все необходимые поля.
    -   Добавляет контентные блоки и товары.
    -   Нажимает "Сохранить" или "Применить".

2.  **Редактирование существующего мегасовета:**
    -   Пользователь открывает страницу с `id` мегасовета в URL.
    -   Форма заполняется данными мегасовета.
    -   Пользователь вносит изменения.
    -   Нажимает "Сохранить" или "Применить".

## Навигация

**Переходы с текущей страницы:**
-   Возврат на предыдущую страницу (список активных или архивных мегасоветов).
-   При создании нового мегасовета и сохранении, происходит переход на страницу редактирования этого же мегасовета (`/specials/active/detail/:id`).

**Переходы на текущую страницу:**
-   Со страницы активных мегасоветов для редактирования: `/specials/active/detail/:id`.
-   Со страницы активных мегасоветов для создания: `/specials/active/detail`.
-   Со страницы архивных мегасоветов: `/specials/archive/detail/:id`.

## Отображаемые Данные

**Получаемые данные:**
-   Детальная информация о мегасовете (если редактирование).
    -   **REST эндпоинт:** `GET /specials/:id`
    -   **Сервис:** `ApiSpecialsService` (через `DetailService`)
    -   **Метод сервиса:** `getStock()`
-   Список статусов.
    -   **Сервис:** `SpecialsService`
    -   **Метод сервиса:** `listStatuses()`
-   Список авторов.
    -   **REST эндпоинт:** `GET /authors`
    -   **Сервис:** `ApiAuthorsService` (через `DetailService`)
    -   **Метод сервиса:** `getAuthors()`

**Отправляемые данные:**
-   Полная модель мегасовета со всеми полями формы.

**REST эндпоинт для отправки данных:**
-   **Метод:** `POST` (для создания) или `PUT` (для редактирования)
-   **Эндпоинт:** `/specials`
-   **Сервис:** `ApiSpecialsService` (через `DetailService`)
-   **Метод сервиса:** `save()`

## Особые Состояния/Логика

-   **Загрузка данных:** При редактировании, во время загрузки информации, на странице отображается индикатор загрузки.
-   **Валидация формы:** Многие поля формы являются обязательными для заполнения.
-   **Динамическая валидация:** Поле `guide_product_id` становится обязательным, если установлен флаг `is_guide`.
-   **Поиск тегов:** Реализован асинхронный поиск тегов при их добавлении.
