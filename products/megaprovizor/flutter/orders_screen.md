# Экран: Заказы (ScreenOrders)

## 1. Обзор Экрана

*   **Назначение:** Предоставляет полный доступ ко всем заказам, разделенным на "Активные" и "Завершенные". Экран поддерживает бесконечную прокрутку для загрузки старых заказов и полнотекстовый поиск.
*   **Основные функции:**
    *   Просмотр списка активных заказов.
    *   Просмотр списка завершенных (архивных) заказов.
    *   Бесконечная прокрутка (пагинация) для обоих списков.
    *   Обновление списков с помощью pull-to-refresh.
    *   Поиск заказов по имени клиента, номеру телефона или номеру заказа.
    *   Переход к детальному экрану заказа.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **AppBar:**
    *   **Назначение:** Верхняя панель с заголовком "Заказы" и иконкой поиска.
    *   **Взаимодействие:** Нажатие на иконку поиска открывает интерфейс поиска (`OrdersSearchDelegate`).
*   **Таб-бар (`StyledTabBar`):**
    *   **Назначение:** Переключение между списками активных и завершенных заказов.
    *   **UI Элементы:** Две вкладки: "Активные" и "Завершенные".
    *   **Взаимодействие:** Нажатие на вкладку переключает отображаемый список.
*   **Список заказов (Активные):**
    *   **Назначение:** Отображает список активных заказов с использованием пагинации.
    *   **UI Элементы:** `PagedListView` с карточками заказов (`OrderCard`).
    *   **Состояния:**
        *   **Загрузка:** Отображается индикатор загрузки.
        *   **Пустое состояние:** Отображается иллюстрация и текст "У вас пока нет активных заказов".
        *   **Ошибка:** Отображается виджет с сообщением об ошибке.
    *   **Взаимодействие:**
        *   Прокрутка вниз загружает следующую страницу заказов.
        *   Pull-to-refresh обновляет список.
        *   Нажатие на карточку заказа переходит на экран деталей заказа.
*   **Список заказов (Завершенные):**
    *   **Назначение:** Отображает список завершенных заказов с использованием пагинации.
    *   **UI Элементы:** `PagedSliverList` с карточками заказов (`OrderCard`).
    *   **Состояния:** Аналогичны списку активных заказов, но с другим текстом для пустого состояния.
    *   **Взаимодействие:** Аналогично списку активных заказов.
*   **Уведомление (`_NoticeWidget`):**
    *   **Назначение:** Информирует пользователя о возможности оставлять отзывы на клиентов.
    *   **Состояния:** Отображается один раз. Может быть скрыто пользователем.
    *   **Взаимодействие:** Нажатие на иконку "закрыть" скрывает уведомление.
*   **Интерфейс поиска (`OrdersSearchDelegate`):**
    *   **Назначение:** Позволяет пользователю вводить поисковый запрос и видеть результаты.
    *   **UI Элементы:** Поле ввода, кнопка "назад", кнопка "очистить".
    *   **Состояния:**
        *   **Пустой запрос:** Ничего не отображается.
        *   **Есть результаты:** Отображается `PagedListView` с найденными заказами.
        *   **Нет результатов:** Отображается иллюстрация и текст "Заказы не найдены".
    *   **Взаимодействие:**
        *   Ввод текста инициирует поиск.
        *   Нажатие на найденный заказ возвращает на предыдущий экран и переходит к деталям этого заказа.

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр и пагинация заказов:**
    1.  Пользователь открывает экран, по умолчанию видит активные заказы.
    2.  Прокручивает список вниз, и приложение автоматически подгружает следующую страницу заказов.
    3.  Переключается на вкладку "Завершенные" и повторяет процесс.
*   **Поиск заказа:**
    1.  Пользователь нажимает иконку поиска в AppBar.
    2.  Вводит номер заказа (или имя/телефон клиента).
    3.  По мере ввода отображаются результаты поиска.
    4.  Пользователь находит нужный заказ и нажимает на него.
    5.  Экран поиска закрывается, и открывается экран деталей выбранного заказа.
*   **Обновление списка:**
    1.  Пользователь находится на одной из вкладок.
    2.  Тянет список вниз (pull-to-refresh).
    3.  Список заказов на текущей вкладке обновляется с сервера.

## 4. Навигация

*   **На экран "Детали заказа" (`/orders/:orderId`):**
    *   **Условие:** Нажатие на карточку заказа в любом из списков (активные, завершенные, результаты поиска).
    *   **Метод:** `context.push('/orders/${order.id}')`.
*   **На экран поиска:**
    *   **Условие:** Нажатие на иконку поиска в AppBar.
    *   **Метод:** `showSearch(context: context, delegate: OrdersSearchDelegate())`.

## 5. Отображаемые Данные

*   **Типы данных:** `Order` - краткая информация о заказе для отображения в списке.
*   **Источник данных:**
    *   **API:**
        *   `GET /v1/orders/active`
        *   `GET /v1/orders/archive`
        *   `GET /v1/orders/search`
    *   **Локальное хранилище:** `SharedPreferences` используется для хранения флага `isNoticeShown`, чтобы уведомление показывалось только один раз.

## 6. Особые Состояния/Логика

*   **Пагинация:** Используется библиотека `infinite_scroll_pagination`. `OrdersController` содержит `PagingController` для каждого из трех списков (активные, завершенные, поиск).
*   **Поиск:** Реализован с помощью `SearchDelegate`. Поиск запускается по мере ввода текста пользователем.
*   **Одноразовое уведомление:** Логика `_NoticeWidget` и `isNoticeShown` в контроллере обеспечивает, что плашка с подсказкой про отзывы будет показана пользователю только один раз. Состояние хранится локально.
*   **Пустые состояния:** Для каждого списка (активные, завершенные, поиск) предусмотрен свой уникальный виджет, который отображается, если данных нет.
