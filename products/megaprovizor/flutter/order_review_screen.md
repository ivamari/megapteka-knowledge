# Экран: Оставить отзыв (ScreenOrderReview)

## 1. Обзор Экрана

*   **Назначение:** Позволяет провизору оценить клиента (покупателя) после завершения заказа. Оценка включает в себя рейтинг в виде звезд и необязательный текстовый комментарий.
*   **Основные функции:**
    *   Выставление оценки клиенту по 5-звездочной шкале.
    *   Добавление текстового комментария.
    *   Отправка отзыва на сервер.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **AppBar:**
    *   **Назначение:** Верхняя панель с заголовком "Оставить отзыв" и кнопкой "назад".
    *   **Состояния:** Статичное.
    *   **Взаимодействие:** Кнопка "назад" возвращает на экран деталей заказа.
*   **Текст-инструкция:**
    *   **Назначение:** Объясняет пользователю, что нужно сделать на экране.
    *   **Состояния:** Статичный текст.
    *   **Взаимодействие:** Нет.
*   **Рейтинг-бар (`RatingBar`):**
    *   **Назначение:** Позволяет выбрать оценку от 1 до 5 звезд.
    *   **UI Элементы:** Пять иконок звезд.
    *   **Состояния:**
        *   **Не выбрано:** Все звезды серые.
        *   **Выбрано:** Выбранное количество звезд становится активным (желтым).
    *   **Взаимодействие:** Нажатие на звезды устанавливает рейтинг.
*   **Поле ввода "Комментарий":**
    *   **Назначение:** Позволяет ввести текстовый комментарий к отзыву.
    *   **Состояния:**
        *   **Пустое:** Отображается плейсхолдер "Комментарий (необязательно)".
        *   **С текстом:** Отображается введенный пользователем текст.
    *   **Взаимодействие:** Ввод текста.
*   **Кнопка "Готово":**
    *   **Назначение:** Отправляет поставленную оценку и комментарий на сервер.
    *   **Состояния:**
        *   **Активна:** Готова к нажатию.
        *   **Неактивна/Загрузка:** Во время отправки данных на сервер.
    *   **Взаимодействие:** Нажатие инициирует отправку отзыва.

## 3. Пользовательские Сценарии (User Flows)

*   **Успешная отправка отзыва:**
    1.  Пользователь переходит на экран с экрана деталей заказа.
    2.  Выбирает оценку, нажимая на звезды (например, 4 звезды).
    3.  (Опционально) Вводит текст в поле для комментария.
    4.  Нажимает кнопку "Готово".
    5.  Приложение отправляет данные на сервер.
    6.  Появляется диалоговое окно "Отзыв принят".
    7.  После закрытия диалога пользователь возвращается на экран деталей заказа.
*   **Попытка отправки без оценки:**
    1.  Пользователь не выбирает оценку (оставляет 0 звезд).
    2.  Нажимает "Готово".
    3.  Появляется диалоговое окно с просьбой "Пожалуйста, выберите оценку".

## 4. Навигация

*   **Возврат на экран деталей заказа:**
    *   **Условие:**
        1.  Нажатие кнопки "назад" в AppBar.
        2.  Успешная отправка отзыва и закрытие подтверждающего диалога.
    *   **Метод:** `context.pop()`.
*   **Диплинки:** На этот экран можно попасть по пути `/orders/:orderId/review`.

## 5. Отображаемые Данные

*   **Типы данных:** На вход экран принимает `orderId`. В процессе работы он отправляет на сервер рейтинг (целое число от 1 до 5) и комментарий (строка).
*   **Источник данных:**
    *   **API:** `POST /v2/orders/rate`
    *   **Локальное хранилище:** Не используется.

## 6. Особые Состояния/Логика

*   **Валидация оценки:** Перед отправкой проверяется, что оценка была выставлена (`_rating > 0`). Если нет, показывается диалоговое окно с предупреждением.
*   **Состояние загрузки:** Кнопка "Готово" блокируется и показывает индикатор загрузки `CircularProgressIndicator` во время отправки запроса.
*   **Обработка ответа сервера:**
    *   **Успех:** Показывается диалог "Отзыв принят", и после его закрытия экран автоматически закрывается.
    *   **Ошибка:** Показывается стандартный диалог с текстом ошибки.
