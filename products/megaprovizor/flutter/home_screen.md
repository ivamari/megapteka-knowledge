# Экран: Главный (ScreenHome)

## 1. Обзор Экрана

*   **Назначение:** Главный экран приложения, который служит дашбордом для провизора. Он предоставляет сводную информацию о текущем состоянии аптеки, активных заказах, статистике, а также важные уведомления и статьи.
*   **Основные функции:**
    *   Отображение информации о текущей аптеке.
    *   Отображение списка активных заказов.
    *   Сканирование QR-кода заказа.
    *   Отображение важных уведомлений ("Обратите внимание").
    *   Отображение ключевых показателей статистики.
    *   Отображение последних статей для провизоров.
    *   Обновление всей информации на экране с помощью pull-to-refresh.
    *   Предложение включить push-уведомления, если они отключены.
    *   Информирование о доступном обновлении приложения.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **AppBar:**
    *   **Назначение:** Верхняя панель приложения с логотипом.
    *   **Состояния:** Статичное.
    *   **Взаимодействие:** Нет.
*   **Блок "Аптека" (`_StoreWidget`):**
    *   **Назначение:** Отображает информацию о текущей аптеке.
    *   **UI Элементы:**
        *   **Заголовок "Аптека"**.
        *   **Индикатор состояния аптеки:** Цветной кружок и текстовое описание.
        *   **Ссылка "Развернуть/Свернуть":** Показывает/скрывает детальную информацию об аптеке.
        *   **Карточка аптеки (`StoreCard`):** При нажатии ведет на экран "Аптека" (`/store`).
    *   **Взаимодействие:**
        *   Нажатие на ссылку "Развернуть/Свернуть" меняет объем отображаемой информации.
        *   Нажатие на карточку аптеки переходит на экран `/store`.
*   **Блок "Уведомления" (`_NotificationsWidget`):**
    *   **Назначение:** Предлагает пользователю включить push-уведомления, если они отключены.
    *   **UI Элементы:**
        *   **Текст-пояснение.**
        *   **Кнопка "Включить пуш-уведомления".**
    *   **Взаимодействие:** Нажатие на кнопку открывает настройки уведомлений телефона или запрашивает разрешение.
*   **Блок "Активные заказы" (`_OrdersWidget`):**
    *   **Назначение:** Отображает горизонтальный список активных заказов.
    *   **UI Элементы:**
        *   **Заголовок "Активные заказы"**.
        *   **Ссылка "Смотреть все":** Переходит на экран "Заказы" (`/orders`).
        *   **Горизонтальный список карточек заказов (`OrderCard`).**
    *   **Взаимодействие:**
        *   Нажатие на карточку заказа переходит на экран деталей заказа (`/home/orders/:orderId`).
        *   Нажатие на "Смотреть все" переходит на `/orders`.
*   **Кнопка "Сканировать код заказа":**
    *   **Назначение:** Открывает экран сканирования QR-кода.
    *   **Взаимодействие:** Нажатие открывает экран `/scan`. После успешного сканирования происходит переход на карточку заказа.
*   **Блок "Обратите внимание" (`_AttentionsWidget`):**
    *   **Назначение:** Отображает важные сообщения, требующие внимания пользователя, и информацию об обновлении приложения.
    *   **UI Элементы:**
        *   **Заголовок "Обратите внимание"**.
        *   **Горизонтальный список карточек (`AttentionCard`, `AppVersionItem`).**
    *   **Взаимодействие:**
        *   **Карточка обновления:** Кнопка "Обновить приложение" перенаправляет в App Store / Google Play.
        *   **Карточка Attention:** Кнопки могут вести по диплинку, а кнопка "закрыть" скрывает карточку.
*   **Блок "Статистика" (`_StatsWidget`):**
    *   **Назначение:** Показывает ключевые метрики работы аптеки.
    *   **UI Элементы:**
        *   **Заголовок "Статистика"** и период.
        *   **Рейтинг аптеки:** Отображается в виде плашки с цветом и значением.
        *   **Горизонтальный список карточек статистики (`StatCard`).**
        *   **Среднее время сборки.**
        *   **Рейтинг по отзывам.**
    *   **Взаимодействие:** Нажатие на элементы статистики или рейтинг по отзывам переходит на экран "Статистика" (`/stats`).
*   **Блок "Статьи" (`_ArticlesWidget`):**
    *   **Назначение:** Отображает последние статьи для провизоров.
    *   **UI Элементы:**
        *   **Заголовок "Статьи"**.
        *   **Ссылка "Смотреть все":** Переходит на экран "Статьи" (`/articles`).
        *   **Горизонтальный список карточек статей (`ArticleCard`).**
    *   **Взаимодействие:**
        *   Нажатие на карточку статьи переходит на экран деталей статьи (`/home/articles/:articleId`).
        *   Нажатие на "Смотреть все" переходит на `/articles`.

## 3. Пользовательские Сценарии (User Flows)

*   **Просмотр активных заказов:** Пользователь заходит на главный экран и видит список заказов, требующих обработки. Он может нажать на любой из них, чтобы посмотреть детали.
*   **Сканирование заказа:** Пользователь нажимает "Сканировать код заказа", открывается камера. После сканирования QR-кода открывается экран с деталями этого заказа.
*   **Просмотр статистики:** Пользователь просматривает основные показатели своей аптеки и при необходимости переходит на экран детальной статистики.
*   **Чтение статей:** Пользователь видит новые статьи, выбирает интересующую и переходит к чтению.
*   **Обновление данных:** Пользователь тянет экран вниз (pull-to-refresh), чтобы обновить всю информацию на экране.

## 4. Навигация

*   **На `/store`:** Нажатие на карточку аптеки.
*   **На `/orders`:** Нажатие на ссылку "Смотреть все" в блоке "Активные заказы".
*   **На `/home/orders/:orderId`:** Нажатие на карточку конкретного заказа.
*   **На `/scan`:** Нажатие на кнопку "Сканировать код заказа".
*   **На `/stats`:** Нажатие на элементы в блоке "Статистика".
*   **На `/articles`:** Нажатие на ссылку "Смотреть все" в блоке "Статьи".
*   **На `/home/articles/:articleId`:** Нажатие на карточку конкретной статьи.
*   **Переходы по диплинкам:** Из блока "Обратите внимание".

## 5. Отображаемые Данные

*   **Типы данных:**
    *   `Store`: Информация о текущей аптеке.
    *   `List<Order>`: Список активных заказов.
    *   `List<Attention>`: Список уведомлений, требующих внимания.
    *   `StoreStatistics`: Статистика работы аптеки.
    *   `StoreServiceRating`: Рейтинг сервиса аптеки.
    *   `List<Article>`: Список статей.
    *   `NotificationSettings`: Статус разрешений на push-уведомления.
    *   `AppVersion`: Информация о доступном обновлении.
*   **Источник данных:**
    *   **API:**
        *   `GET /v1/stores/details`
        *   `GET /v1/main/orders`
        *   `GET /v1/main/attentions`
        *   `POST /v1/main/attentions/close`
        *   `GET /v2/stores/statistics`
        *   `GET /v1/stores/service-rating`
        *   `GET /v1/main/articles`
    *   **Локальное хранилище:** Не используется.

## 6. Особые Состояния/Логика

*   **Pull-to-refresh:** Обновляет все данные на экране.
*   **Состояние загрузки:** Отображается глобальный индикатор загрузки `DeclarativeRefreshIndicator`.
*   **Пустые состояния:** Если нет активных заказов, статистики или статей, соответствующие блоки не отображаются.
*   **Логика уведомлений:** Блок с предложением включить push-уведомления отображается только если они отключены (`settings.data.authorizationStatus != AuthorizationStatus.authorized`).
*   **Логика обновления:** Блок с предложением обновить приложение отображается только если `appVersion.canUpdate == true`.
*   **Закрытие "attentions":** Пользователь может закрыть карточку из блока "Обратите внимание", информация об этом отправляется на сервер (`closeAttention(code)`).
