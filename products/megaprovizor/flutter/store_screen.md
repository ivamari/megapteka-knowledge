# Экран: Аптека (ScreenStore)

## 1. Обзор Экрана

*   **Назначение:** Предоставляет подробную информацию о текущей аптеке, в которой авторизован пользователь. Дает возможность сотрудникам предлагать изменения в данных аптеки, таких как расположение, график работы и информация о входе.
*   **Основные функции:**
    *   Отображение детальной информации об аптеке (карта, адрес, метро).
    *   Выход из текущей аптеки (смена аптеки).
    *   Отправка заявки на изменение расположения.
    *   Отправка заявки на изменение графика работы.
    *   Отправка заявки на изменение информации о том, как найти вход (текст и фото).
    *   Просмотр фотографий входа в полноэкранном режиме.
    *   Обновление данных об аптеке с помощью pull-to-refresh.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **AppBar:**
    *   **Назначение:** Верхняя панель с заголовком "Аптека".
    *   **Состояния:** Статичное.
    *   **Взаимодействие:** Нет (кнопка "назад" не отображается, так как это корневой экран в своей вкладке).
*   **Карта (`Image.network`):**
    *   **Назначение:** Показывает фрагмент карты с расположением аптеки.
    *   **Состояния:** Статичное изображение.
    *   **Взаимодействие:** Нет.
*   **Блок "Адрес":**
    *   **Назначение:** Отображает название бренда, адрес и ближайшие станции метро.
    *   **UI Элементы:**
        *   Название бренда.
        *   Адрес.
        *   Список станций метро (`MetroWidget`).
        *   **Ссылка "Сменить аптеку":** Позволяет выйти из текущей учетной записи аптеки.
    *   **Взаимодействие:** Нажатие на "Сменить аптеку" разлогинивает пользователя и перенаправляет на экран выбора аптеки.
*   **Кнопка "Уточнить расположение":**
    *   **Назначение:** Открывает модальное окно для отправки комментария об уточнении местоположения.
    *   **Взаимодействие:** Нажатие открывает `BottomSheet` с текстовым полем.
*   **Блок "Режим работы":**
    *   **Назначение:** Отображает текущий график работы аптеки.
    *   **UI Элементы:**
        *   Заголовок "Режим работы".
        *   Текст с графиком.
        *   **Кнопка "Изменить график".**
    *   **Взаимодействие:** Нажатие на кнопку открывает `BottomSheet` для отправки комментария.
*   **Блок "Как найти вход":**
    *   **Назначение:** Отображает текстовое описание и фотографии, помогающие найти вход в аптеку.
    *   **UI Элементы:**
        *   Заголовок "Как найти вход".
        *   Текстовое описание.
        *   Горизонтальный список фотографий.
        *   **Кнопка "Добавить пояснение или фото".**
    *   **Состояния:** Если раздел не заполнен, отображается соответствующий текст.
    *   **Взаимодействие:**
        *   Нажатие на фотографию открывает ее в полноэкранном просмотрщике.
        *   Нажатие на кнопку открывает `BottomSheet` для добавления текста и фотографий.

## 3. Пользовательские Сценарии (User Flows)

*   **Предложение изменить график работы:**
    1.  Пользователь нажимает кнопку "Изменить график".
    2.  Снизу экрана появляется модальное окно с полем для ввода текста.
    3.  Пользователь вводит корректный график работы и нажимает "Отправить".
    4.  Заявка отправляется на сервер, появляется диалоговое окно об успешном принятии заявки.
*   **Добавление информации о входе:**
    1.  Пользователь нажимает "Добавить пояснение или фото".
    2.  В модальном окне нажимает "Добавить фото" и выбирает изображения из галереи.
    3.  (Опционально) Вводит текстовое пояснение.
    4.  Нажимает "Отправить".
    5.  Заявка с текстом и изображениями отправляется на сервер.
*   **Просмотр фото входа:**
    1.  Пользователь видит галерею фотографий входа.
    2.  Нажимает на одну из них.
    3.  Фотография открывается в полноэкранном режиме с возможностью свайпа.
*   **Смена аптеки:**
    1.  Пользователь нажимает "Сменить аптеку".
    2.  Происходит выход из текущего аккаунта.
    3.  Пользователь перенаправляется на экран входа (`/sign_in`).

## 4. Навигация

*   **На экран входа (`/sign_in`):**
    *   **Условие:** Нажатие на ссылку "Сменить аптеку" и успешный выход.
*   **Диплинки:**
    *   На экран можно попасть по пути `/store`.
    *   Также поддерживаются диплинки для инициирования изменений:
        *   `/store?change=location`
        *   `/store?change=schedule`
        *   `/store?change=entrance`
    *   При переходе по таким ссылкам сразу открывается соответствующее модальное окно для внесения изменений.

## 5. Отображаемые Данные

*   **Типы данных:** `Store` - полная информация об аптеке, включая адрес, график, информацию о входе (`entranceInfo`).
*   **Источник данных:**
    *   **API:**
        *   `GET /v1/stores/details`
        *   `POST /v1/stores/location/change`
        *   `POST /v1/stores/schedule/change`
        *   `POST /v1/stores/control/create`
        *   `POST /v1/auth/logout`
    *   **Локальное хранилище:** Не используется.

## 6. Особые Состояния/Логика

*   **Состояние загрузки:** Во время загрузки данных или отправки изменений отображается индикатор `DeclarativeRefreshIndicator`.
*   **Обработка диплинков:** Экран слушает параметр `change` и при его наличии автоматически вызывает соответствующее диалоговое окно для внесения изменений.
*   **Загрузка изображений:** В диалоге изменения информации о входе используется `ImagePicker` для выбора нескольких изображений из галереи. Выбранные изображения отображаются в диалоге и могут быть удалены до отправки.
*   **Обработка ответа сервера:** После успешной отправки любой заявки на изменение отображается диалоговое окно "Заявка принята". В случае ошибки - диалог с текстом ошибки.
