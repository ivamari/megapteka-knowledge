# Экран: Детали статьи (ScreenArticleDetail)

## 1. Обзор Экрана

*   **Назначение:** Отображает полное содержимое выбранной статьи, включая заголовок, изображение, информацию об авторе, содержание и текстовые блоки.
*   **Основные функции:**
    *   Отображение полного текста и изображений статьи.
    *   Навигация по разделам статьи через оглавление.
    *   Возможность вернуться к списку статей.
    *   Кнопка для быстрой прокрутки к началу статьи.
    *   Обновление контента статьи с помощью pull-to-refresh.

## 2. Элементы Пользовательского Интерфейса (UI Elements)

*   **AppBar:**
    *   **Назначение:** Верхняя панель с заголовком "Статьи" и кнопкой "назад".
    *   **Состояния:** Статичное.
    *   **Взаимодействие:** Нажатие на кнопку "назад" возвращает на предыдущий экран.
*   **Заголовок статьи:**
    *   **Назначение:** Отображает название статьи.
    *   **Состояния:** Статичный текст.
    *   **Взаимодействие:** Нет.
*   **Изображение статьи:**
    *   **Назначение:** Главное изображение, иллюстрирующее статью.
    *   **Состояния:** Отображается, если URL изображения доступен.
    *   **Взаимодействие:** Нет.
*   **Блок "Автор":**
    *   **Назначение:** Отображает фотографию, имя и описание автора статьи.
    *   **Состояния:** Отображается, если данные об авторе доступны.
    *   **Взаимодействие:** Нет.
*   **Оглавление ("Содержание"):**
    *   **Назначение:** Предоставляет быстрый доступ к разделам статьи.
    *   **Состояния:** Отображается, если в статье есть именованные блоки.
    *   **Взаимодействие:** Нажатие на пункт оглавления плавно прокручивает экран к соответствующему разделу статьи.
*   **Разделитель:**
    *   **Назначение:** Визуально отделяет оглавление от основного контента.
    *   **Состояния:** Статичный.
    *   **Взаимодействие:** Нет.
*   **Блоки контента (`BlockValueWidget`):**
    *   **Назначение:** Отображают основной контент статьи, который может состоять из текста, изображений, списков и т.д.
    *   **Состояния:** Различные, в зависимости от типа контента в блоке.
    *   **Взаимодействие:** Нет.
*   **Floating Action Button (FAB):**
    *   **Назначение:** Кнопка для быстрой прокрутки к началу статьи.
    *   **Состояния:** Всегда видима.
    *   **Взаимодействие:** Нажатие на кнопку плавно прокручивает экран вверх, к началу контента статьи.

## 3. Пользовательские Сценарии (User Flows)

*   **Чтение статьи:**
    1.  Пользователь переходит на экран со списком статей.
    2.  Выбирает статью и попадает на этот экран.
    3.  Прокручивает контент, читая статью.
*   **Навигация по оглавлению:**
    1.  Пользователь видит оглавление в начале статьи.
    2.  Нажимает на интересующий его раздел.
    3.  Экран автоматически прокручивается к началу выбранного раздела.
*   **Возврат к началу:**
    1.  Прочитав часть статьи, пользователь хочет вернуться к началу.
    2.  Нажимает на плавающую кнопку со стрелкой вверх.
    3.  Экран прокручивается к заголовку статьи.
*   **Обновление статьи:**
    1.  Пользователь тянет экран вниз (pull-to-refresh).
    2.  Приложение перезагружает данные статьи с сервера.

## 4. Навигация

*   **Возврат на предыдущий экран:**
    *   **Условие:** Нажатие системной кнопки "назад" или кнопки "назад" в AppBar.
    *   **Метод:** Встроенная навигация `GoRouter`.
*   **Диплинки:** На этот экран можно попасть по путям:
    *   `/home/articles/:articleId`
    *   `/articles/:articleId`

## 5. Отображаемые Данные

*   **Типы данных:** `ArticleDetails` - объект, содержащий полную информацию о статье, включая заголовок, URL изображений, данные об авторе и список блоков контента.
*   **Источник данных:**
    *   **API:** `GET /v1/articles/details`
    *   **Локальное хранилище:** Не используется.

## 6. Особые Состояния/Логика

*   **Состояние загрузки:** Во время загрузки данных отображается индикатор `DeclarativeRefreshIndicator`.
*   **Ошибка загрузки:** В случае ошибки (например, нет сети или статья не найдена), на экране будет отображено сообщение об ошибке (логика обработки `Result.Error` находится в вышестоящих виджетах или контроллере).
*   **Логика оглавления:** Оглавление генерируется динамически на основе блоков, у которых заполнено поле `name`.
*   **Прокрутка к якорям:** Для реализации плавной прокрутки к разделам используется `SliverViewObserver` и `SliverObserverController`. Индекс для перехода вычисляется на основе положения виджетов в `CustomScrollView`.
